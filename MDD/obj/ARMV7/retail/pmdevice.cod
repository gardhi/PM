; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.114 

	TTL	C:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp
	THUMB

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "


  00000			 AREA	 |.bss|, NOINIT
|gBacklightMs| % 0x8
|gBacklightMsTotal| % 0x4
	IMPORT	|__security_push_cookie|
	IMPORT	|__security_pop_cookie|
	IMPORT	|__GSHandlerCheck|
	IMPORT	|StringCchVPrintfW|
	IMPORT	|StringCchLengthW|
	IMPORT	|CeLogData|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$CeLogMsg| DCD imagerel |$LN8@CeLogMsg|
	DCD	imagerel |$unwind2$CeLogMsg|

  00000			 AREA	 |.xdata|, DATA
|$unwind2$CeLogMsg| DCD 0x44b00032
	DCD	0x1e889e8
	DCD	0x400a8fb
	DCD	0x8801e8ff
	DCD	0xff05ef00
	DCD	imagerel |__GSHandlerCheck|
	DCD	0xffffffe5
; Function compile flags: /Ogsp
; File c:\wince800\public\common\sdk\inc\celog.h

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |CeLogMsg| PROC

; 1208 : {

  00000		 |$LN8@CeLogMsg|
  00000	b40f		 push        {r0-r3}
  00002	e92d 4800	 push        {r11,lr}
  00006	46eb		 mov         r11,sp
  00008	f000 f800	 bl          __security_push_cookie
  0000c	f2ad 2d24	 subw        sp,sp,#0x224
  00010		 |$M6|
  00010	4602		 mov         r2,r0

; 1209 :     va_list arglist;
; 1210 :     WCHAR   szTemp[MAX_PATH];
; 1211 :     size_t  cchLen;
; 1212 :     HRESULT hr;
; 1213 : 
; 1214 :     // Compose a single string using the input args
; 1215 :     va_start(arglist, szFormat);
; 1216 :     hr = StringCchVPrintfW(szTemp, MAX_PATH, szFormat, arglist);

  00012	a806		 add         r0,sp,#0x18
  00014	ab8d		 add         r3,sp,#0x234
  00016	f44f 7182	 mov         r1,#0x104
  0001a	928c		 str         r2,[sp,#0x230]
  0001c	f000 f800	 bl          StringCchVPrintfW

; 1217 :     if (SUCCEEDED(hr)) {

  00020	2800		 cmp         r0,#0
  00022	db17		 blt         |$LN1@CeLogMsg|

; 1218 :         hr = StringCchLengthW(szTemp, MAX_PATH, &cchLen);

  00024	aa04		 add         r2,sp,#0x10
  00026	a806		 add         r0,sp,#0x18
  00028	f44f 7182	 mov         r1,#0x104
  0002c	f000 f800	 bl          StringCchLengthW

; 1219 :         if (SUCCEEDED(hr)) {

  00030	2800		 cmp         r0,#0
  00032	db0f		 blt         |$LN1@CeLogMsg|

; 1220 :             CeLogData(TRUE, CELID_RAW_WCHAR, szTemp, (WORD)((cchLen + 1) * sizeof(WCHAR)),
; 1221 :                       0, CELZONE_ALWAYSON, 0, FALSE);

  00034	f04f 4380	 mov         r3,#0x40000000
  00038	9301		 str         r3,[sp,#4]
  0003a	9b04		 ldr         r3,[sp,#0x10]
  0003c	2200		 movs        r2,#0
  0003e	9203		 str         r2,[sp,#0xC]
  00040	3301		 adds        r3,#1
  00042	005b		 lsls        r3,r3,#1
  00044	9202		 str         r2,[sp,#8]
  00046	9200		 str         r2,[sp]
  00048	aa06		 add         r2,sp,#0x18
  0004a	214a		 movs        r1,#0x4A
  0004c	b29b		 uxth        r3,r3
  0004e	2001		 movs        r0,#1
  00050	f000 f800	 bl          CeLogData
  00054		 |$LN1@CeLogMsg|
  00054		 |$M9|

; 1222 :         }
; 1223 :     }
; 1224 : }

  00054	f20d 2d24	 addw        sp,sp,#0x224
  00058	f000 f800	 bl          __security_pop_cookie
  0005c	f85d bb04	 pop         {r11}
  00060	f85d fb14	 ldr         pc,[sp],#0x14
  00064		 |$M7|

			 ENDP  ; |CeLogMsg|

	EXPORT	|?GetNewDeviceDx@@YA?AW4_CEDEVICE_POWER_STATE@@W41@0000@Z| ; GetNewDeviceDx

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$?GetNewDeviceDx@@YA?AW4_CEDEVICE_POWER_STATE@@W41@0000@Z| DCD imagerel |$LN13@GetNewDevi|
	DCD	0xfd306071
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |?GetNewDeviceDx@@YA?AW4_CEDEVICE_POWER_STATE@@W41@0000@Z| PROC ; GetNewDeviceDx

; 350  : {

  00000		 |$LN13@GetNewDevi|
  00000	e92d 4818	 push        {r3,r4,r11,lr}
  00004	f20d 0b08	 addw        r11,sp,#8
  00008		 |$M11|
  00008	460c		 mov         r4,r1

; 351  :     CEDEVICE_POWER_STATE newDx = reqDx;
; 352  : 
; 353  :     DEBUGCHK(reqDx != PwrDeviceUnspecified);
; 354  :     DEBUGCHK(VALID_DX(reqDx));
; 355  : 
; 356  :     // determine which power state state to put the device into as a result
; 357  :     // of this update.  The device may already be in a valid state, in which
; 358  :     // case we don't need to do anything.
; 359  :     if(setDx != PwrDeviceUnspecified) {

  0000a	f1b2 3fff	 cmp         r2,#0xFFFFFFFF
  0000e	d107		 bne         |$LN4@GetNewDevi|

; 360  :         newDx = setDx;
; 361  :     } else {
; 362  :         // no explicitly set power level, compare current values against
; 363  :         // boundaries
; 364  :         newDx = reqDx;                  // assume this setting is ok
; 365  :         if(newDx < ceilingDx) {

  00010	9904		 ldr         r1,[sp,#0x10]
  00012	4602		 mov         r2,r0
  00014	4288		 cmp         r0,r1
  00016	da00		 bge         |$LN5@GetNewDevi|

; 366  :             // lower power to the level of the ceiling
; 367  :             newDx = ceilingDx;

  00018	460a		 mov         r2,r1
  0001a		 |$LN5@GetNewDevi|

; 368  :         }
; 369  :         if(floorDx < newDx) {

  0001a	4293		 cmp         r3,r2
  0001c	da00		 bge         |$LN4@GetNewDevi|

; 370  :             // raise power to the level of the floor
; 371  :             newDx = floorDx;

  0001e	461a		 mov         r2,r3
  00020		 |$LN4@GetNewDevi|

; 372  :         }
; 373  :     }
; 374  : 
; 375  :     // return no change if the new state is unchanged or is invalid
; 376  :     // (for example, if DevicePowerNotify() while processing 
; 377  :     // IOCTL_POWER_CAPABILITIES)
; 378  :     if(curDx == newDx || ! VALID_DX(newDx)) {

  00020	4294		 cmp         r4,r2
  00022	d004		 beq         |$LN1@GetNewDevi|
  00024	f1b2 3fff	 cmp         r2,#0xFFFFFFFF
  00028	dd01		 ble         |$LN1@GetNewDevi|
  0002a	2a05		 cmp         r2,#5
  0002c	db01		 blt         |$LN3@GetNewDevi|
  0002e		 |$LN1@GetNewDevi|

; 379  :         newDx = PwrDeviceUnspecified;

  0002e	f06f 0200	 mvn         r2,#0
  00032		 |$LN3@GetNewDevi|

; 380  :     }
; 381  : 
; 382  :     return newDx;
; 383  : }

  00032	4610		 mov         r0,r2
  00034		 |$M14|
  00034	e8bd 8818	 pop         {r3,r4,r11,pc}
  00038		 |$M12|

			 ENDP  ; |?GetNewDeviceDx@@YA?AW4_CEDEVICE_POWER_STATE@@W41@0000@Z|, GetNewDeviceDx

	EXPORT	|?GetNewDeviceStateInfo@@YAHPAW4_CEDEVICE_POWER_STATE@@0PAU_DeviceState_tag@@PAU_SystemPowerState_tag@@PAU_DevicePowerRestriction_tag@@3@Z| ; GetNewDeviceStateInfo
	IMPORT	|PowerRestrictionFindList|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$?GetNewDeviceStateInfo@@YAHPAW4_CEDEVICE_POWER_STATE@@0PAU_DeviceState_tag@@PAU_SystemPowerState_tag@@PAU_DevicePowerRestriction_tag@@3@Z| DCD imagerel |$LN49@GetNewDevi|
	DCD	0xfdb66221
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |?GetNewDeviceStateInfo@@YAHPAW4_CEDEVICE_POWER_STATE@@0PAU_DeviceState_tag@@PAU_SystemPowerState_tag@@PAU_DevicePowerRestriction_tag@@3@Z| PROC ; GetNewDeviceStateInfo

; 398  : {

  00000		 |$LN49@GetNewDevi|
  00000	e92d 4ffe	 push        {r1-r11,lr}
  00004	f20d 0b28	 addw        r11,sp,#0x28
  00008		 |$M47|

; 399  :     BOOL fOk = TRUE;
; 400  :     DEVICEID devId;
; 401  :     PDEVICE_POWER_RESTRICTION pdpr;
; 402  :     CEDEVICE_POWER_STATE newFloorDx, newCeilingDx;
; 403  : 
; 404  :     PREFAST_DEBUGCHK(psps != NULL);
; 405  :     PREFAST_DEBUGCHK(pNewFloorDx != NULL);
; 406  :     PREFAST_DEBUGCHK(pNewCeilingDx != NULL);
; 407  : 
; 408  :     // Assume the default ceiling state.  Since power ceilings are defined in
; 409  :     // the registry, there should be at most one that matches the device's 
; 410  :     // class and one that matches the device exactly.
; 411  :     newCeilingDx = psps->defaultCeilingDx;
; 412  : 
; 413  :     // look for power restrictions that match this device's class
; 414  :     devId.pGuid = pds->pListHead->pGuid;

  00008	f8d2 4064	 ldr.w       r4,[r2,#0x64]
  0000c	4682		 mov         r10,r0

; 415  :     devId.pszName = NULL;
; 416  :     if((pdpr = PowerRestrictionFindList(pCeilingDxList, &devId, NULL)) != NULL) {

  0000e	980d		 ldr         r0,[sp,#0x34]
  00010	6824		 ldr         r4,[r4]
  00012	461e		 mov         r6,r3
  00014	4690		 mov         r8,r2
  00016	4689		 mov         r9,r1
  00018	6877		 ldr         r7,[r6,#4]
  0001a	2300		 movs        r3,#0
  0001c	4669		 mov         r1,sp
  0001e	2200		 movs        r2,#0
  00020	9400		 str         r4,[sp]
  00022	9301		 str         r3,[sp,#4]
  00024	f000 f800	 bl          PowerRestrictionFindList
  00028	b100		 cbz         r0,|$LN22@GetNewDevi|

; 417  :         newCeilingDx = pdpr->devDx;

  0002a	6887		 ldr         r7,[r0,#8]
  0002c		 |$LN22@GetNewDevi|

; 418  :     }
; 419  : 
; 420  :     // look for power restrictions that match this device exactly
; 421  :     devId.pszName = pds->pszName;

  0002c	f8d8 4000	 ldr         r4,[r8]

; 422  :     if((pdpr = PowerRestrictionFindList(pCeilingDxList, &devId, NULL)) != NULL) {

  00030	980d		 ldr         r0,[sp,#0x34]
  00032	4669		 mov         r1,sp
  00034	2200		 movs        r2,#0
  00036	9401		 str         r4,[sp,#4]
  00038	f000 f800	 bl          PowerRestrictionFindList
  0003c	b100		 cbz         r0,|$LN21@GetNewDevi|

; 423  :         newCeilingDx = pdpr->devDx;

  0003e	6887		 ldr         r7,[r0,#8]
  00040		 |$LN21@GetNewDevi|

; 424  :     }
; 425  : 
; 426  :     // Assume the default floor (device turned off).  There may be multiple
; 427  :     // power floors specified in the registry so we will have to look for
; 428  :     // matches of several different types.
; 429  :     newFloorDx = D4;
; 430  : 
; 431  :     // are we ignoring application requirements in this system power state?
; 432  :     if((psps->dwFlags & (POWER_STATE_CRITICAL | POWER_STATE_OFF)) == 0) {

  00040	68b3		 ldr         r3,[r6,#8]
  00042	2404		 movs        r4,#4
  00044	f413 2fc0	 tst         r3,#0x60000
  00048	d15b		 bne         |$LN4@GetNewDevi|

; 433  :         BOOL fNeedForce;
; 434  : 
; 435  :         // is the default for this power state to ignore application requirements?
; 436  :         if((psps->dwFlags & POWER_STATE_SUSPEND) != 0) {

  0004a	f413 1f00	 tst         r3,#0x200000
  0004e	d001		 beq         |$LN19@GetNewDevi|

; 437  :             fNeedForce = TRUE;

  00050	2501		 movs        r5,#1

; 438  :         } else {

  00052	e000		 b           |$LN18@GetNewDevi|
  00054		 |$LN19@GetNewDevi|

; 439  :             fNeedForce = FALSE;

  00054	2500		 movs        r5,#0
  00056		 |$LN18@GetNewDevi|

; 440  :         }
; 441  : 
; 442  :         // no, look for the least restricted floor based on device class for any
; 443  :         // system power state
; 444  :         devId.pszName = NULL;

  00056	2300		 movs        r3,#0

; 445  :         pdpr = pFloorDxList;
; 446  :         while((pdpr = PowerRestrictionFindList(pdpr, &devId, NULL)) != NULL) {

  00058	980c		 ldr         r0,[sp,#0x30]
  0005a	4669		 mov         r1,sp
  0005c	9301		 str         r3,[sp,#4]
  0005e	2200		 movs        r2,#0
  00060	e00b		 b           |$LN39@GetNewDevi|
  00062		 |$LL17@GetNewDevi|

; 447  :             if(pdpr->devDx < newFloorDx
; 448  :             && (fNeedForce == FALSE || (pdpr->dwFlags & POWER_FORCE) != 0)) {

  00062	6882		 ldr         r2,[r0,#8]
  00064	42a2		 cmp         r2,r4
  00066	da05		 bge         |$LN15@GetNewDevi|
  00068	b11d		 cbz         r5,|$LN14@GetNewDevi|
  0006a	6903		 ldr         r3,[r0,#0x10]
  0006c	f413 5f80	 tst         r3,#0x1000
  00070	d000		 beq         |$LN15@GetNewDevi|
  00072		 |$LN14@GetNewDevi|

; 449  :                 newFloorDx = pdpr->devDx;

  00072	4614		 mov         r4,r2
  00074		 |$LN15@GetNewDevi|

; 450  :             }
; 451  :             pdpr = pdpr->pNext;

  00074	6940		 ldr         r0,[r0,#0x14]
  00076	2200		 movs        r2,#0
  00078	4669		 mov         r1,sp
  0007a		 |$LN39@GetNewDevi|

; 445  :         pdpr = pFloorDxList;
; 446  :         while((pdpr = PowerRestrictionFindList(pdpr, &devId, NULL)) != NULL) {

  0007a	f000 f800	 bl          PowerRestrictionFindList
  0007e	2800		 cmp         r0,#0
  00080	d1ef		 bne         |$LL17@GetNewDevi|

; 452  :         }
; 453  :         
; 454  :         // look for the least restricted floor based on device class for
; 455  :         // this system power state
; 456  :         devId.pszName = NULL;

  00082	2300		 movs        r3,#0

; 457  :         pdpr = pFloorDxList;
; 458  :         while((pdpr = PowerRestrictionFindList(pdpr, &devId, psps->pszName)) 
; 459  :             != NULL) {

  00084	980c		 ldr         r0,[sp,#0x30]
  00086	9301		 str         r3,[sp,#4]
  00088	e009		 b           |$LN41@GetNewDevi|
  0008a		 |$LL13@GetNewDevi|

; 460  :             if(pdpr->devDx < newFloorDx
; 461  :             && (fNeedForce == FALSE || (pdpr->dwFlags & POWER_FORCE) != 0)) {

  0008a	6882		 ldr         r2,[r0,#8]
  0008c	42a2		 cmp         r2,r4
  0008e	da05		 bge         |$LN11@GetNewDevi|
  00090	b11d		 cbz         r5,|$LN10@GetNewDevi|
  00092	6903		 ldr         r3,[r0,#0x10]
  00094	f413 5f80	 tst         r3,#0x1000
  00098	d000		 beq         |$LN11@GetNewDevi|
  0009a		 |$LN10@GetNewDevi|

; 462  :                 newFloorDx = pdpr->devDx;

  0009a	4614		 mov         r4,r2
  0009c		 |$LN11@GetNewDevi|

; 463  :             }
; 464  :             pdpr = pdpr->pNext;

  0009c	6940		 ldr         r0,[r0,#0x14]
  0009e		 |$LN41@GetNewDevi|

; 457  :         pdpr = pFloorDxList;
; 458  :         while((pdpr = PowerRestrictionFindList(pdpr, &devId, psps->pszName)) 
; 459  :             != NULL) {

  0009e	6832		 ldr         r2,[r6]
  000a0	4669		 mov         r1,sp
  000a2	f000 f800	 bl          PowerRestrictionFindList
  000a6	2800		 cmp         r0,#0
  000a8	d1ef		 bne         |$LL13@GetNewDevi|

; 465  :         }
; 466  :         
; 467  :         // look for the least restricted floor based on an exact 
; 468  :         // match with this device for any system power state
; 469  :         devId.pszName = pds->pszName;

  000aa	f8d8 3000	 ldr         r3,[r8]

; 470  :         pdpr = pFloorDxList;
; 471  :         while((pdpr = PowerRestrictionFindList(pdpr, &devId, NULL)) != NULL) {

  000ae	980c		 ldr         r0,[sp,#0x30]
  000b0	4669		 mov         r1,sp
  000b2	9301		 str         r3,[sp,#4]
  000b4	2200		 movs        r2,#0
  000b6	e00b		 b           |$LN43@GetNewDevi|
  000b8		 |$LL9@GetNewDevi|

; 472  :             if(pdpr->devDx < newFloorDx
; 473  :             && (fNeedForce == FALSE || (pdpr->dwFlags & POWER_FORCE) != 0)) {

  000b8	6882		 ldr         r2,[r0,#8]
  000ba	42a2		 cmp         r2,r4
  000bc	da05		 bge         |$LN7@GetNewDevi|
  000be	b11d		 cbz         r5,|$LN6@GetNewDevi|
  000c0	6903		 ldr         r3,[r0,#0x10]
  000c2	f413 5f80	 tst         r3,#0x1000
  000c6	d000		 beq         |$LN7@GetNewDevi|
  000c8		 |$LN6@GetNewDevi|

; 474  :                 newFloorDx = pdpr->devDx;

  000c8	4614		 mov         r4,r2
  000ca		 |$LN7@GetNewDevi|

; 475  :             }
; 476  :             pdpr = pdpr->pNext;

  000ca	6940		 ldr         r0,[r0,#0x14]
  000cc	2200		 movs        r2,#0
  000ce	4669		 mov         r1,sp
  000d0		 |$LN43@GetNewDevi|

; 470  :         pdpr = pFloorDxList;
; 471  :         while((pdpr = PowerRestrictionFindList(pdpr, &devId, NULL)) != NULL) {

  000d0	f000 f800	 bl          PowerRestrictionFindList
  000d4	2800		 cmp         r0,#0
  000d6	d1ef		 bne         |$LL9@GetNewDevi|

; 477  :         }
; 478  :         
; 479  :         // look for the least restricted floor based on an exact 
; 480  :         // match with this device for this system power state
; 481  :         devId.pszName = pds->pszName;

  000d8	f8d8 3000	 ldr         r3,[r8]

; 482  :         pdpr = pFloorDxList;
; 483  :         while((pdpr = PowerRestrictionFindList(pdpr, &devId, psps->pszName)) 
; 484  :             != NULL) {

  000dc	980c		 ldr         r0,[sp,#0x30]
  000de	9301		 str         r3,[sp,#4]
  000e0	e009		 b           |$LN45@GetNewDevi|
  000e2		 |$LL5@GetNewDevi|

; 485  :             if(pdpr->devDx < newFloorDx
; 486  :             && (fNeedForce == FALSE || (pdpr->dwFlags & POWER_FORCE) != 0)) {

  000e2	6882		 ldr         r2,[r0,#8]
  000e4	42a2		 cmp         r2,r4
  000e6	da05		 bge         |$LN3@GetNewDevi|
  000e8	b11d		 cbz         r5,|$LN2@GetNewDevi|
  000ea	6903		 ldr         r3,[r0,#0x10]
  000ec	f413 5f80	 tst         r3,#0x1000
  000f0	d000		 beq         |$LN3@GetNewDevi|
  000f2		 |$LN2@GetNewDevi|

; 487  :                 newFloorDx = pdpr->devDx;

  000f2	4614		 mov         r4,r2
  000f4		 |$LN3@GetNewDevi|

; 488  :             }
; 489  :             pdpr = pdpr->pNext;

  000f4	6940		 ldr         r0,[r0,#0x14]
  000f6		 |$LN45@GetNewDevi|

; 482  :         pdpr = pFloorDxList;
; 483  :         while((pdpr = PowerRestrictionFindList(pdpr, &devId, psps->pszName)) 
; 484  :             != NULL) {

  000f6	6832		 ldr         r2,[r6]
  000f8	4669		 mov         r1,sp
  000fa	f000 f800	 bl          PowerRestrictionFindList
  000fe	2800		 cmp         r0,#0
  00100	d1ef		 bne         |$LL5@GetNewDevi|
  00102		 |$LN4@GetNewDevi|

; 490  :         }
; 491  :     }
; 492  : 
; 493  :     // pass back values
; 494  :     if(fOk) {
; 495  :         *pNewCeilingDx = newCeilingDx;

  00102	f8c9 7000	 str         r7,[r9]

; 496  :         *pNewFloorDx = newFloorDx;

  00106	f8ca 4000	 str         r4,[r10]

; 497  :     }
; 498  : 
; 499  :     return fOk;

  0010a	2001		 movs        r0,#1
  0010c		 |$M50|

; 500  : }

  0010c	e8bd 8ffe	 pop         {r1-r11,pc}
  00110		 |$M48|

			 ENDP  ; |?GetNewDeviceStateInfo@@YAHPAW4_CEDEVICE_POWER_STATE@@0PAU_DeviceState_tag@@PAU_SystemPowerState_tag@@PAU_DevicePowerRestriction_tag@@3@Z|, GetNewDeviceStateInfo

	EXPORT	|CheckDevicePointer|
	IMPORT	|PmLock|
	IMPORT	|gpDeviceLists|
	IMPORT	|DeviceStateAddRef|
	IMPORT	|PmUnlock|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$CheckDevicePointer| DCD imagerel |$LN23@CheckDevic|
	DCD	0x316085
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |CheckDevicePointer| PROC

; 876  : {

  00000		 |$LN23@CheckDevic|
  00000	e92d 4830	 push        {r4,r5,r11,lr}
  00004	f20d 0b08	 addw        r11,sp,#8
  00008		 |$M21|
  00008	4605		 mov         r5,r0

; 877  :     PDEVICE_LIST pdl;
; 878  :     BOOL fFound = FALSE;

  0000a	2400		 movs        r4,#0

; 879  : 
; 880  :     // look for a match
; 881  :     DEBUGCHK(pds != NULL);
; 882  :     PMLOCK();

  0000c	f000 f800	 bl          PmLock

; 883  :     for(pdl = gpDeviceLists; pdl != NULL && !fFound; pdl = pdl->pNext) {

  00010	4b0c		 ldr         r3,|$LN26@CheckDevic| ; =|gpDeviceLists|
  00012	681a		 ldr         r2,[r3]
  00014	b182		 cbz         r2,|$LN1@CheckDevic|
  00016		 |$LL8@CheckDevic|
  00016	b964		 cbnz        r4,|$LN18@CheckDevic|

; 884  :         PDEVICE_STATE pdsTraveller;
; 885  :         for(pdsTraveller = pdl->pList; pdsTraveller != NULL; 

  00018	6853		 ldr         r3,[r2,#4]
  0001a	e002		 b           |$LN19@CheckDevic|
  0001c		 |$LL5@CheckDevic|

; 887  :             if(pdsTraveller == pds) {

  0001c	42ab		 cmp         r3,r5
  0001e	d003		 beq         |$LN13@CheckDevic|

; 886  :         pdsTraveller = pdsTraveller->pNext) {

  00020	6e9b		 ldr         r3,[r3,#0x68]
  00022		 |$LN19@CheckDevic|
  00022	2b00		 cmp         r3,#0
  00024	d1fa		 bne         |$LL5@CheckDevic|

; 887  :             if(pdsTraveller == pds) {

  00026	e000		 b           |$LN7@CheckDevic|
  00028		 |$LN13@CheckDevic|

; 888  :                 fFound = TRUE;

  00028	2401		 movs        r4,#1
  0002a		 |$LN7@CheckDevic|

; 883  :     for(pdl = gpDeviceLists; pdl != NULL && !fFound; pdl = pdl->pNext) {

  0002a	6952		 ldr         r2,[r2,#0x14]
  0002c	2a00		 cmp         r2,#0
  0002e	d1f2		 bne         |$LL8@CheckDevic|

; 889  :                 break;
; 890  :             }
; 891  :         }
; 892  :     }
; 893  : 
; 894  :     // did we find the device?
; 895  :     if(fFound) {

  00030	b114		 cbz         r4,|$LN1@CheckDevic|
  00032		 |$LN18@CheckDevic|

; 896  :         // yes, update its reference count
; 897  :         DeviceStateAddRef(pds);

  00032	4628		 mov         r0,r5
  00034	f000 f800	 bl          DeviceStateAddRef
  00038		 |$LN1@CheckDevic|

; 898  :     }
; 899  :     PMUNLOCK();

  00038	f000 f800	 bl          PmUnlock

; 900  : 
; 901  :     return fFound;
; 902  : }

  0003c	4620		 mov         r0,r4
  0003e		 |$M24|
  0003e	e8bd 8830	 pop         {r4,r5,r11,pc}
  00042		 |$LN27@CheckDevic|
  00042		 |$M28|
  00042	defe		 __debugbreak
  00044		 |$LN25@CheckDevic|
  00044		 |$LN26@CheckDevic|
  00044	0000 0000	 DCD         |gpDeviceLists|
  00048		 |$M22|

			 ENDP  ; |CheckDevicePointer|

	EXPORT	|??_C@_1IM@HFBHDBAF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9?$AA?$CF?$AA0?$AA4?$AAx@| [ DATA ] ; `string'
	EXPORT	|??_C@_1BK@CCPLAGJC@?$AAR?$AAe?$AAm?$AAo?$AAv?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DK@EFLIGDPP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAi?$AAn?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AAl?$AAi?$AAs?$AAt?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|RemoveDevice|
	IMPORT	|dpCurSettings|
	IMPORT	|GetDeviceListFromClass|
	IMPORT	|DeviceStateFindList|
	IMPORT	|DeviceStateRemList|
	IMPORT	|DeviceStateDecRef|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$RemoveDevice| DCD imagerel |$LN28@RemoveDevi|
	DCD	0x2f20189

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DK@EFLIGDPP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAi?$AAn?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AAl?$AAi?$AAs?$AAt?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, " ", 0x0, "n", 0x0, "o", 0x0, "t", 0x0, " "
	DCB	0x0, "i", 0x0, "n", 0x0, " ", 0x0, "c", 0x0, "l", 0x0, "a"
	DCB	0x0, "s", 0x0, "s", 0x0, " ", 0x0, "l", 0x0, "i", 0x0, "s"
	DCB	0x0, "t", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1BK@CCPLAGJC@?$AAR?$AAe?$AAm?$AAo?$AAv?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@| DCB "R"
	DCB	0x0, "e", 0x0, "m", 0x0, "o", 0x0, "v", 0x0, "e", 0x0, "D"
	DCB	0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1IM@HFBHDBAF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9?$AA?$CF?$AA0?$AA4?$AAx@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "m"
	DCB	0x0, "o", 0x0, "v", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " "
	DCB	0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'", 0x0, " ", 0x0, "f"
	DCB	0x0, "r", 0x0, "o", 0x0, "m", 0x0, " ", 0x0, "%", 0x0, "0"
	DCB	0x0, "8", 0x0, "x", 0x0, "-", 0x0, "%", 0x0, "0", 0x0, "4"
	DCB	0x0, "x", 0x0, "-", 0x0, "%", 0x0, "0", 0x0, "4", 0x0, "x"
	DCB	0x0, "-", 0x0, "%", 0x0, "0", 0x0, "4", 0x0, "x", 0x0, "-"
	DCB	0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0"
	DCB	0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x"
	DCB	0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0"
	DCB	0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x"
	DCB	0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0	; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |RemoveDevice| PROC

; 1056 : {

  00000		 |$LN28@RemoveDevi|
  00000	e92d 4870	 push        {r4-r6,r11,lr}
  00004	f20d 0b0c	 addw        r11,sp,#0xC
  00008	b08b		 sub         sp,sp,#0x2C
  0000a		 |$M26|

; 1057 :     SETFNAME(_T("RemoveDevice"));
; 1058 : 
; 1059 :     PMLOGMSG(ZONE_DEVICE, (_T("%s: removing '%s' from %08x-%04x-%04x-%04x-%02x%02x%02x%02x%02x%02x\r\n"), 
; 1060 :         pszFname, pszName, guidDevClass->Data1, guidDevClass->Data2, guidDevClass->Data3,
; 1061 :         (guidDevClass->Data4[0] << 8) + guidDevClass->Data4[1], guidDevClass->Data4[2], guidDevClass->Data4[3], 
; 1062 :         guidDevClass->Data4[4], guidDevClass->Data4[5], guidDevClass->Data4[6], guidDevClass->Data4[7]));

  0000a	4e32		 ldr         r6,|$LN35@RemoveDevi| ; =|dpCurSettings|
  0000c	460d		 mov         r5,r1
  0000e	4604		 mov         r4,r0
  00010	f8d6 3440	 ldr         r3,[r6,#0x440]
  00014	f013 0f10	 tst         r3,#0x10
  00018	d01a		 beq         |$LN14@RemoveDevi|
  0001a	7be3		 ldrb        r3,[r4,#0xF]
  0001c	7a22		 ldrb        r2,[r4,#8]
  0001e	482c		 ldr         r0,|$LN34@RemoveDevi| ; =|??_C@_1IM@HFBHDBAF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9?$AA?$CF?$AA0?$AA4?$AAx@|
  00020	9308		 str         r3,[sp,#0x20]
  00022	7ba3		 ldrb        r3,[r4,#0xE]
  00024	9307		 str         r3,[sp,#0x1C]
  00026	7b63		 ldrb        r3,[r4,#0xD]
  00028	9306		 str         r3,[sp,#0x18]
  0002a	7b23		 ldrb        r3,[r4,#0xC]
  0002c	9305		 str         r3,[sp,#0x14]
  0002e	7ae3		 ldrb        r3,[r4,#0xB]
  00030	9304		 str         r3,[sp,#0x10]
  00032	7aa3		 ldrb        r3,[r4,#0xA]
  00034	9303		 str         r3,[sp,#0xC]
  00036	7a63		 ldrb        r3,[r4,#9]
  00038	eb03 2302	 add         r3,r3,r2,lsl #8
  0003c	9302		 str         r3,[sp,#8]
  0003e	88e3		 ldrh        r3,[r4,#6]
  00040	460a		 mov         r2,r1
  00042	4921		 ldr         r1,|$LN32@RemoveDevi| ; =|??_C@_1BK@CCPLAGJC@?$AAR?$AAe?$AAm?$AAo?$AAv?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  00044	9301		 str         r3,[sp,#4]
  00046	88a3		 ldrh        r3,[r4,#4]
  00048	9300		 str         r3,[sp]
  0004a	6823		 ldr         r3,[r4]
  0004c	f000 f800	 bl          CeLogMsg
  00050		 |$LN14@RemoveDevi|

; 1063 : 
; 1064 :     // figure out onto which list this device should be added
; 1065 :     PDEVICE_LIST pdl = GetDeviceListFromClass(guidDevClass);

  00050	4620		 mov         r0,r4
  00052	f000 f800	 bl          GetDeviceListFromClass

; 1066 : 
; 1067 :     // did we find the list?
; 1068 :     if(pdl != NULL) {

  00056	b390		 cbz         r0,|$LN9@RemoveDevi|

; 1069 :         // check for duplicates
; 1070 :         PDEVICE_STATE pds = DeviceStateFindList(pdl, pszName);

  00058	4629		 mov         r1,r5
  0005a	f000 f800	 bl          DeviceStateFindList
  0005e	4604		 mov         r4,r0

; 1071 :         if(pds == NULL) {

  00060	b954		 cbnz        r4,|$LN10@RemoveDevi|

; 1072 :             PMLOGMSG(ZONE_WARN, (_T("%s: '%s' not in class list\r\n"),
; 1073 :                 pszFname, pszName));

  00062	f8d6 3440	 ldr         r3,[r6,#0x440]
  00066	f013 0f02	 tst         r3,#2
  0006a	d028		 beq         |$LN9@RemoveDevi|
  0006c	4817		 ldr         r0,|$LN33@RemoveDevi| ; =|??_C@_1DK@EFLIGDPP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAi?$AAn?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AAl?$AAi?$AAs?$AAt?$AA?$AN?$AA?6?$AA?$AA@|
  0006e	4916		 ldr         r1,|$LN32@RemoveDevi| ; =|??_C@_1BK@CCPLAGJC@?$AAR?$AAe?$AAm?$AAo?$AAv?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  00070	462a		 mov         r2,r5
  00072	f000 f800	 bl          CeLogMsg

; 1074 :         } else {

  00076	e022		 b           |$LN9@RemoveDevi|
  00078		 |$LN10@RemoveDevi|

; 1075 :             // disconnect the device from the list
; 1076 :             DeviceStateRemList(pds);

  00078	4620		 mov         r0,r4
  0007a	f000 f800	 bl          DeviceStateRemList

; 1077 :             
; 1078 :             // if we are a child device, decrement the parent pointer's
; 1079 :             // reference count
; 1080 :             if(pds->pParent != NULL) {

  0007e	6a60		 ldr         r0,[r4,#0x24]
  00080	b118		 cbz         r0,|$LN8@RemoveDevi|

; 1081 :                 DeviceStateDecRef(pds->pParent);

  00082	f000 f800	 bl          DeviceStateDecRef

; 1082 :                 pds->pParent = NULL;

  00086	2300		 movs        r3,#0
  00088	6263		 str         r3,[r4,#0x24]
  0008a		 |$LN8@RemoveDevi|

; 1083 :             }
; 1084 :             
; 1085 :             // if we are a parent device, remove child devices (if any)
; 1086 :             if((pds->caps.Flags & POWER_CAP_PARENT) != 0) {

  0008a	6d63		 ldr         r3,[r4,#0x54]
  0008c	f013 0f01	 tst         r3,#1
  00090	d012		 beq         |$LN4@RemoveDevi|

; 1087 :                 // look for a match across all lists, since the child may not
; 1088 :                 // be of the same class
; 1089 :                 for(pdl = gpDeviceLists; pdl != NULL; pdl = pdl->pNext) {

  00092	4b0c		 ldr         r3,|$LN31@RemoveDevi| ; =|gpDeviceLists|
  00094	681d		 ldr         r5,[r3]
  00096	e00d		 b           |$LN24@RemoveDevi|
  00098		 |$LL6@RemoveDevi|

; 1090 :                     PDEVICE_STATE pCur, pNext;
; 1091 :                     pCur = pdl->pList;

  00098	686a		 ldr         r2,[r5,#4]

; 1092 :                     while(pCur != NULL) {

  0009a	b152		 cbz         r2,|$LN5@RemoveDevi|
  0009c		 |$LL3@RemoveDevi|

; 1093 :                         pNext = pCur->pNext;
; 1094 :                         if(pCur->pParent == pds) {

  0009c	6a53		 ldr         r3,[r2,#0x24]
  0009e	6e96		 ldr         r6,[r2,#0x68]
  000a0	42a3		 cmp         r3,r4
  000a2	d103		 bne         |$LN1@RemoveDevi|

; 1095 :                             RemoveDevice(pdl->pGuid, pCur->pszName);

  000a4	6811		 ldr         r1,[r2]
  000a6	6828		 ldr         r0,[r5]
  000a8	f000 f800	 bl          RemoveDevice
  000ac		 |$LN1@RemoveDevi|

; 1096 :                         }
; 1097 :                         pCur = pNext;

  000ac	4632		 mov         r2,r6
  000ae	2e00		 cmp         r6,#0
  000b0	d1f4		 bne         |$LL3@RemoveDevi|
  000b2		 |$LN5@RemoveDevi|

; 1087 :                 // look for a match across all lists, since the child may not
; 1088 :                 // be of the same class
; 1089 :                 for(pdl = gpDeviceLists; pdl != NULL; pdl = pdl->pNext) {

  000b2	696d		 ldr         r5,[r5,#0x14]
  000b4		 |$LN24@RemoveDevi|
  000b4	2d00		 cmp         r5,#0
  000b6	d1ef		 bne         |$LL6@RemoveDevi|
  000b8		 |$LN4@RemoveDevi|

; 1098 :                     }
; 1099 :                 }
; 1100 :             }
; 1101 :             
; 1102 :             // we're done with the device pointer
; 1103 :             DeviceStateDecRef(pds);

  000b8	4620		 mov         r0,r4
  000ba	f000 f800	 bl          DeviceStateDecRef
  000be		 |$LN9@RemoveDevi|
  000be		 |$M29|

; 1104 :         }
; 1105 :     }
; 1106 : }

  000be	b00b		 add         sp,sp,#0x2C
  000c0	e8bd 8870	 pop         {r4-r6,r11,pc}
  000c4		 |$LN30@RemoveDevi|
  000c4		 |$LN31@RemoveDevi|
  000c4	0000 0000	 DCD         |gpDeviceLists|
  000c8		 |$LN32@RemoveDevi|
  000c8	0000 0000	 DCD         |??_C@_1BK@CCPLAGJC@?$AAR?$AAe?$AAm?$AAo?$AAv?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  000cc		 |$LN33@RemoveDevi|
  000cc	0000 0000	 DCD         |??_C@_1DK@EFLIGDPP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAi?$AAn?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AAl?$AAi?$AAs?$AAt?$AA?$AN?$AA?6?$AA?$AA@|
  000d0		 |$LN34@RemoveDevi|
  000d0	0000 0000	 DCD         |??_C@_1IM@HFBHDBAF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9?$AA?$CF?$AA0?$AA4?$AAx@|
  000d4		 |$LN35@RemoveDevi|
  000d4	0000 0000	 DCD         |dpCurSettings|
  000d8		 |$M27|

			 ENDP  ; |RemoveDevice|

	EXPORT	|??_C@_1DK@KOLEMAMB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAp?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AAo?$AAf?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1BO@OMCCOOEP@?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DC@NDCGFHLP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GK@HFOAPAGC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAG?$AAE?$AAT?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAe@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GA@IIJMLOP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAG?$AAE?$AAT?$AA?0@| [ DATA ] ; `string'
	EXPORT	|?GetDevicePower@@YAKPAU_DeviceState_tag@@PAW4_CEDEVICE_POWER_STATE@@@Z| ; GetDevicePower
	IMPORT	|GetLastError|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$?GetDevicePower@@YAKPAU_DeviceState_tag@@PAW4_CEDEVICE_POWER_STATE@@@Z| DCD imagerel |$LN27@GetDeviceP|
	DCD	0x2f60229

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GA@IIJMLOP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAG?$AAE?$AAT?$AA?0@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, " ", 0x0, "f", 0x0, "a", 0x0, "i", 0x0, "l"
	DCB	0x0, "e", 0x0, "d", 0x0, " ", 0x0, "I", 0x0, "O", 0x0, "C"
	DCB	0x0, "T", 0x0, "L", 0x0, "_", 0x0, "P", 0x0, "O", 0x0, "W"
	DCB	0x0, "E", 0x0, "R", 0x0, "_", 0x0, "G", 0x0, "E", 0x0, "T"
	DCB	0x0, ",", 0x0, " ", 0x0, "s", 0x0, "t", 0x0, "a", 0x0, "t"
	DCB	0x0, "u", 0x0, "s", 0x0, " ", 0x0, "i", 0x0, "s", 0x0, " "
	DCB	0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GK@HFOAPAGC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAG?$AAE?$AAT?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAe@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, " ", 0x0, "I", 0x0, "O", 0x0, "C", 0x0, "T"
	DCB	0x0, "L", 0x0, "_", 0x0, "P", 0x0, "O", 0x0, "W", 0x0, "E"
	DCB	0x0, "R", 0x0, "_", 0x0, "G", 0x0, "E", 0x0, "T", 0x0, " "
	DCB	0x0, "r", 0x0, "e", 0x0, "t", 0x0, "u", 0x0, "r", 0x0, "n"
	DCB	0x0, "e", 0x0, "d", 0x0, " ", 0x0, "i", 0x0, "n", 0x0, "v"
	DCB	0x0, "a", 0x0, "l", 0x0, "i", 0x0, "d", 0x0, " ", 0x0, "s"
	DCB	0x0, "t", 0x0, "a", 0x0, "t", 0x0, "e", 0x0, " ", 0x0, "%"
	DCB	0x0, "u", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DC@NDCGFHLP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "c", 0x0, "o", 0x0, "u"
	DCB	0x0, "l", 0x0, "d", 0x0, "n", 0x0, "'", 0x0, "t", 0x0, " "
	DCB	0x0, "o", 0x0, "p", 0x0, "e", 0x0, "n", 0x0, " ", 0x0, "'"
	DCB	0x0, "%", 0x0, "s", 0x0, "'", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1BO@OMCCOOEP@?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@| DCB "G"
	DCB	0x0, "e", 0x0, "t", 0x0, "D", 0x0, "e", 0x0, "v", 0x0, "i"
	DCB	0x0, "c", 0x0, "e", 0x0, "P", 0x0, "o", 0x0, "w", 0x0, "e"
	DCB	0x0, "r", 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DK@KOLEMAMB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAp?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AAo?$AAf?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "p", 0x0, "a", 0x0, "r"
	DCB	0x0, "e", 0x0, "n", 0x0, "t", 0x0, " ", 0x0, "o", 0x0, "f"
	DCB	0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'", 0x0, " "
	DCB	0x0, "i", 0x0, "s", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |?GetDevicePower@@YAKPAU_DeviceState_tag@@PAW4_CEDEVICE_POWER_STATE@@@Z| PROC ; GetDevicePower

; 263  : {

  00000		 |$LN27@GetDeviceP|
  00000	e92d 4ff0	 push        {r4-r11,lr}
  00004	f20d 0b1c	 addw        r11,sp,#0x1C
  00008	b08b		 sub         sp,sp,#0x2C
  0000a		 |$M25|
  0000a	4605		 mov         r5,r0

; 264  :     DWORD dwStatus = ERROR_GEN_FAILURE;
; 265  :     POWER_RELATIONSHIP pr;
; 266  :     PPOWER_RELATIONSHIP ppr = NULL;
; 267  :     BOOL fOpenDevice;
; 268  :     HANDLE hDevice;
; 269  :     SETFNAME(_T("GetDevicePower"));
; 270  : 
; 271  :     PREFAST_DEBUGCHK(pds != NULL );
; 272  :     PREFAST_DEBUGCHK(pCurDx != NULL);
; 273  :     PREFAST_DEBUGCHK(pds->pInterface != NULL);
; 274  : 
; 275  :     // initialize parameters
; 276  :     memset(&pr, 0, sizeof(pr));
; 277  :     if(pds->pParent != NULL) {

  0000c	6a6a		 ldr         r2,[r5,#0x24]
  0000e	2300		 movs        r3,#0
  00010	4f46		 ldr         r7,|$LN36@GetDeviceP| ; =|dpCurSettings|
  00012	241f		 movs        r4,#0x1F
  00014	f04f 0800	 mov         r8,#0
  00018	468a		 mov         r10,r1
  0001a	9306		 str         r3,[sp,#0x18]
  0001c	9307		 str         r3,[sp,#0x1C]
  0001e	9308		 str         r3,[sp,#0x20]
  00020	9309		 str         r3,[sp,#0x24]
  00022	b19a		 cbz         r2,|$LN23@GetDeviceP|

; 278  :         PMLOGMSG(ZONE_DEVICE, (_T("%s: parent of '%s' is '%s'\r\n"), 
; 279  :             pszFname, pds->pszName, pds->pParent->pszName));

  00024	f8d7 3440	 ldr         r3,[r7,#0x440]
  00028	f013 0f10	 tst         r3,#0x10
  0002c	d005		 beq         |$LN13@GetDeviceP|
  0002e	6813		 ldr         r3,[r2]
  00030	682a		 ldr         r2,[r5]
  00032	483d		 ldr         r0,|$LN35@GetDeviceP| ; =|??_C@_1DK@KOLEMAMB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAp?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AAo?$AAf?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  00034	4938		 ldr         r1,|$LN31@GetDeviceP| ; =|??_C@_1BO@OMCCOOEP@?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  00036	f000 f800	 bl          CeLogMsg
  0003a		 |$LN13@GetDeviceP|

; 280  :         pr.hParent = (HANDLE) pds->pParent;

  0003a	6a6b		 ldr         r3,[r5,#0x24]

; 281  :         pr.pwsParent = pds->pParent->pszName;
; 282  :         pr.hChild = (HANDLE) pds;
; 283  :         pr.pwsChild = pds->pszName;
; 284  :         ppr = &pr;

  0003c	f10d 0818	 add         r8,sp,#0x18
  00040	9306		 str         r3,[sp,#0x18]
  00042	681b		 ldr         r3,[r3]
  00044	9508		 str         r5,[sp,#0x20]
  00046	9307		 str         r3,[sp,#0x1C]
  00048	682b		 ldr         r3,[r5]
  0004a	9309		 str         r3,[sp,#0x24]
  0004c		 |$LN23@GetDeviceP|

; 285  :     }
; 286  :     
; 287  :     // get a handle to the device
; 288  :     hDevice = pds->hDevice;

  0004c	6dee		 ldr         r6,[r5,#0x5C]

; 289  :     if(hDevice != INVALID_HANDLE_VALUE) {

  0004e	f1b6 3fff	 cmp         r6,#0xFFFFFFFF
  00052	d002		 beq         |$LN9@GetDeviceP|

; 290  :         fOpenDevice = FALSE;    // already have a handle

  00054	f04f 0900	 mov         r9,#0

; 291  :     } else {

  00058	e006		 b           |$LN8@GetDeviceP|
  0005a		 |$LN9@GetDeviceP|

; 292  :         fOpenDevice = TRUE;     // need to open a handle
; 293  :         DEBUGCHK(pds->pInterface->pfnOpenDevice != NULL);
; 294  :         hDevice = pds->pInterface->pfnOpenDevice(pds);

  0005a	6e2b		 ldr         r3,[r5,#0x60]
  0005c	4628		 mov         r0,r5
  0005e	f04f 0901	 mov         r9,#1
  00062	685b		 ldr         r3,[r3,#4]
  00064	4798		 blx         r3
  00066	4606		 mov         r6,r0
  00068		 |$LN8@GetDeviceP|

; 295  :     }
; 296  : 
; 297  :     // did we get a handle?
; 298  :     if(hDevice == INVALID_HANDLE_VALUE) {

  00068	f1b6 3fff	 cmp         r6,#0xFFFFFFFF
  0006c	d10a		 bne         |$LN7@GetDeviceP|

; 299  :         PMLOGMSG(ZONE_WARN, (_T("%s: couldn't open '%s'\r\n"), pszFname,
; 300  :             pds->pszName));

  0006e	f8d7 3440	 ldr         r3,[r7,#0x440]
  00072	f013 0f02	 tst         r3,#2
  00076	d049		 beq         |$LN1@GetDeviceP|
  00078	682a		 ldr         r2,[r5]
  0007a	482a		 ldr         r0,|$LN34@GetDeviceP| ; =|??_C@_1DC@NDCGFHLP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  0007c	4926		 ldr         r1,|$LN31@GetDeviceP| ; =|??_C@_1BO@OMCCOOEP@?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  0007e	f000 f800	 bl          CeLogMsg

; 301  :     } else {

  00082	e043		 b           |$LN1@GetDeviceP|
  00084		 |$LN7@GetDeviceP|

; 302  :         CEDEVICE_POWER_STATE tmpDx = PwrDeviceUnspecified;

  00084	f06f 0300	 mvn         r3,#0
  00088	9304		 str         r3,[sp,#0x10]

; 303  :         DWORD dwBytesReturned;
; 304  :         DEBUGCHK(pds->pInterface->pfnRequestDevice != NULL);
; 305  :         BOOL fOk = pds->pInterface->pfnRequestDevice(hDevice, IOCTL_POWER_GET, ppr, 
; 306  :             ppr == NULL ? 0 : sizeof(*ppr), &tmpDx, sizeof(tmpDx), 
; 307  :             &dwBytesReturned);

  0008a	f1b8 0f00	 cmp         r8,#0
  0008e	d101		 bne         |$LN17@GetDeviceP|
  00090	2300		 movs        r3,#0
  00092	e000		 b           |$LN18@GetDeviceP|
  00094		 |$LN17@GetDeviceP|
  00094	2310		 movs        r3,#0x10
  00096		 |$LN18@GetDeviceP|
  00096	a905		 add         r1,sp,#0x14
  00098	6e2c		 ldr         r4,[r5,#0x60]
  0009a	9102		 str         r1,[sp,#8]
  0009c	a904		 add         r1,sp,#0x10
  0009e	68e4		 ldr         r4,[r4,#0xC]
  000a0	9100		 str         r1,[sp]
  000a2	491f		 ldr         r1,|$LN33@GetDeviceP| ; =0x321004
  000a4	2204		 movs        r2,#4
  000a6	9201		 str         r2,[sp,#4]
  000a8	4642		 mov         r2,r8
  000aa	4630		 mov         r0,r6
  000ac	47a0		 blx         r4
  000ae	4680		 mov         r8,r0

; 308  :         
; 309  :         // update variables and clear the requestor thread ID
; 310  :         if(fOk) {

  000b0	b190		 cbz         r0,|$LN5@GetDeviceP|

; 311  :             if(VALID_DX(tmpDx)) {

  000b2	9b04		 ldr         r3,[sp,#0x10]
  000b4	2b04		 cmp         r3,#4
  000b6	d803		 bhi         |$LN4@GetDeviceP|

; 312  :                 *pCurDx = tmpDx;

  000b8	f8ca 3000	 str         r3,[r10]

; 313  :                 dwStatus = ERROR_SUCCESS;

  000bc	2400		 movs        r4,#0

; 314  :             } else {

  000be	e00e		 b           |$LN2@GetDeviceP|
  000c0		 |$LN4@GetDeviceP|
  000c0	f8d7 2440	 ldr         r2,[r7,#0x440]

; 315  :                 PMLOGMSG(ZONE_WARN, 
; 316  :                     (_T("%s: '%s' IOCTL_POWER_GET returned invalid state %u\r\n"),
; 317  :                     pszFname, pds->pszName, tmpDx));

  000c4	f012 0f02	 tst         r2,#2
  000c8	d004		 beq         |$LN19@GetDeviceP|
  000ca	682a		 ldr         r2,[r5]
  000cc	4813		 ldr         r0,|$LN32@GetDeviceP| ; =|??_C@_1GK@HFOAPAGC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAG?$AAE?$AAT?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAe@|
  000ce	4912		 ldr         r1,|$LN31@GetDeviceP| ; =|??_C@_1BO@OMCCOOEP@?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  000d0	f000 f800	 bl          CeLogMsg
  000d4		 |$LN19@GetDeviceP|

; 318  :                 dwStatus = ERROR_INVALID_DATA;

  000d4	240d		 movs        r4,#0xD

; 319  :             }
; 320  :         } else {

  000d6	e002		 b           |$LN2@GetDeviceP|
  000d8		 |$LN5@GetDeviceP|

; 321  :             dwStatus = GetLastError();

  000d8	f000 f800	 bl          GetLastError
  000dc	4604		 mov         r4,r0
  000de		 |$LN2@GetDeviceP|

; 322  :         }
; 323  :         
; 324  :         PMLOGMSG(!fOk && ZONE_WARN, 
; 325  :             (_T("%s: '%s' failed IOCTL_POWER_GET, status is %d\r\n"),
; 326  :             pszFname, pds->pszName, GetLastError()));

  000de	f1b8 0f00	 cmp         r8,#0
  000e2	d10c		 bne         |$LN21@GetDeviceP|
  000e4	f8d7 3440	 ldr         r3,[r7,#0x440]
  000e8	f013 0f02	 tst         r3,#2
  000ec	d007		 beq         |$LN21@GetDeviceP|
  000ee	f000 f800	 bl          GetLastError
  000f2	682a		 ldr         r2,[r5]
  000f4	4908		 ldr         r1,|$LN31@GetDeviceP| ; =|??_C@_1BO@OMCCOOEP@?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  000f6	4603		 mov         r3,r0
  000f8	4806		 ldr         r0,|$LN30@GetDeviceP| ; =|??_C@_1GA@IIJMLOP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAG?$AAE?$AAT?$AA?0@|
  000fa	f000 f800	 bl          CeLogMsg
  000fe		 |$LN21@GetDeviceP|

; 327  :         
; 328  :         // close the device handle if we opened it in this routine
; 329  :         if(fOpenDevice) {

  000fe	f1b9 0f00	 cmp         r9,#0
  00102	d003		 beq         |$LN1@GetDeviceP|

; 330  :             DEBUGCHK(pds->pInterface->pfnCloseDevice != NULL);
; 331  :             pds->pInterface->pfnCloseDevice(hDevice);

  00104	6e2b		 ldr         r3,[r5,#0x60]
  00106	4630		 mov         r0,r6
  00108	689b		 ldr         r3,[r3,#8]
  0010a	4798		 blx         r3
  0010c		 |$LN1@GetDeviceP|

; 332  :         }
; 333  :     }
; 334  : 
; 335  :     return dwStatus;
; 336  : }

  0010c	4620		 mov         r0,r4
  0010e		 |$M28|
  0010e	b00b		 add         sp,sp,#0x2C
  00110	e8bd 8ff0	 pop         {r4-r11,pc}
  00114		 |$LN29@GetDeviceP|
  00114		 |$LN30@GetDeviceP|
  00114	0000 0000	 DCD         |??_C@_1GA@IIJMLOP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAG?$AAE?$AAT?$AA?0@|
  00118		 |$LN31@GetDeviceP|
  00118	0000 0000	 DCD         |??_C@_1BO@OMCCOOEP@?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  0011c		 |$LN32@GetDeviceP|
  0011c	0000 0000	 DCD         |??_C@_1GK@HFOAPAGC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAG?$AAE?$AAT?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAe@|
  00120		 |$LN33@GetDeviceP|
  00120	1004 0032	 DCD         0x321004
  00124		 |$LN34@GetDeviceP|
  00124	0000 0000	 DCD         |??_C@_1DC@NDCGFHLP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  00128		 |$LN35@GetDeviceP|
  00128	0000 0000	 DCD         |??_C@_1DK@KOLEMAMB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAp?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AAo?$AAf?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  0012c		 |$LN36@GetDeviceP|
  0012c	0000 0000	 DCD         |dpCurSettings|
  00130		 |$M26|

			 ENDP  ; |?GetDevicePower@@YAKPAU_DeviceState_tag@@PAW4_CEDEVICE_POWER_STATE@@@Z|, GetDevicePower

	EXPORT	|??_C@_1DC@CFFCEDAO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAm?$AAa?$AAp?$AAp?$AAi?$AAn?$AAg?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAt?$AAo?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1CI@EKDAOMCN@?$AAM?$AAa?$AAp?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|?MapDevicePowerState@@YA?AW4_CEDEVICE_POWER_STATE@@W41@E@Z| ; MapDevicePowerState

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$?MapDevicePowerState@@YA?AW4_CEDEVICE_POWER_STATE@@W41@E@Z| DCD imagerel |$LN14@MapDeviceP|
	DCD	0xfd3060c5

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1CI@EKDAOMCN@?$AAM?$AAa?$AAp?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@| DCB "M"
	DCB	0x0, "a", 0x0, "p", 0x0, "D", 0x0, "e", 0x0, "v", 0x0, "i"
	DCB	0x0, "c", 0x0, "e", 0x0, "P", 0x0, "o", 0x0, "w", 0x0, "e"
	DCB	0x0, "r", 0x0, "S", 0x0, "t", 0x0, "a", 0x0, "t", 0x0, "e"
	DCB	0x0, 0x0, 0x0				; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DC@CFFCEDAO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAm?$AAa?$AAp?$AAp?$AAi?$AAn?$AAg?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAt?$AAo?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "m", 0x0, "a", 0x0, "p"
	DCB	0x0, "p", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " ", 0x0, "D"
	DCB	0x0, "%", 0x0, "d", 0x0, " ", 0x0, "t", 0x0, "o", 0x0, " "
	DCB	0x0, "D", 0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |?MapDevicePowerState@@YA?AW4_CEDEVICE_POWER_STATE@@W41@E@Z| PROC ; MapDevicePowerState

; 32   : {

  00000		 |$LN14@MapDeviceP|
  00000	e92d 4818	 push        {r3,r4,r11,lr}
  00004	f20d 0b08	 addw        r11,sp,#8
  00008		 |$M12|
  00008	4602		 mov         r2,r0

; 33   :     CEDEVICE_POWER_STATE reqDx;
; 34   :     SETFNAME(_T("MapDevicePowerState"));
; 35   : 
; 36   :     DEBUGCHK(newDx >= D0 && newDx <= D4);
; 37   : 
; 38   :     // map the power level to whatever the device actually supports.  All devices
; 39   :     // are required to support D0 so we won't even check for it.
; 40   :     reqDx = newDx;
; 41   :     if(reqDx == D3 && (ucSupportedDx & (1 << reqDx)) == 0) reqDx = D4;

  0000a	2a03		 cmp         r2,#3
  0000c	4604		 mov         r4,r0
  0000e	d103		 bne         |$LN6@MapDeviceP|
  00010	f011 0f08	 tst         r1,#8
  00014	d117		 bne         |$LN1@MapDeviceP|
  00016	2404		 movs        r4,#4
  00018		 |$LN6@MapDeviceP|

; 42   :     if(reqDx == D4) {

  00018	2c04		 cmp         r4,#4
  0001a	d108		 bne         |$LN3@MapDeviceP|

; 43   :         if((ucSupportedDx & (1 << reqDx)) == 0) reqDx = D3;

  0001c	f011 0f10	 tst         r1,#0x10
  00020	d100		 bne         |$LN4@MapDeviceP|
  00022	2403		 movs        r4,#3
  00024		 |$LN4@MapDeviceP|

; 44   :         if((ucSupportedDx & (1 << reqDx)) == 0) reqDx = D2;

  00024	2301		 movs        r3,#1
  00026	40a3		 lsls        r3,r3,r4
  00028	420b		 tst         r3,r1
  0002a	d100		 bne         |$LN3@MapDeviceP|
  0002c	2402		 movs        r4,#2
  0002e		 |$LN3@MapDeviceP|

; 45   :     }
; 46   :     if(reqDx == D2 && (ucSupportedDx & (1 << reqDx)) == 0) reqDx = D1;

  0002e	2c02		 cmp         r4,#2
  00030	d103		 bne         |$LN2@MapDeviceP|
  00032	f011 0f04	 tst         r1,#4
  00036	d106		 bne         |$LN1@MapDeviceP|
  00038	2401		 movs        r4,#1
  0003a		 |$LN2@MapDeviceP|

; 47   :     if(reqDx == D1 && (ucSupportedDx & (1 << reqDx)) == 0) reqDx = D0;

  0003a	2c01		 cmp         r4,#1
  0003c	d103		 bne         |$LN1@MapDeviceP|
  0003e	f011 0f02	 tst         r1,#2
  00042	d100		 bne         |$LN1@MapDeviceP|
  00044	2400		 movs        r4,#0
  00046		 |$LN1@MapDeviceP|

; 48   : 
; 49   :     PMLOGMSG(ZONE_DEVICE, (_T("%s: mapping D%d to D%d\r\n"), pszFname, newDx, reqDx));

  00046	4b09		 ldr         r3,|$LN19@MapDeviceP| ; =|dpCurSettings|
  00048	f8d3 3440	 ldr         r3,[r3,#0x440]
  0004c	f013 0f10	 tst         r3,#0x10
  00050	d004		 beq         |$LN9@MapDeviceP|
  00052	4905		 ldr         r1,|$LN18@MapDeviceP| ; =|??_C@_1CI@EKDAOMCN@?$AAM?$AAa?$AAp?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  00054	4803		 ldr         r0,|$LN17@MapDeviceP| ; =|??_C@_1DC@CFFCEDAO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAm?$AAa?$AAp?$AAp?$AAi?$AAn?$AAg?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAt?$AAo?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  00056	4623		 mov         r3,r4
  00058	f000 f800	 bl          CeLogMsg
  0005c		 |$LN9@MapDeviceP|

; 50   :     return reqDx;
; 51   : }

  0005c	4620		 mov         r0,r4
  0005e		 |$M15|
  0005e	e8bd 8818	 pop         {r3,r4,r11,pc}
  00062		 |$LN20@MapDeviceP|
  00062		 |$M21|
  00062	defe		 __debugbreak
  00064		 |$LN16@MapDeviceP|
  00064		 |$LN17@MapDeviceP|
  00064	0000 0000	 DCD         |??_C@_1DC@CFFCEDAO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAm?$AAa?$AAp?$AAp?$AAi?$AAn?$AAg?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAt?$AAo?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  00068		 |$LN18@MapDeviceP|
  00068	0000 0000	 DCD         |??_C@_1CI@EKDAOMCN@?$AAM?$AAa?$AAp?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  0006c		 |$LN19@MapDeviceP|
  0006c	0000 0000	 DCD         |dpCurSettings|
  00070		 |$M13|

			 ENDP  ; |?MapDevicePowerState@@YA?AW4_CEDEVICE_POWER_STATE@@W41@E@Z|, MapDevicePowerState

	EXPORT	|??_C@_1BE@GFCJAFPH@?$AA?$DM?$AAU?$AAN?$AAK?$AAN?$AAO?$AAW?$AAN?$AA?$DO?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DO@JJNOBOEP@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?$CF?$AAs?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1CC@DCKKIOFN@?$AAP?$AAm?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1EO@PIOCINDE@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAe?$AAx?$AAc?$AAe?$AAp?$AAt?$AAi?$AAo?$AAn?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAp?$AAC?$AAu?$AAr?$AAD?$AAx?$AA?5?$AA0?$AAx@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DK@LJCCBMHG@?$AA?9?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAw?$AAS?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|PmGetDevicePower|
	IMPORT	|__C_specific_handler|
	IMPORT	|DeviceIdParseNameString|
	IMPORT	|DeviceIdDestroy|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$PmGetDevicePower| DCD imagerel |$LN40@PmGetDevic|
	DCD	imagerel |$unwind2$PmGetDevicePower|

  00000			 AREA	 |.xdata|, DATA
|$unwind2$PmGetDevicePower| DCD 0x33300082
	DCD	0xfeaffcc7
	DCD	0x5efff04
	DCD	0xff
	DCD	imagerel |__C_specific_handler|
	DCD	0x1
	DCD	imagerel |$LN27@PmGetDevic|
	DCD	imagerel |$LN28@PmGetDevic|
	DCD	0x1
	DCD	imagerel |$LN24@PmGetDevic|

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DK@LJCCBMHG@?$AA?9?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAw?$AAS?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| DCB "-"
	DCB	0x0, "%", 0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "e"
	DCB	0x0, "t", 0x0, "u", 0x0, "r", 0x0, "n", 0x0, "i", 0x0, "n"
	DCB	0x0, "g", 0x0, " ", 0x0, "d", 0x0, "w", 0x0, "S", 0x0, "t"
	DCB	0x0, "a", 0x0, "t", 0x0, "u", 0x0, "s", 0x0, " ", 0x0, "%"
	DCB	0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EO@PIOCINDE@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAe?$AAx?$AAc?$AAe?$AAp?$AAt?$AAi?$AAo?$AAn?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAp?$AAC?$AAu?$AAr?$AAD?$AAx?$AA?5?$AA0?$AAx@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "e", 0x0, "x", 0x0, "c"
	DCB	0x0, "e", 0x0, "p", 0x0, "t", 0x0, "i", 0x0, "o", 0x0, "n"
	DCB	0x0, " ", 0x0, "u", 0x0, "p", 0x0, "d", 0x0, "a", 0x0, "t"
	DCB	0x0, "i", 0x0, "n", 0x0, "g", 0x0, " ", 0x0, "p", 0x0, "C"
	DCB	0x0, "u", 0x0, "r", 0x0, "D", 0x0, "x", 0x0, " ", 0x0, "0"
	DCB	0x0, "x", 0x0, "%", 0x0, "0", 0x0, "8", 0x0, "x", 0x0, 0xd
	DCB	0x0, 0xa, 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1CC@DCKKIOFN@?$AAP?$AAm?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@| DCB "P"
	DCB	0x0, "m", 0x0, "G", 0x0, "e", 0x0, "t", 0x0, "D", 0x0, "e"
	DCB	0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, "P", 0x0, "o"
	DCB	0x0, "w", 0x0, "e", 0x0, "r", 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DO@JJNOBOEP@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?$CF?$AAs?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?$AN?$AA?6?$AA?$AA@| DCB "+"
	DCB	0x0, "%", 0x0, "s", 0x0, ":", 0x0, " ", 0x0, "d", 0x0, "e"
	DCB	0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, " ", 0x0, "%"
	DCB	0x0, "s", 0x0, ",", 0x0, " ", 0x0, "f", 0x0, "l", 0x0, "a"
	DCB	0x0, "g", 0x0, "s", 0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%"
	DCB	0x0, "0", 0x0, "8", 0x0, "x", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1BE@GFCJAFPH@?$AA?$DM?$AAU?$AAN?$AAK?$AAN?$AAO?$AAW?$AAN?$AA?$DO?$AA?$AA@| DCB "<"
	DCB	0x0, "U", 0x0, "N", 0x0, "K", 0x0, "N", 0x0, "O", 0x0, "W"
	DCB	0x0, "N", 0x0, ">", 0x0, 0x0, 0x0	; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |PmGetDevicePower| PROC

; 1115 : {

  00000		 |$LN40@PmGetDevic|
  00000	b40f		 push        {r0-r3}
  00002	e92d 4ffe	 push        {r1-r11,lr}
  00006	f20d 0b28	 addw        r11,sp,#0x28
  0000a	466f		 mov         r7,sp
  0000c		 |$LN38@PmGetDevic|
  0000c	4692		 mov         r10,r2
  0000e	63ba		 str         r2,[r7,#0x38]
  00010	4689		 mov         r9,r1
  00012	4606		 mov         r6,r0

; 1116 :     DWORD dwStatus = ERROR_FILE_NOT_FOUND;

  00014	2402		 movs        r4,#2

; 1117 :     PDEVICEID pdi = NULL;

  00016	f04f 0800	 mov         r8,#0

; 1118 :     SETFNAME(_T("PmGetDevicePower"));
; 1119 : 
; 1120 :     PMLOGMSG(ZONE_API || ZONE_DEVICE, (_T("+%s: device %s, flags 0x%08x\r\n"),
; 1121 :         pszFname, (dwDeviceFlags & POWER_NAME) != 0 ? (LPTSTR) pvDevice : _T("<UNKNOWN>"),
; 1122 :         dwDeviceFlags));

  0001a	4d3d		 ldr         r5,|$LN47@PmGetDevic| ; =|dpCurSettings|
  0001c	f8d5 3440	 ldr         r3,[r5,#0x440]
  00020	f413 6f00	 tst         r3,#0x800
  00024	d102		 bne         |$LN13@PmGetDevic|
  00026	f013 0f10	 tst         r3,#0x10
  0002a	d00a		 beq         |$LN16@PmGetDevic|
  0002c		 |$LN13@PmGetDevic|
  0002c	f019 0f01	 tst         r9,#1
  00030	d001		 beq         |$LN14@PmGetDevic|
  00032	4632		 mov         r2,r6
  00034	e000		 b           |$LN15@PmGetDevic|
  00036		 |$LN14@PmGetDevic|
  00036	4a38		 ldr         r2,|$LN49@PmGetDevic| ; =|??_C@_1BE@GFCJAFPH@?$AA?$DM?$AAU?$AAN?$AAK?$AAN?$AAO?$AAW?$AAN?$AA?$DO?$AA?$AA@|
  00038		 |$LN15@PmGetDevic|
  00038	4836		 ldr         r0,|$LN48@PmGetDevic| ; =|??_C@_1DO@JJNOBOEP@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?$CF?$AAs?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?$AN?$AA?6?$AA?$AA@|
  0003a	464b		 mov         r3,r9
  0003c	4931		 ldr         r1,|$LN44@PmGetDevic| ; =|??_C@_1CC@DCKKIOFN@?$AAP?$AAm?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  0003e	f000 f800	 bl          CeLogMsg
  00042		 |$LN16@PmGetDevic|

; 1123 : 
; 1124 :     // sanity check parameters
; 1125 :     if(pvDevice == NULL 
; 1126 :     || pCurDx == NULL
; 1127 :     || (pdi = DeviceIdParseNameString((LPCTSTR) pvDevice, dwDeviceFlags)) == NULL) {

  00042	2e00		 cmp         r6,#0
  00044	d041		 beq         |$LN35@PmGetDevic|
  00046	f1ba 0f00	 cmp         r10,#0
  0004a	d03e		 beq         |$LN35@PmGetDevic|
  0004c	4649		 mov         r1,r9
  0004e	4630		 mov         r0,r6
  00050	f000 f800	 bl          DeviceIdParseNameString
  00054	4680		 mov         r8,r0
  00056	6078		 str         r0,[r7,#4]
  00058	b3b8		 cbz         r0,|$LN35@PmGetDevic|

; 1129 :     } else {
; 1130 :         PDEVICE_LIST pdl;
; 1131 :         
; 1132 :         // look for the device list and the device
; 1133 :         pdl = GetDeviceListFromClass(pdi->pGuid);

  0005a	f8d0 0000	 ldr.w       r0,[r0]
  0005e	f000 f800	 bl          GetDeviceListFromClass

; 1134 :         if(pdl != NULL) {

  00062	b398		 cbz         r0,|$LN36@PmGetDevic|

; 1135 :             PDEVICE_STATE pds = DeviceStateFindList(pdl, pdi->pszName);

  00064	f8d8 1004	 ldr         r1,[r8,#4]
  00068	f000 f800	 bl          DeviceStateFindList
  0006c	4606		 mov         r6,r0
  0006e	60be		 str         r6,[r7,#8]

; 1136 :             if(pds != NULL) {

  00070	b366		 cbz         r6,|$LN36@PmGetDevic|

; 1137 :                 CEDEVICE_POWER_STATE curDx = PwrDeviceUnspecified;

  00072	f06f 0300	 mvn         r3,#0
  00076	603b		 str         r3,[r7]

; 1138 : 
; 1139 :                 // how are we supposed to obtain the data?
; 1140 :                 if((dwDeviceFlags & POWER_FORCE) == 0) {

  00078	f419 5f80	 tst         r9,#0x1000
  0007c	d107		 bne         |$LN5@PmGetDevic|

; 1141 :                     // use our cached value
; 1142 :                     PMLOCK();

  0007e	f000 f800	 bl          PmLock

; 1143 :                     curDx = pds->curDx;

  00082	f8d6 9004	 ldr         r9,[r6,#4]

; 1144 :                     PMUNLOCK();

  00086	f000 f800	 bl          PmUnlock

; 1145 :                     dwStatus = ERROR_SUCCESS;

  0008a	2400		 movs        r4,#0

; 1146 :                 } else {

  0008c	e007		 b           |$LN32@PmGetDevic|
  0008e		 |$LN5@PmGetDevic|

; 1147 :                     // request the device's power status
; 1148 :                     dwStatus = GetDevicePower(pds, &curDx);

  0008e	4639		 mov         r1,r7
  00090	4630		 mov         r0,r6
  00092	f000 f800	 bl          |?GetDevicePower@@YAKPAU_DeviceState_tag@@PAW4_CEDEVICE_POWER_STATE@@@Z|
  00096	4604		 mov         r4,r0

; 1149 :                 }
; 1150 : 
; 1151 :                 // do we have a value to pass back?
; 1152 :                 if(dwStatus == ERROR_SUCCESS) {

  00098	b99c		 cbnz        r4,|$LN29@PmGetDevic|
  0009a	f8d7 9000	 ldr         r9,[r7]
  0009e		 |$LN32@PmGetDevic|
  0009e		 |$LN27@PmGetDevic|

; 1153 :                     __try {
; 1154 :                         // yes, update the caller's parameter
; 1155 :                         *pCurDx = curDx;

  0009e	f8ca 9000	 str         r9,[r10]
  000a2		 |$LN28@PmGetDevic|

; 1156 :                     }

  000a2	e00e		 b           |$LN29@PmGetDevic|
  000a4		 |$LN24@PmGetDevic|
  000a4		 |$LN26@PmGetDevic|

; 1157 :                     __except(EXCEPTION_EXECUTE_HANDLER) {
; 1158 :                         PMLOGMSG(ZONE_WARN, (_T("%s: exception updating pCurDx 0x%08x\r\n"),
; 1159 :                             pszFname, pCurDx));

  000a4	4d1a		 ldr         r5,|$LN47@PmGetDevic| ; =|dpCurSettings|
  000a6	f8d5 3440	 ldr         r3,[r5,#0x440]
  000aa	f013 0f02	 tst         r3,#2
  000ae	d004		 beq         |$LN34@PmGetDevic|
  000b0	4816		 ldr         r0,|$LN46@PmGetDevic| ; =|??_C@_1EO@PIOCINDE@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAe?$AAx?$AAc?$AAe?$AAp?$AAt?$AAi?$AAo?$AAn?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAp?$AAC?$AAu?$AAr?$AAD?$AAx?$AA?5?$AA0?$AAx@|
  000b2	6bba		 ldr         r2,[r7,#0x38]
  000b4	4913		 ldr         r1,|$LN44@PmGetDevic| ; =|??_C@_1CC@DCKKIOFN@?$AAP?$AAm?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  000b6	f000 f800	 bl          CeLogMsg
  000ba		 |$LN34@PmGetDevic|

; 1160 :                         dwStatus = ERROR_INVALID_PARAMETER;

  000ba	2457		 movs        r4,#0x57
  000bc	f8d7 8004	 ldr         r8,[r7,#4]
  000c0	68be		 ldr         r6,[r7,#8]
  000c2		 |$LN29@PmGetDevic|

; 1161 :                     }
; 1162 :                 }
; 1163 :                 
; 1164 :                 // done with its pointer
; 1165 :                 DeviceStateDecRef(pds);

  000c2	4630		 mov         r0,r6
  000c4	f000 f800	 bl          DeviceStateDecRef
  000c8	e000		 b           |$LN36@PmGetDevic|
  000ca		 |$LN35@PmGetDevic|

; 1128 :         dwStatus = ERROR_INVALID_PARAMETER;

  000ca	2457		 movs        r4,#0x57
  000cc		 |$LN36@PmGetDevic|

; 1166 :             }
; 1167 :         }
; 1168 :     }
; 1169 : 
; 1170 :     // release resources
; 1171 :     if(pdi != NULL) DeviceIdDestroy(pdi);

  000cc	f1b8 0f00	 cmp         r8,#0
  000d0	d002		 beq         |$LN1@PmGetDevic|
  000d2	4640		 mov         r0,r8
  000d4	f000 f800	 bl          DeviceIdDestroy
  000d8		 |$LN1@PmGetDevic|

; 1118 :     SETFNAME(_T("PmGetDevicePower"));
; 1119 : 
; 1120 :     PMLOGMSG(ZONE_API || ZONE_DEVICE, (_T("+%s: device %s, flags 0x%08x\r\n"),
; 1121 :         pszFname, (dwDeviceFlags & POWER_NAME) != 0 ? (LPTSTR) pvDevice : _T("<UNKNOWN>"),
; 1122 :         dwDeviceFlags));

  000d8	f8d5 3440	 ldr         r3,[r5,#0x440]

; 1172 : 
; 1173 :     PMLOGMSG(ZONE_API || ZONE_DEVICE || (dwStatus != ERROR_SUCCESS && ZONE_WARN), 
; 1174 :         (_T("-%s: returning dwStatus %d\r\n"), pszFname, dwStatus));

  000dc	f413 6f00	 tst         r3,#0x800
  000e0	d106		 bne         |$LN19@PmGetDevic|
  000e2	f013 0f10	 tst         r3,#0x10
  000e6	d103		 bne         |$LN19@PmGetDevic|
  000e8	b13c		 cbz         r4,|$LN21@PmGetDevic|
  000ea	f013 0f02	 tst         r3,#2
  000ee	d004		 beq         |$LN21@PmGetDevic|
  000f0		 |$LN19@PmGetDevic|
  000f0	4805		 ldr         r0,|$LN45@PmGetDevic| ; =|??_C@_1DK@LJCCBMHG@?$AA?9?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAw?$AAS?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  000f2	4622		 mov         r2,r4
  000f4	4903		 ldr         r1,|$LN44@PmGetDevic| ; =|??_C@_1CC@DCKKIOFN@?$AAP?$AAm?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  000f6	f000 f800	 bl          CeLogMsg
  000fa		 |$LN21@PmGetDevic|

; 1175 : 
; 1176 :     // return our status
; 1177 :     return dwStatus;
; 1178 : }

  000fa	4620		 mov         r0,r4
  000fc		 |$M42|
  000fc	e8bd 0ffe	 pop         {r1-r11}
  00100	f85d fb14	 ldr         pc,[sp],#0x14
  00104		 |$LN43@PmGetDevic|
  00104		 |$LN44@PmGetDevic|
  00104	0000 0000	 DCD         |??_C@_1CC@DCKKIOFN@?$AAP?$AAm?$AAG?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  00108		 |$LN45@PmGetDevic|
  00108	0000 0000	 DCD         |??_C@_1DK@LJCCBMHG@?$AA?9?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAw?$AAS?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  0010c		 |$LN46@PmGetDevic|
  0010c	0000 0000	 DCD         |??_C@_1EO@PIOCINDE@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAe?$AAx?$AAc?$AAe?$AAp?$AAt?$AAi?$AAo?$AAn?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAp?$AAC?$AAu?$AAr?$AAD?$AAx?$AA?5?$AA0?$AAx@|
  00110		 |$LN47@PmGetDevic|
  00110	0000 0000	 DCD         |dpCurSettings|
  00114		 |$LN48@PmGetDevic|
  00114	0000 0000	 DCD         |??_C@_1DO@JJNOBOEP@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?$CF?$AAs?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?$AN?$AA?6?$AA?$AA@|
  00118		 |$LN49@PmGetDevic|
  00118	0000 0000	 DCD         |??_C@_1BE@GFCJAFPH@?$AA?$DM?$AAU?$AAN?$AAK?$AAN?$AAO?$AAW?$AAN?$AA?$DO?$AA?$AA@|

			 ENDP  ; |PmGetDevicePower|

  0011c		 |$LN39@PmGetDevic|
	EXPORT	|??_C@_1HG@JFGNKFEM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAs?$AAe?$AAt?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAt?$AAo?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AA?$CI?$AAm?$AAa?$AAp?$AAp?$AAe?$AAd?$AA?5@| [ DATA ] ; `string'
	EXPORT	|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DO@JJNMPAOB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAi?$AAs?$AA?5?$AAa?$AAl?$AAr?$AAe?$AAa?$AAd?$AAy?$AA?5?$AAa?$AAt?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1IA@NEEPNPJA@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAW?$AAr?$AAo?$AAn?$AAg?$AA?5?$AAR?$AAe?$AAt?$AAu?$AAr?$AAn?$AA?5?$AAV?$AAa?$AAl?$AAu?$AAe?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GG@MKDGLGMP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAa?$AAc?$AAe?$AA?5?$AAd?$AAe?$AAt?$AAe?$AAc?$AAt?$AAe?$AAd?$AA?5?$AAo?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr@| [ DATA ] ; `string'
	EXPORT	|??_C@_19HDEHKPMM@?$AAb?$AAk?$AAl?$AA1?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GI@CAFGDGCP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAS?$AAE?$AAT?$AA?5@| [ DATA ] ; `string'
	EXPORT	|?SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z| ; SetDevicePower
	IMPORT	|memcmp|
	IMPORT	|?PMExt_PMBeforeNewDeviceState@@YAXPBGW4_CEDEVICE_POWER_STATE@@1@Z| ; PMExt_PMBeforeNewDeviceState
	IMPORT	|NKDbgPrintfW|
	IMPORT	|CeGetRawTime|
	IMPORT	|PMSQM_Set|
	IMPORT	|?PMExt_PMAfterNewDeviceState@@YAXPBGW4_CEDEVICE_POWER_STATE@@1@Z| ; PMExt_PMAfterNewDeviceState

  00000			 AREA	 |.bss|, NOINIT
|?dwStaticRefCount@?1??SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z@4KA| % 0x4 ; `SetDevicePower'::`2'::dwStaticRefCount

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$?SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z| DCD imagerel |$LN62@SetDeviceP|
	DCD	imagerel |$unwind2$?SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z|

  00000			 AREA	 |.xdata|, DATA
|$unwind2$?SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z| DCD 0x1080014a
	DCD	0x2e0012b
	DCD	0xffdffc13

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GI@CAFGDGCP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAS?$AAE?$AAT?$AA?5@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, " ", 0x0, "f", 0x0, "a", 0x0, "i", 0x0, "l"
	DCB	0x0, "e", 0x0, "d", 0x0, " ", 0x0, "I", 0x0, "O", 0x0, "C"
	DCB	0x0, "T", 0x0, "L", 0x0, "_", 0x0, "P", 0x0, "O", 0x0, "W"
	DCB	0x0, "E", 0x0, "R", 0x0, "_", 0x0, "S", 0x0, "E", 0x0, "T"
	DCB	0x0, " ", 0x0, "D", 0x0, "%", 0x0, "d", 0x0, ",", 0x0, " "
	DCB	0x0, "s", 0x0, "t", 0x0, "a", 0x0, "t", 0x0, "u", 0x0, "s"
	DCB	0x0, " ", 0x0, "i", 0x0, "s", 0x0, " ", 0x0, "%", 0x0, "d"
	DCB	0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0	; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_19HDEHKPMM@?$AAb?$AAk?$AAl?$AA1?$AA?$AA@| DCB "b", 0x0, "k", 0x0, "l"
	DCB	0x0, "1", 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GG@MKDGLGMP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAa?$AAc?$AAe?$AA?5?$AAd?$AAe?$AAt?$AAe?$AAc?$AAt?$AAe?$AAd?$AA?5?$AAo?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "a", 0x0, "c"
	DCB	0x0, "e", 0x0, " ", 0x0, "d", 0x0, "e", 0x0, "t", 0x0, "e"
	DCB	0x0, "c", 0x0, "t", 0x0, "e", 0x0, "d", 0x0, " ", 0x0, "o"
	DCB	0x0, "n", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'"
	DCB	0x0, ",", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "t", 0x0, "u"
	DCB	0x0, "r", 0x0, "n", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " "
	DCB	0x0, "E", 0x0, "R", 0x0, "R", 0x0, "O", 0x0, "R", 0x0, "_"
	DCB	0x0, "R", 0x0, "E", 0x0, "T", 0x0, "R", 0x0, "Y", 0x0, 0xd
	DCB	0x0, 0xa, 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1IA@NEEPNPJA@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAW?$AAr?$AAo?$AAn?$AAg?$AA?5?$AAR?$AAe?$AAt?$AAu?$AAr?$AAn?$AA?5?$AAV?$AAa?$AAl?$AAu?$AAe?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "W", 0x0, "r", 0x0, "o"
	DCB	0x0, "n", 0x0, "g", 0x0, " ", 0x0, "R", 0x0, "e", 0x0, "t"
	DCB	0x0, "u", 0x0, "r", 0x0, "n", 0x0, " ", 0x0, "V", 0x0, "a"
	DCB	0x0, "l", 0x0, "u", 0x0, "e", 0x0, " ", 0x0, "f", 0x0, "r"
	DCB	0x0, "o", 0x0, "m", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, ",", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "t"
	DCB	0x0, "u", 0x0, "r", 0x0, "n", 0x0, "i", 0x0, "n", 0x0, "g"
	DCB	0x0, " ", 0x0, "E", 0x0, "R", 0x0, "R", 0x0, "O", 0x0, "R"
	DCB	0x0, "_", 0x0, "G", 0x0, "E", 0x0, "N", 0x0, "_", 0x0, "F"
	DCB	0x0, "A", 0x0, "I", 0x0, "L", 0x0, "U", 0x0, "R", 0x0, "E"
	DCB	0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0	; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DO@JJNMPAOB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAi?$AAs?$AA?5?$AAa?$AAl?$AAr?$AAe?$AAa?$AAd?$AAy?$AA?5?$AAa?$AAt?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "d", 0x0, "e", 0x0, "v"
	DCB	0x0, "i", 0x0, "c", 0x0, "e", 0x0, " ", 0x0, "i", 0x0, "s"
	DCB	0x0, " ", 0x0, "a", 0x0, "l", 0x0, "r", 0x0, "e", 0x0, "a"
	DCB	0x0, "d", 0x0, "y", 0x0, " ", 0x0, "a", 0x0, "t", 0x0, " "
	DCB	0x0, "D", 0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@| DCB "S"
	DCB	0x0, "e", 0x0, "t", 0x0, "D", 0x0, "e", 0x0, "v", 0x0, "i"
	DCB	0x0, "c", 0x0, "e", 0x0, "P", 0x0, "o", 0x0, "w", 0x0, "e"
	DCB	0x0, "r", 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1HG@JFGNKFEM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAs?$AAe?$AAt?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAt?$AAo?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AA?$CI?$AAm?$AAa?$AAp?$AAp?$AAe?$AAd?$AA?5@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "s", 0x0, "e", 0x0, "t"
	DCB	0x0, "t", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " ", 0x0, "'"
	DCB	0x0, "%", 0x0, "s", 0x0, "'", 0x0, " ", 0x0, "t", 0x0, "o"
	DCB	0x0, " ", 0x0, "D", 0x0, "%", 0x0, "d", 0x0, " ", 0x0, "("
	DCB	0x0, "m", 0x0, "a", 0x0, "p", 0x0, "p", 0x0, "e", 0x0, "d"
	DCB	0x0, " ", 0x0, "t", 0x0, "o", 0x0, " ", 0x0, "D", 0x0, "%"
	DCB	0x0, "d", 0x0, ")", 0x0, ",", 0x0, " ", 0x0, "f", 0x0, "F"
	DCB	0x0, "o", 0x0, "r", 0x0, "c", 0x0, "e", 0x0, "S", 0x0, "e"
	DCB	0x0, "t", 0x0, " ", 0x0, "i", 0x0, "s", 0x0, " ", 0x0, "%"
	DCB	0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |?SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z| PROC ; SetDevicePower

; 61   : {

  00000		 |$LN62@SetDeviceP|
  00000	e92d 4ff0	 push        {r4-r11,lr}
  00004	f20d 0b1c	 addw        r11,sp,#0x1C
  00008	b093		 sub         sp,sp,#0x4C
  0000a		 |$M60|

; 62   :     DWORD dwStatus = ERROR_SUCCESS;
; 63   :     static DWORD dwStaticRefCount = 0; 
; 64   :     DWORD dwCurRefCount = 0;

  0000a	2300		 movs        r3,#0
  0000c	9309		 str         r3,[sp,#0x24]

; 65   :     CEDEVICE_POWER_STATE reqDx;
; 66   :     CEDEVICE_POWER_STATE oldActualDx = D0, oldCurDx = D0;

  0000e	2300		 movs        r3,#0
  00010	4689		 mov         r9,r1
  00012	9108		 str         r1,[sp,#0x20]

; 67   :     POWER_RELATIONSHIP pr;
; 68   :     PPOWER_RELATIONSHIP ppr = NULL;
; 69   :     BOOL fDoSet;
; 70   :     BOOL fOpenDevice = FALSE;
; 71   :     HANDLE hDevice = INVALID_HANDLE_VALUE;
; 72   :     SETFNAME(_T("SetDevicePower"));
; 73   : 
; 74   :     PREFAST_DEBUGCHK(pds != NULL);
; 75   :     DEBUGCHK( newDx >= D0 && newDx <= D4);
; 76   :     DEBUGCHK(pds->pInterface != NULL);
; 77   : 
; 78   :     // map the power level to whatever the device actually supports
; 79   :     reqDx = MapDevicePowerState(newDx, pds->caps.DeviceDx);

  00014	f890 1028	 ldrb        r1,[r0,#0x28]
  00018	930a		 str         r3,[sp,#0x28]
  0001a	9307		 str         r3,[sp,#0x1C]
  0001c	43db		 mvns        r3,r3
  0001e	4605		 mov         r5,r0
  00020	f04f 0a00	 mov         r10,#0
  00024	4648		 mov         r0,r9
  00026	9305		 str         r3,[sp,#0x14]
  00028	4614		 mov         r4,r2
  0002a	2600		 movs        r6,#0
  0002c	f8cd a018	 str         r10,[sp,#0x18]
  00030	f000 f800	 bl          |?MapDevicePowerState@@YA?AW4_CEDEVICE_POWER_STATE@@W41@E@Z|

; 80   :     PMLOGMSG(ZONE_DEVICE, (_T("%s: setting '%s' to D%d (mapped to D%d), fForceSet is %d\r\n"), 
; 81   :         pszFname, pds->pszName, newDx, reqDx, fForceSet));

  00034	f8df 828c	 ldr         r8,|$LN77@SetDeviceP| ; =|dpCurSettings|
  00038	9004		 str         r0,[sp,#0x10]
  0003a	f8d8 3440	 ldr         r3,[r8,#0x440]
  0003e	f013 0f10	 tst         r3,#0x10
  00042	d007		 beq         |$LN35@SetDeviceP|
  00044	682a		 ldr         r2,[r5]
  00046	4993		 ldr         r1,|$LN65@SetDeviceP| ; =|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  00048	9000		 str         r0,[sp]
  0004a	489d		 ldr         r0,|$LN76@SetDeviceP| ; =|??_C@_1HG@JFGNKFEM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAs?$AAe?$AAt?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAt?$AAo?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AA?$CI?$AAm?$AAa?$AAp?$AAp?$AAe?$AAd?$AA?5@|
  0004c	464b		 mov         r3,r9
  0004e	9401		 str         r4,[sp,#4]
  00050	f000 f800	 bl          CeLogMsg
  00054		 |$LN35@SetDeviceP|

; 82   : 
; 83   :     // make a last check to see if we really need to send the device an update
; 84   :     PMLOCK();

  00054	f000 f800	 bl          PmLock

; 85   :     DEBUGCHK(pds->dwNumPending == 0 || pds->pendingDx != PwrDeviceUnspecified);
; 86   :     DEBUGCHK(pds->dwNumPending != 0 || pds->pendingDx == PwrDeviceUnspecified);
; 87   :     if(reqDx != pds->actualDx || pds->dwNumPending != 0 || fForceSet) {

  00058	69aa		 ldr         r2,[r5,#0x18]
  0005a	9904		 ldr         r1,[sp,#0x10]
  0005c	4f97		 ldr         r7,|$LN75@SetDeviceP| ; =|?dwStaticRefCount@?1??SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z@4KA|
  0005e	4291		 cmp         r1,r2
  00060	d104		 bne         |$LN31@SetDeviceP|
  00062	6a2b		 ldr         r3,[r5,#0x20]
  00064	b913		 cbnz        r3,|$LN31@SetDeviceP|
  00066	b90c		 cbnz        r4,|$LN31@SetDeviceP|

; 106  :         }
; 107  :     } else {
; 108  :         fDoSet = FALSE;

  00068	2400		 movs        r4,#0
  0006a	e018		 b           |$LN29@SetDeviceP|
  0006c		 |$LN31@SetDeviceP|

; 88   :         fDoSet = TRUE;
; 89   : 
; 90   :         // record what we're trying to set, visible to other threads
; 91   :         pds->pendingDx = reqDx;
; 92   :         pds->dwNumPending++;

  0006c	6a2b		 ldr         r3,[r5,#0x20]

; 93   :         // Re-Enter Checking Count.
; 94   :         dwStaticRefCount ++ ;

  0006e	f8d7 a000	 ldr         r10,[r7]
  00072	2401		 movs        r4,#1
  00074	3301		 adds        r3,#1
  00076	622b		 str         r3,[r5,#0x20]

; 95   :         dwCurRefCount = dwStaticRefCount;
; 96   :         // remember what we're trying to set in this thread
; 97   :         oldCurDx = pds->curDx;

  00078	686b		 ldr         r3,[r5,#4]
  0007a	44a2		 add         r10,r10,r4
  0007c	f8cd a024	 str         r10,[sp,#0x24]
  00080	930a		 str         r3,[sp,#0x28]

; 98   :         oldActualDx = pds->actualDx;
; 99   : 
; 100  :         // get a handle to the device to make the request
; 101  :         hDevice = pds->hDevice;

  00082	6deb		 ldr         r3,[r5,#0x5C]
  00084	f8c7 a000	 str         r10,[r7]
  00088	61e9		 str         r1,[r5,#0x1C]
  0008a	9305		 str         r3,[sp,#0x14]

; 102  :         if(hDevice != INVALID_HANDLE_VALUE) {

  0008c	f1b3 3fff	 cmp         r3,#0xFFFFFFFF
  00090	4692		 mov         r10,r2
  00092	9206		 str         r2,[sp,#0x18]
  00094	d001		 beq         |$LN30@SetDeviceP|

; 103  :             fOpenDevice = FALSE;    // already have a handle

  00096	2300		 movs        r3,#0

; 104  :         } else {

  00098	e000		 b           |$LN56@SetDeviceP|
  0009a		 |$LN30@SetDeviceP|

; 105  :             fOpenDevice = TRUE;     // need to open a handle

  0009a	2301		 movs        r3,#1
  0009c		 |$LN56@SetDeviceP|
  0009c	9307		 str         r3,[sp,#0x1C]
  0009e		 |$LN29@SetDeviceP|

; 109  :     }
; 110  :     PMUNLOCK();

  0009e	f000 f800	 bl          PmUnlock

; 111  : 
; 112  :     // are we doing an update?
; 113  :     if(!fDoSet) {

  000a2	b95c		 cbnz        r4,|$LN27@SetDeviceP|

; 114  :         PMLOGMSG(ZONE_DEVICE, (_T("%s: device is already at D%d\r\n"), pszFname, reqDx));

  000a4	f8d8 3440	 ldr         r3,[r8,#0x440]
  000a8	f013 0f10	 tst         r3,#0x10
  000ac	f000 80d1	 beq         |$LN26@SetDeviceP|
  000b0	4881		 ldr         r0,|$LN74@SetDeviceP| ; =|??_C@_1DO@JJNMPAOB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAi?$AAs?$AA?5?$AAa?$AAl?$AAr?$AAe?$AAa?$AAd?$AAy?$AA?5?$AAa?$AAt?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  000b2	9a04		 ldr         r2,[sp,#0x10]
  000b4	4977		 ldr         r1,|$LN65@SetDeviceP| ; =|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  000b6	f000 f800	 bl          CeLogMsg

; 115  :     } else {

  000ba	e0ca		 b           |$LN26@SetDeviceP|
  000bc		 |$LN27@SetDeviceP|

; 116  :         // initialize parameters
; 117  :         memset(&pr, 0, sizeof(pr));
; 118  :         if(pds->pParent != NULL) {

  000bc	6a6a		 ldr         r2,[r5,#0x24]
  000be	2300		 movs        r3,#0
  000c0	930e		 str         r3,[sp,#0x38]
  000c2	930f		 str         r3,[sp,#0x3C]
  000c4	9310		 str         r3,[sp,#0x40]
  000c6	9311		 str         r3,[sp,#0x44]
  000c8	b19a		 cbz         r2,|$LN54@SetDeviceP|

; 119  :             PMLOGMSG(ZONE_DEVICE, (_T("%s: parent of '%s' is '%s'\r\n"), 
; 120  :                 pszFname, pds->pszName, pds->pParent->pszName));

  000ca	f8d8 3440	 ldr         r3,[r8,#0x440]
  000ce	f013 0f10	 tst         r3,#0x10
  000d2	d005		 beq         |$LN39@SetDeviceP|
  000d4	6813		 ldr         r3,[r2]
  000d6	682a		 ldr         r2,[r5]
  000d8	4876		 ldr         r0,|$LN73@SetDeviceP| ; =|??_C@_1DK@KOLEMAMB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAp?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AAo?$AAf?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  000da	496e		 ldr         r1,|$LN65@SetDeviceP| ; =|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  000dc	f000 f800	 bl          CeLogMsg
  000e0		 |$LN39@SetDeviceP|

; 121  :             pr.hParent = (HANDLE) pds->pParent;

  000e0	6a6b		 ldr         r3,[r5,#0x24]

; 122  :             pr.pwsParent = pds->pParent->pszName;
; 123  :             pr.hChild = (HANDLE) pds;
; 124  :             pr.pwsChild = pds->pszName;
; 125  :             ppr = &pr;

  000e2	ac0e		 add         r4,sp,#0x38
  000e4	930e		 str         r3,[sp,#0x38]
  000e6	681b		 ldr         r3,[r3]
  000e8	9510		 str         r5,[sp,#0x40]
  000ea	930f		 str         r3,[sp,#0x3C]
  000ec	682b		 ldr         r3,[r5]
  000ee	9311		 str         r3,[sp,#0x44]
  000f0	e000		 b           |$LN51@SetDeviceP|
  000f2		 |$LN54@SetDeviceP|
  000f2	2400		 movs        r4,#0
  000f4		 |$LN51@SetDeviceP|

; 126  :         }
; 127  :         
; 128  :         // get a handle to the device
; 129  :         if(fOpenDevice) {

  000f4	9b07		 ldr         r3,[sp,#0x1C]
  000f6	b133		 cbz         r3,|$LN55@SetDeviceP|

; 130  :             DEBUGCHK(pds->pInterface->pfnOpenDevice != NULL);
; 131  :             hDevice = pds->pInterface->pfnOpenDevice(pds);

  000f8	6e2b		 ldr         r3,[r5,#0x60]
  000fa	4628		 mov         r0,r5
  000fc	685b		 ldr         r3,[r3,#4]
  000fe	4798		 blx         r3
  00100	4603		 mov         r3,r0
  00102	9305		 str         r3,[sp,#0x14]
  00104	e000		 b           |$LN24@SetDeviceP|
  00106		 |$LN55@SetDeviceP|
  00106	9b05		 ldr         r3,[sp,#0x14]
  00108		 |$LN24@SetDeviceP|

; 132  :         }
; 133  : 
; 134  :         // did we get a handle?
; 135  :         if(hDevice == INVALID_HANDLE_VALUE) {

  00108	f1b3 3fff	 cmp         r3,#0xFFFFFFFF
  0010c	d10b		 bne         |$LN23@SetDeviceP|

; 136  :             PMLOGMSG(ZONE_WARN, (_T("%s: couldn't open '%s'\r\n"), pszFname,
; 137  :                 pds->pszName));

  0010e	f8d8 3440	 ldr         r3,[r8,#0x440]
  00112	f013 0f02	 tst         r3,#2
  00116	d004		 beq         |$LN41@SetDeviceP|
  00118	682a		 ldr         r2,[r5]
  0011a	4865		 ldr         r0,|$LN72@SetDeviceP| ; =|??_C@_1DC@NDCGFHLP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  0011c	495d		 ldr         r1,|$LN65@SetDeviceP| ; =|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  0011e	f000 f800	 bl          CeLogMsg
  00122		 |$LN41@SetDeviceP|

; 138  :             dwStatus = ERROR_INVALID_HANDLE;

  00122	2606		 movs        r6,#6

; 139  :         } else {

  00124	e08a		 b           |$LN2@SetDeviceP|
  00126		 |$LN23@SetDeviceP|

; 140  :             DWORD dwBytesReturned;
; 141  :             DEBUGCHK(pds->pInterface->pfnRequestDevice != NULL);
; 142  :             PMExt_PMBeforeNewDeviceState(pds->pszName,oldActualDx,reqDx);

  00126	6828		 ldr         r0,[r5]
  00128	9a04		 ldr         r2,[sp,#0x10]
  0012a	4651		 mov         r1,r10
  0012c	f000 f800	 bl          |?PMExt_PMBeforeNewDeviceState@@YAXPBGW4_CEDEVICE_POWER_STATE@@1@Z|

; 143  :     
; 144  :             BOOL fOk = pds->pInterface->pfnRequestDevice(hDevice, IOCTL_POWER_SET, ppr, 
; 145  :                 ppr == NULL ? 0 : sizeof(*ppr), &reqDx, sizeof(reqDx), 
; 146  :                 &dwBytesReturned);

  00130	b90c		 cbnz        r4,|$LN43@SetDeviceP|
  00132	2300		 movs        r3,#0
  00134	e000		 b           |$LN44@SetDeviceP|
  00136		 |$LN43@SetDeviceP|
  00136	2310		 movs        r3,#0x10
  00138		 |$LN44@SetDeviceP|
  00138	2204		 movs        r2,#4
  0013a	9201		 str         r2,[sp,#4]
  0013c	a90c		 add         r1,sp,#0x30
  0013e	4622		 mov         r2,r4
  00140	6e2c		 ldr         r4,[r5,#0x60]
  00142	9102		 str         r1,[sp,#8]
  00144	a904		 add         r1,sp,#0x10
  00146	68e4		 ldr         r4,[r4,#0xC]
  00148	9805		 ldr         r0,[sp,#0x14]
  0014a	9100		 str         r1,[sp]
  0014c	4957		 ldr         r1,|$LN71@SetDeviceP| ; =0x321008
  0014e	47a0		 blx         r4

; 147  : 
; 148  :             if(fOk) {

  00150	2800		 cmp         r0,#0
  00152	f000 8082	 beq         |$LN21@SetDeviceP|

; 149  :                 /* device can go from any Dx to any Dx.  SQM is interested in D0 and not-D0 */
; 150  :                 BOOL fOnToOther = FALSE; /* changed state from D0 to non-D0 */

  00156	f04f 0a00	 mov         r10,#0

; 151  :                 BOOL fOtherToOn = FALSE; /* changed state from non-D0 to D0 */

  0015a	f04f 0900	 mov         r9,#0

; 152  :                 /* code below will set ONE of these if a successful transition happens */
; 153  : 
; 154  :                 // Check for races to update the driver -- it is possible for the device to call
; 155  :                 // DevicePowerNotify() when another thread is calling SetDevicePower(), 
; 156  :                 // SetSystemPowerState(), or Set(/Release)PowerRequirement().
; 157  :                 PMLOCK();

  0015e	f000 f800	 bl          PmLock

; 158  :                 if(pds->pendingDx == reqDx) {

  00162	69eb		 ldr         r3,[r5,#0x1C]
  00164	9a04		 ldr         r2,[sp,#0x10]
  00166	4293		 cmp         r3,r2
  00168	d10d		 bne         |$LN20@SetDeviceP|

; 159  :                     if (pds->curDx==D0)

  0016a	686b		 ldr         r3,[r5,#4]
  0016c	2b00		 cmp         r3,#0

; 160  :                     {
; 161  :                         fOnToOther = TRUE;

  0016e	9b08		 ldr         r3,[sp,#0x20]
  00170	d102		 bne         |$LN19@SetDeviceP|
  00172	f04f 0a01	 mov         r10,#1
  00176	e002		 b           |$LN17@SetDeviceP|
  00178		 |$LN19@SetDeviceP|

; 162  :                     }
; 163  :                     else if (newDx==D0)

  00178	b90b		 cbnz        r3,|$LN17@SetDeviceP|

; 164  :                     {
; 165  :                         fOtherToOn = TRUE;

  0017a	f04f 0901	 mov         r9,#1
  0017e		 |$LN17@SetDeviceP|

; 166  :                     }
; 167  :                     // record the new values
; 168  :                     pds->curDx = newDx;

  0017e	606b		 str         r3,[r5,#4]

; 169  :                     pds->actualDx = reqDx;

  00180	61aa		 str         r2,[r5,#0x18]
  00182		 |$LN57@SetDeviceP|
  00182	683a		 ldr         r2,[r7]
  00184	e01a		 b           |$LN13@SetDeviceP|
  00186		 |$LN20@SetDeviceP|

; 170  :                 } 
; 171  :                 else if (dwCurRefCount != dwStaticRefCount || pds->dwNumPending > 1 ) {

  00186	683a		 ldr         r2,[r7]
  00188	9b09		 ldr         r3,[sp,#0x24]
  0018a	4293		 cmp         r3,r2
  0018c	d109		 bne         |$LN14@SetDeviceP|
  0018e	6a2b		 ldr         r3,[r5,#0x20]
  00190	2b01		 cmp         r3,#1
  00192	d806		 bhi         |$LN14@SetDeviceP|

; 175  :                 }
; 176  :                 else { // This condition indicate no SetDevicePower called by others. It must be wrong value return from device driver
; 177  :                     RETAILMSG(1, (_T("%s: Wrong Return Value from '%s', returning ERROR_GEN_FAILURE\r\n"),
; 178  :                         pszFname, pds->pszName));

  00194	682a		 ldr         r2,[r5]
  00196	4844		 ldr         r0,|$LN70@SetDeviceP| ; =|??_C@_1IA@NEEPNPJA@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAW?$AAr?$AAo?$AAn?$AAg?$AA?5?$AAR?$AAe?$AAt?$AAu?$AAr?$AAn?$AA?5?$AAV?$AAa?$AAl?$AAu?$AAe?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8@|
  00198	493e		 ldr         r1,|$LN65@SetDeviceP| ; =|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  0019a	f000 f800	 bl          NKDbgPrintfW

; 179  :                     ASSERT(FALSE);
; 180  :                     dwStatus = ERROR_GEN_FAILURE;

  0019e	261f		 movs        r6,#0x1F
  001a0	e7ef		 b           |$LN57@SetDeviceP|
  001a2		 |$LN14@SetDeviceP|

; 172  :                     PMLOGMSG(ZONE_DEVICE, (_T("%s: race detected on '%s', returning ERROR_RETRY\r\n"),
; 173  :                         pszFname, pds->pszName));

  001a2	f8d8 3440	 ldr         r3,[r8,#0x440]
  001a6	f013 0f10	 tst         r3,#0x10
  001aa	d005		 beq         |$LN45@SetDeviceP|
  001ac	682a		 ldr         r2,[r5]
  001ae	483d		 ldr         r0,|$LN69@SetDeviceP| ; =|??_C@_1GG@MKDGLGMP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAa?$AAc?$AAe?$AA?5?$AAd?$AAe?$AAt?$AAe?$AAc?$AAt?$AAe?$AAd?$AA?5?$AAo?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr@|
  001b0	4938		 ldr         r1,|$LN65@SetDeviceP| ; =|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  001b2	f000 f800	 bl          CeLogMsg
  001b6	683a		 ldr         r2,[r7]
  001b8		 |$LN45@SetDeviceP|

; 174  :                     dwStatus = ERROR_RETRY;

  001b8	f240 46d5	 mov         r6,#0x4D5
  001bc		 |$LN13@SetDeviceP|

; 181  :                 }
; 182  :                 dwStaticRefCount ++ ;

  001bc	3201		 adds        r2,#1
  001be	603a		 str         r2,[r7]

; 183  :                 PMUNLOCK();

  001c0	f000 f800	 bl          PmUnlock

; 184  : 
; 185  :                 if ((fOnToOther) || (fOtherToOn))

  001c4	f1ba 0f00	 cmp         r10,#0
  001c8	d102		 bne         |$LN11@SetDeviceP|
  001ca	f1b9 0f00	 cmp         r9,#0
  001ce	d028		 beq         |$LN53@SetDeviceP|
  001d0		 |$LN11@SetDeviceP|

; 186  :                 {
; 187  :                     // sqm for power - check to see if the backlight is being turned off/on
; 188  :                     // backlight is statically named driver - use the first one to check for on/off 
; 189  :                     if (!memcmp(pds->pszName,TEXT("bkl1"),sizeof(TCHAR)*4))

  001d0	4933		 ldr         r1,|$LN68@SetDeviceP| ; =|??_C@_19HDEHKPMM@?$AAb?$AAk?$AAl?$AA1?$AA?$AA@|
  001d2	6828		 ldr         r0,[r5]
  001d4	2208		 movs        r2,#8
  001d6	f000 f800	 bl          memcmp
  001da	bb10		 cbnz        r0,|$LN53@SetDeviceP|

; 190  :                     {
; 191  :                         ULONGLONG u64Now;
; 192  :                         DWORD dwDeltaMs;
; 193  : 
; 194  :                         CeGetRawTime(&u64Now);

  001dc	a80a		 add         r0,sp,#0x28
  001de	f000 f800	 bl          CeGetRawTime

; 195  :                         dwDeltaMs = (DWORD) (u64Now - gBacklightMs);

  001e2	4c2e		 ldr         r4,|$LN67@SetDeviceP| ; =|gBacklightMs|
  001e4	980a		 ldr         r0,[sp,#0x28]
  001e6	6822		 ldr         r2,[r4]

; 196  : 
; 197  :                         // its the primary backlight driver we just changed the state of.
; 198  :                         // so record the sqm information based on whether it's in D0 or not.
; 199  :                         if (gBacklightMs != 0)

  001e8	6863		 ldr         r3,[r4,#4]
  001ea	1a87		 subs        r7,r0,r2
  001ec	4313		 orrs        r3,r3,r2
  001ee	d015		 beq         |$LN6@SetDeviceP|

; 200  :                         {
; 201  :                             if (fOnToOther)

  001f0	f1ba 0f00	 cmp         r10,#0
  001f4	d009		 beq         |$LN8@SetDeviceP|

; 202  :                             {
; 203  :                                 /* backlight is being turned off (not D0) */
; 204  :                                 gBacklightMsTotal += dwDeltaMs;

  001f6	68a3		 ldr         r3,[r4,#8]

; 205  :                                 PMSQM_Set(PMSQM_DATAID_POWER_BKL_TOTAL,gBacklightMsTotal);

  001f8	f44f 70b2	 mov         r0,#0x164
  001fc	19d9		 adds        r1,r3,r7
  001fe	60a1		 str         r1,[r4,#8]
  00200	f000 f800	 bl          PMSQM_Set

; 206  :                                 PMSQM_Set(PMSQM_DATAID_POWER_BKL_ON,dwDeltaMs);

  00204	f240 1065	 mov         r0,#0x165
  00208	e004		 b           |$LN58@SetDeviceP|
  0020a		 |$LN8@SetDeviceP|

; 207  :                             }
; 208  :                             else if (fOtherToOn)

  0020a	f1b9 0f00	 cmp         r9,#0
  0020e	d005		 beq         |$LN6@SetDeviceP|

; 209  :                             {
; 210  :                                 /* backlight is being turned on (D0) */
; 211  :                                 PMSQM_Set(PMSQM_DATAID_POWER_BKL_OFF,dwDeltaMs);

  00210	f44f 70b3	 mov         r0,#0x166
  00214		 |$LN58@SetDeviceP|
  00214	4639		 mov         r1,r7
  00216	f000 f800	 bl          PMSQM_Set
  0021a	980a		 ldr         r0,[sp,#0x28]
  0021c		 |$LN6@SetDeviceP|

; 212  :                             }
; 213  :                         }
; 214  :                         gBacklightMs = u64Now;  // save last tick count.

  0021c	9b0b		 ldr         r3,[sp,#0x2C]
  0021e	6020		 str         r0,[r4]
  00220	6063		 str         r3,[r4,#4]
  00222		 |$LN53@SetDeviceP|
  00222	f8dd a018	 ldr         r10,[sp,#0x18]
  00226		 |$LN5@SetDeviceP|

; 234  :             }
; 235  :             PMExt_PMAfterNewDeviceState(pds->pszName,oldActualDx,reqDx);

  00226	6828		 ldr         r0,[r5]
  00228	9a04		 ldr         r2,[sp,#0x10]
  0022a	4651		 mov         r1,r10
  0022c	f000 f800	 bl          |?PMExt_PMAfterNewDeviceState@@YAXPBGW4_CEDEVICE_POWER_STATE@@1@Z|

; 236  :             
; 237  :             // close the device handle if we opened it in this routine
; 238  :             if(fOpenDevice) {

  00230	9b07		 ldr         r3,[sp,#0x1C]
  00232	b11b		 cbz         r3,|$LN2@SetDeviceP|

; 239  :                 DEBUGCHK(pds->pInterface->pfnCloseDevice != NULL);
; 240  :                 pds->pInterface->pfnCloseDevice(hDevice);

  00234	6e2b		 ldr         r3,[r5,#0x60]
  00236	9805		 ldr         r0,[sp,#0x14]
  00238	689b		 ldr         r3,[r3,#8]
  0023a	4798		 blx         r3
  0023c		 |$LN2@SetDeviceP|

; 241  :             }
; 242  :         }
; 243  : 
; 244  :         // update reference counts
; 245  :         PMLOCK();

  0023c	f000 f800	 bl          PmLock

; 246  :         DEBUGCHK(pds->dwNumPending != 0);
; 247  :         DEBUGCHK(pds->pendingDx != PwrDeviceUnspecified);
; 248  :         pds->dwNumPending--;

  00240	6a2b		 ldr         r3,[r5,#0x20]
  00242	3b01		 subs        r3,#1
  00244	622b		 str         r3,[r5,#0x20]

; 249  :         if(pds->dwNumPending == 0) {

  00246	d102		 bne         |$LN1@SetDeviceP|

; 250  :             pds->pendingDx = PwrDeviceUnspecified;

  00248	f06f 0300	 mvn         r3,#0
  0024c	61eb		 str         r3,[r5,#0x1C]
  0024e		 |$LN1@SetDeviceP|

; 251  :         }
; 252  :         PMUNLOCK();

  0024e	f000 f800	 bl          PmUnlock
  00252		 |$LN26@SetDeviceP|

; 253  :     }
; 254  : 
; 255  :     return dwStatus;
; 256  : }

  00252	4630		 mov         r0,r6
  00254		 |$M63|
  00254	b013		 add         sp,sp,#0x4C
  00256	e8bd 8ff0	 pop         {r4-r11,pc}
  0025a		 |$LN21@SetDeviceP|

; 215  :                     }
; 216  :                 }
; 217  :             } else {
; 218  :                 dwStatus = GetLastError();

  0025a	f000 f800	 bl          GetLastError
  0025e	4606		 mov         r6,r0

; 219  :                 if(dwStatus == ERROR_SUCCESS) {

  00260	b906		 cbnz        r6,|$LN4@SetDeviceP|

; 220  :                     dwStatus = ERROR_GEN_FAILURE;

  00262	261f		 movs        r6,#0x1F
  00264		 |$LN4@SetDeviceP|

; 221  :                 }
; 222  :                 PMLOGMSG(ZONE_WARN, (_T("%s: '%s' failed IOCTL_POWER_SET D%d, status is %d\r\n"),
; 223  :                     pszFname, pds->pszName, newDx, dwStatus));

  00264	f8d8 3440	 ldr         r3,[r8,#0x440]
  00268	f013 0f02	 tst         r3,#2
  0026c	d006		 beq         |$LN49@SetDeviceP|
  0026e	682a		 ldr         r2,[r5]
  00270	4809		 ldr         r0,|$LN66@SetDeviceP| ; =|??_C@_1GI@CAFGDGCP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAS?$AAE?$AAT?$AA?5@|
  00272	4908		 ldr         r1,|$LN65@SetDeviceP| ; =|??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  00274	464b		 mov         r3,r9
  00276	9600		 str         r6,[sp]
  00278	f000 f800	 bl          CeLogMsg
  0027c		 |$LN49@SetDeviceP|

; 224  :                 
; 225  :                 PMLOCK();

  0027c	f000 f800	 bl          PmLock

; 226  :                 // the set operation failed -- if the device power state appears unchanged,
; 227  :                 // restore our state variables.  In general, devices should never fail a
; 228  :                 // set request.
; 229  :                 if(reqDx == oldActualDx) {

  00280	9b04		 ldr         r3,[sp,#0x10]
  00282	4553		 cmp         r3,r10
  00284	d103		 bne         |$LN3@SetDeviceP|

; 230  :                     pds->curDx = oldCurDx;

  00286	9b0a		 ldr         r3,[sp,#0x28]

; 231  :                     pds->actualDx = oldActualDx;

  00288	f8c5 a018	 str         r10,[r5,#0x18]
  0028c	606b		 str         r3,[r5,#4]
  0028e		 |$LN3@SetDeviceP|

; 232  :                 }
; 233  :                 PMUNLOCK();

  0028e	f000 f800	 bl          PmUnlock
  00292	e7c8		 b           |$LN5@SetDeviceP|
  00294		 |$LN64@SetDeviceP|
  00294		 |$LN65@SetDeviceP|
  00294	0000 0000	 DCD         |??_C@_1BO@GNENFOGN@?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  00298		 |$LN66@SetDeviceP|
  00298	0000 0000	 DCD         |??_C@_1GI@CAFGDGCP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAI?$AAO?$AAC?$AAT?$AAL?$AA_?$AAP?$AAO?$AAW?$AAE?$AAR?$AA_?$AAS?$AAE?$AAT?$AA?5@|
  0029c		 |$LN67@SetDeviceP|
  0029c	0000 0000	 DCD         |gBacklightMs|
  002a0		 |$LN68@SetDeviceP|
  002a0	0000 0000	 DCD         |??_C@_19HDEHKPMM@?$AAb?$AAk?$AAl?$AA1?$AA?$AA@|
  002a4		 |$LN69@SetDeviceP|
  002a4	0000 0000	 DCD         |??_C@_1GG@MKDGLGMP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAa?$AAc?$AAe?$AA?5?$AAd?$AAe?$AAt?$AAe?$AAc?$AAt?$AAe?$AAd?$AA?5?$AAo?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr@|
  002a8		 |$LN70@SetDeviceP|
  002a8	0000 0000	 DCD         |??_C@_1IA@NEEPNPJA@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAW?$AAr?$AAo?$AAn?$AAg?$AA?5?$AAR?$AAe?$AAt?$AAu?$AAr?$AAn?$AA?5?$AAV?$AAa?$AAl?$AAu?$AAe?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8@|
  002ac		 |$LN71@SetDeviceP|
  002ac	1008 0032	 DCD         0x321008
  002b0		 |$LN72@SetDeviceP|
  002b0	0000 0000	 DCD         |??_C@_1DC@NDCGFHLP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  002b4		 |$LN73@SetDeviceP|
  002b4	0000 0000	 DCD         |??_C@_1DK@KOLEMAMB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAp?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AAo?$AAf?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  002b8		 |$LN74@SetDeviceP|
  002b8	0000 0000	 DCD         |??_C@_1DO@JJNMPAOB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAi?$AAs?$AA?5?$AAa?$AAl?$AAr?$AAe?$AAa?$AAd?$AAy?$AA?5?$AAa?$AAt?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  002bc		 |$LN75@SetDeviceP|
  002bc	0000 0000	 DCD         |?dwStaticRefCount@?1??SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z@4KA|
  002c0		 |$LN76@SetDeviceP|
  002c0	0000 0000	 DCD         |??_C@_1HG@JFGNKFEM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAs?$AAe?$AAt?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAt?$AAo?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AA?$CI?$AAm?$AAa?$AAp?$AAp?$AAe?$AAd?$AA?5@|
  002c4		 |$LN77@SetDeviceP|
  002c4	0000 0000	 DCD         |dpCurSettings|
  002c8		 |$M61|

			 ENDP  ; |?SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z|, SetDevicePower

	EXPORT	|??_C@_1FC@CIFKLECB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAe?$AAn?$AAt?$AAr?$AAa?$AAn?$AAt?$AA?5?$AAs?$AAe?$AAt?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAs?$AAe?$AAt?$AAt@| [ DATA ] ; `string'
	EXPORT	|??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1LK@HNNJIBGA@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAe?$AAw?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?$CF?$AAd?$AA?5?$AA?$CI?$AAc?$AAu@| [ DATA ] ; `string'
	EXPORT	|??_C@_1LI@ONJFAOHO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAe?$AAd?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AAc?$AAu@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GC@MFOGLPNF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAa?$AAc?$AAe?$AA?5?$AAd?$AAe?$AAt?$AAe?$AAc?$AAt?$AAe?$AAd?$AA?5?$AAo?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAs?$AAe?$AAt?$AAt?$AAi@| [ DATA ] ; `string'
	EXPORT	|??_C@_1FK@CAIOEKPL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAr?$AAy?$AAi?$AAn?$AAg?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI@| [ DATA ] ; `string'
	EXPORT	|??_C@_1FE@DBFKJONC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AAf?$AAa@| [ DATA ] ; `string'
	EXPORT	|UpdateDeviceState|
	IMPORT	|gpCeilingDx|
	IMPORT	|gpFloorDx|
	IMPORT	|gpSystemPowerState|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$UpdateDeviceState| DCD imagerel |$LN36@UpdateDevi|
	DCD	0x1f6030d

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FE@DBFKJONC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AAf?$AAa@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "S", 0x0, "e", 0x0, "t"
	DCB	0x0, "D", 0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e"
	DCB	0x0, "P", 0x0, "o", 0x0, "w", 0x0, "e", 0x0, "r", 0x0, "("
	DCB	0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'", 0x0, ",", 0x0, " "
	DCB	0x0, "D", 0x0, "%", 0x0, "d", 0x0, ")", 0x0, " ", 0x0, "f"
	DCB	0x0, "a", 0x0, "i", 0x0, "l", 0x0, "e", 0x0, "d", 0x0, " "
	DCB	0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FK@CAIOEKPL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAr?$AAy?$AAi?$AAn?$AAg?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "t"
	DCB	0x0, "r", 0x0, "y", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, "("
	DCB	0x0, "%", 0x0, "d", 0x0, ")", 0x0, " ", 0x0, "S", 0x0, "e"
	DCB	0x0, "t", 0x0, "D", 0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c"
	DCB	0x0, "e", 0x0, "P", 0x0, "o", 0x0, "w", 0x0, "e", 0x0, "r"
	DCB	0x0, "(", 0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'", 0x0, ","
	DCB	0x0, " ", 0x0, "D", 0x0, "%", 0x0, "d", 0x0, ")", 0x0, 0xd
	DCB	0x0, 0xa, 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GC@MFOGLPNF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAa?$AAc?$AAe?$AA?5?$AAd?$AAe?$AAt?$AAe?$AAc?$AAt?$AAe?$AAd?$AA?5?$AAo?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAs?$AAe?$AAt?$AAt?$AAi@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "a", 0x0, "c"
	DCB	0x0, "e", 0x0, " ", 0x0, "d", 0x0, "e", 0x0, "t", 0x0, "e"
	DCB	0x0, "c", 0x0, "t", 0x0, "e", 0x0, "d", 0x0, " ", 0x0, "o"
	DCB	0x0, "n", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'"
	DCB	0x0, ",", 0x0, " ", 0x0, "s", 0x0, "e", 0x0, "t", 0x0, "t"
	DCB	0x0, "i", 0x0, "n", 0x0, "g", 0x0, " ", 0x0, "E", 0x0, "R"
	DCB	0x0, "R", 0x0, "O", 0x0, "R", 0x0, "_", 0x0, "R", 0x0, "E"
	DCB	0x0, "T", 0x0, "R", 0x0, "Y", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1LI@ONJFAOHO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAe?$AAd?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AAc?$AAu@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "u", 0x0, "p", 0x0, "d"
	DCB	0x0, "a", 0x0, "t", 0x0, "e", 0x0, "d", 0x0, " ", 0x0, "s"
	DCB	0x0, "t", 0x0, "a", 0x0, "t", 0x0, "e", 0x0, " ", 0x0, "f"
	DCB	0x0, "o", 0x0, "r", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, " ", 0x0, "i", 0x0, "s", 0x0, " ", 0x0, "c"
	DCB	0x0, "u", 0x0, "r", 0x0, "r", 0x0, "e", 0x0, "n", 0x0, "t"
	DCB	0x0, " ", 0x0, "%", 0x0, "d", 0x0, ",", 0x0, " ", 0x0, "r"
	DCB	0x0, "e", 0x0, "q", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, ","
	DCB	0x0, " ", 0x0, "s", 0x0, "e", 0x0, "t", 0x0, " ", 0x0, "%"
	DCB	0x0, "d", 0x0, ",", 0x0, " ", 0x0, "f", 0x0, "l", 0x0, "o"
	DCB	0x0, "o", 0x0, "r", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, ","
	DCB	0x0, " ", 0x0, "c", 0x0, "e", 0x0, "i", 0x0, "l", 0x0, "i"
	DCB	0x0, "n", 0x0, "g", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, ","
	DCB	0x0, " ", 0x0, "a", 0x0, "c", 0x0, "t", 0x0, "u", 0x0, "a"
	DCB	0x0, "l", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa
	DCB	0x0, 0x0, 0x0				; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1LK@HNNJIBGA@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAe?$AAw?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?$CF?$AAd?$AA?5?$AA?$CI?$AAc?$AAu@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "n", 0x0, "e", 0x0, "w"
	DCB	0x0, " ", 0x0, "s", 0x0, "t", 0x0, "a", 0x0, "t", 0x0, "e"
	DCB	0x0, " ", 0x0, "f", 0x0, "o", 0x0, "r", 0x0, " ", 0x0, "'"
	DCB	0x0, "%", 0x0, "s", 0x0, "'", 0x0, " ", 0x0, "i", 0x0, "s"
	DCB	0x0, " ", 0x0, "%", 0x0, "d", 0x0, " ", 0x0, "(", 0x0, "c"
	DCB	0x0, "u", 0x0, "r", 0x0, "r", 0x0, "e", 0x0, "n", 0x0, "t"
	DCB	0x0, " ", 0x0, "%", 0x0, "d", 0x0, ",", 0x0, " ", 0x0, "r"
	DCB	0x0, "e", 0x0, "q", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, ","
	DCB	0x0, " ", 0x0, "s", 0x0, "e", 0x0, "t", 0x0, " ", 0x0, "%"
	DCB	0x0, "d", 0x0, ",", 0x0, " ", 0x0, "f", 0x0, "l", 0x0, "o"
	DCB	0x0, "o", 0x0, "r", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, ","
	DCB	0x0, " ", 0x0, "c", 0x0, "e", 0x0, "i", 0x0, "l", 0x0, "i"
	DCB	0x0, "n", 0x0, "g", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, ","
	DCB	0x0, " ", 0x0, "a", 0x0, "c", 0x0, "t", 0x0, "u", 0x0, "a"
	DCB	0x0, "l", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, ")", 0x0, 0xd
	DCB	0x0, 0xa, 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@| DCB "U"
	DCB	0x0, "p", 0x0, "d", 0x0, "a", 0x0, "t", 0x0, "e", 0x0, "D"
	DCB	0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, "S"
	DCB	0x0, "t", 0x0, "a", 0x0, "t", 0x0, "e", 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FC@CIFKLECB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAe?$AAn?$AAt?$AAr?$AAa?$AAn?$AAt?$AA?5?$AAs?$AAe?$AAt?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAs?$AAe?$AAt?$AAt@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "e"
	DCB	0x0, "n", 0x0, "t", 0x0, "r", 0x0, "a", 0x0, "n", 0x0, "t"
	DCB	0x0, " ", 0x0, "s", 0x0, "e", 0x0, "t", 0x0, " ", 0x0, "f"
	DCB	0x0, "o", 0x0, "r", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, ",", 0x0, " ", 0x0, "s", 0x0, "e", 0x0, "t"
	DCB	0x0, "t", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " ", 0x0, "%"
	DCB	0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |UpdateDeviceState| PROC

; 506  : {

  00000		 |$LN36@UpdateDevi|
  00000	e92d 4ff0	 push        {r4-r11,lr}
  00004	f20d 0b1c	 addw        r11,sp,#0x1C
  00008	b087		 sub         sp,sp,#0x1C
  0000a		 |$M34|

; 507  :     BOOL fOk = TRUE;
; 508  :     DWORD dwStatus = ERROR_SUCCESS;

  0000a	2500		 movs        r5,#0

; 509  :     DWORD dwRetryCount = 0 ;

  0000c	2300		 movs        r3,#0
  0000e	f8df 81a0	 ldr         r8,|$LN49@UpdateDevi| ; =|dpCurSettings|
  00012	9306		 str         r3,[sp,#0x18]
  00014	4604		 mov         r4,r0
  00016		 |$LL13@UpdateDevi|

; 510  :     SETFNAME(_T("UpdateDeviceState"));
; 511  : 
; 512  :     do {
; 513  :         CEDEVICE_POWER_STATE newDx = PwrDeviceUnspecified;

  00016	f06f 0700	 mvn         r7,#0

; 514  :         CEDEVICE_POWER_STATE oldLastReqDx = D0;

  0001a	2600		 movs        r6,#0

; 515  :         BOOL fForce = FALSE;

  0001c	f04f 0a00	 mov         r10,#0

; 516  :         
; 517  :         PMLOCK();

  00020	f000 f800	 bl          PmLock

; 518  :         // get the new device power state (based on the last device power state
; 519  :         // the device wanted -- this value is initialized to D0 in case the 
; 520  :         // device never makes any power requests on its own.
; 521  :         fOk = GetNewDeviceStateInfo(&pds->floorDx, &pds->ceilingDx,
; 522  :             pds, gpSystemPowerState, gpFloorDx, gpCeilingDx);

  00024	4a61		 ldr         r2,|$LN48@UpdateDevi| ; =|gpCeilingDx|
  00026	f114 010c	 adds        r1,r4,#0xC
  0002a	f114 0008	 adds        r0,r4,#8
  0002e	6813		 ldr         r3,[r2]
  00030	4622		 mov         r2,r4
  00032	9301		 str         r3,[sp,#4]
  00034	4b5c		 ldr         r3,|$LN47@UpdateDevi| ; =|gpFloorDx|
  00036	681b		 ldr         r3,[r3]
  00038	9300		 str         r3,[sp]
  0003a	4b5a		 ldr         r3,|$LN46@UpdateDevi| ; =|gpSystemPowerState|
  0003c	681b		 ldr         r3,[r3]
  0003e	f000 f800	 bl          |?GetNewDeviceStateInfo@@YAHPAW4_CEDEVICE_POWER_STATE@@0PAU_DeviceState_tag@@PAU_SystemPowerState_tag@@PAU_DevicePowerRestriction_tag@@3@Z|
  00042	4681		 mov         r9,r0

; 523  :         if(fOk) {

  00044	b3c8		 cbz         r0,|$LN10@UpdateDevi|

; 524  :             // We have to monitor changes to pds->lastReqDx, since multiple threads can be 
; 525  :             // in the PM at once calling DevicePowerNotify().
; 526  :             newDx = GetNewDeviceDx(pds->lastReqDx, pds->curDx, pds->setDx, pds->floorDx, pds->ceilingDx);

  00046	68e2		 ldr         r2,[r4,#0xC]
  00048	6866		 ldr         r6,[r4,#4]
  0004a	68a3		 ldr         r3,[r4,#8]
  0004c	6960		 ldr         r0,[r4,#0x14]
  0004e	9200		 str         r2,[sp]
  00050	6922		 ldr         r2,[r4,#0x10]
  00052	4631		 mov         r1,r6
  00054	f000 f800	 bl          |?GetNewDeviceDx@@YA?AW4_CEDEVICE_POWER_STATE@@W41@0000@Z|
  00058	4607		 mov         r7,r0

; 527  :             if(newDx == PwrDeviceUnspecified && (pds->dwNumPending != 0 || dwStatus == ERROR_RETRY)) {

  0005a	f1b0 3fff	 cmp         r0,#0xFFFFFFFF
  0005e	d114		 bne         |$LN30@UpdateDevi|
  00060	6a22		 ldr         r2,[r4,#0x20]
  00062	b91a		 cbnz        r2,|$LN8@UpdateDevi|
  00064	f240 43d5	 mov         r3,#0x4D5
  00068	429d		 cmp         r5,r3
  0006a	d10e		 bne         |$LN30@UpdateDevi|
  0006c		 |$LN8@UpdateDevi|

; 528  :                 PMLOGMSG(ZONE_DEVICE, 
; 529  :                     (_T("%s: reentrant set for '%s', setting %d\r\n"), pszFname, pds->pszName, pds->curDx));

  0006c	f8d8 2440	 ldr         r2,[r8,#0x440]
  00070	f012 0f10	 tst         r2,#0x10
  00074	d005		 beq         |$LN16@UpdateDevi|
  00076	6822		 ldr         r2,[r4]
  00078	4944		 ldr         r1,|$LN40@UpdateDevi| ; =|??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  0007a	4849		 ldr         r0,|$LN45@UpdateDevi| ; =|??_C@_1FC@CIFKLECB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAe?$AAn?$AAt?$AAr?$AAa?$AAn?$AAt?$AA?5?$AAs?$AAe?$AAt?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAs?$AAe?$AAt?$AAt@|
  0007c	4633		 mov         r3,r6
  0007e	f000 f800	 bl          CeLogMsg
  00082		 |$LN16@UpdateDevi|

; 530  :                 newDx = pds->curDx;

  00082	6866		 ldr         r6,[r4,#4]

; 531  :                 fForce = TRUE;

  00084	f04f 0a01	 mov         r10,#1
  00088	4637		 mov         r7,r6
  0008a		 |$LN30@UpdateDevi|

; 532  :             }
; 533  :             PMLOGMSG(ZONE_DEVICE, 
; 534  :                 (_T("%s: new state for '%s' is %d (current %d, req %d, set %d, floor %d, ceiling %d, actual %d)\r\n"),
; 535  :                 pszFname, pds->pszName, newDx, pds->curDx, pds->lastReqDx, pds->setDx, pds->floorDx, pds->ceilingDx, pds->actualDx));

  0008a	f8d8 3440	 ldr         r3,[r8,#0x440]
  0008e	f013 0f10	 tst         r3,#0x10
  00092	d010		 beq         |$LN18@UpdateDevi|
  00094	69a3		 ldr         r3,[r4,#0x18]
  00096	6822		 ldr         r2,[r4]
  00098	493c		 ldr         r1,|$LN40@UpdateDevi| ; =|??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  0009a	9305		 str         r3,[sp,#0x14]
  0009c	68e3		 ldr         r3,[r4,#0xC]
  0009e	483f		 ldr         r0,|$LN44@UpdateDevi| ; =|??_C@_1LK@HNNJIBGA@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAe?$AAw?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?$CF?$AAd?$AA?5?$AA?$CI?$AAc?$AAu@|
  000a0	9600		 str         r6,[sp]
  000a2	9304		 str         r3,[sp,#0x10]
  000a4	68a3		 ldr         r3,[r4,#8]
  000a6	9303		 str         r3,[sp,#0xC]
  000a8	6923		 ldr         r3,[r4,#0x10]
  000aa	9302		 str         r3,[sp,#8]
  000ac	6963		 ldr         r3,[r4,#0x14]
  000ae	9301		 str         r3,[sp,#4]
  000b0	463b		 mov         r3,r7
  000b2	f000 f800	 bl          CeLogMsg
  000b6		 |$LN18@UpdateDevi|

; 536  :             oldLastReqDx = pds->lastReqDx;

  000b6	6966		 ldr         r6,[r4,#0x14]

; 537  :             dwStatus = ERROR_SUCCESS;

  000b8	2500		 movs        r5,#0
  000ba		 |$LN10@UpdateDevi|

; 538  :         }
; 539  :         PMUNLOCK();

  000ba	f000 f800	 bl          PmUnlock

; 540  : 
; 541  :         // do we need to update the device?
; 542  :         if(fOk && newDx != PwrDeviceUnspecified) {

  000be	f1b9 0f00	 cmp         r9,#0
  000c2	d05c		 beq         |$LN1@UpdateDevi|
  000c4	f1b7 3fff	 cmp         r7,#0xFFFFFFFF
  000c8	d051		 beq         |$LN32@UpdateDevi|

; 543  :             // yes, set its power state to the new value
; 544  :             dwStatus = SetDevicePower(pds, newDx, fForce);

  000ca	4652		 mov         r2,r10
  000cc	4639		 mov         r1,r7
  000ce	4620		 mov         r0,r4
  000d0	f000 f800	 bl          |?SetDevicePower@@YAKPAU_DeviceState_tag@@W4_CEDEVICE_POWER_STATE@@H@Z|
  000d4	4605		 mov         r5,r0

; 545  :             if(dwStatus == ERROR_SUCCESS) {

  000d6	bb45		 cbnz        r5,|$LN6@UpdateDevi|

; 546  :                 PMLOCK();

  000d8	f000 f800	 bl          PmLock

; 547  :                 PMLOGMSG(ZONE_DEVICE, 
; 548  :                     (_T("%s: updated state for '%s' is current %d, req %d, set %d, floor %d, ceiling %d, actual %d\r\n"),
; 549  :                     pszFname, pds->pszName, pds->curDx, pds->lastReqDx, pds->setDx, pds->floorDx, pds->ceilingDx, pds->actualDx));

  000dc	f8d8 2440	 ldr         r2,[r8,#0x440]
  000e0	f012 0f10	 tst         r2,#0x10
  000e4	d011		 beq         |$LN20@UpdateDevi|
  000e6	69a3		 ldr         r3,[r4,#0x18]
  000e8	6822		 ldr         r2,[r4]
  000ea	4928		 ldr         r1,|$LN40@UpdateDevi| ; =|??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  000ec	9304		 str         r3,[sp,#0x10]
  000ee	68e3		 ldr         r3,[r4,#0xC]
  000f0	4829		 ldr         r0,|$LN43@UpdateDevi| ; =|??_C@_1LI@ONJFAOHO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAe?$AAd?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AAc?$AAu@|
  000f2	9303		 str         r3,[sp,#0xC]
  000f4	68a3		 ldr         r3,[r4,#8]
  000f6	9302		 str         r3,[sp,#8]
  000f8	6923		 ldr         r3,[r4,#0x10]
  000fa	9301		 str         r3,[sp,#4]
  000fc	6963		 ldr         r3,[r4,#0x14]
  000fe	9300		 str         r3,[sp]
  00100	6863		 ldr         r3,[r4,#4]
  00102	f000 f800	 bl          CeLogMsg
  00106	f8d8 2440	 ldr         r2,[r8,#0x440]
  0010a		 |$LN20@UpdateDevi|

; 550  :                 if(pds->lastReqDx != oldLastReqDx) {

  0010a	6963		 ldr         r3,[r4,#0x14]
  0010c	42b3		 cmp         r3,r6
  0010e	d00a		 beq         |$LN5@UpdateDevi|

; 551  :                     PMLOGMSG(ZONE_DEVICE, (_T("%s: race detected on '%s', setting ERROR_RETRY\r\n"),
; 552  :                         pszFname, pds->pszName));

  00110	f012 0f10	 tst         r2,#0x10
  00114	d004		 beq         |$LN22@UpdateDevi|
  00116	6822		 ldr         r2,[r4]
  00118	491c		 ldr         r1,|$LN40@UpdateDevi| ; =|??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  0011a	481e		 ldr         r0,|$LN42@UpdateDevi| ; =|??_C@_1GC@MFOGLPNF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAa?$AAc?$AAe?$AA?5?$AAd?$AAe?$AAt?$AAe?$AAc?$AAt?$AAe?$AAd?$AA?5?$AAo?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAs?$AAe?$AAt?$AAt?$AAi@|
  0011c	f000 f800	 bl          CeLogMsg
  00120		 |$LN22@UpdateDevi|

; 553  :                     dwStatus = ERROR_RETRY;

  00120	f240 43d5	 mov         r3,#0x4D5
  00124	461d		 mov         r5,r3
  00126		 |$LN5@UpdateDevi|

; 554  :                 }
; 555  :                 PMUNLOCK();

  00126	f000 f800	 bl          PmUnlock
  0012a		 |$LN6@UpdateDevi|

; 556  :             }
; 557  :             
; 558  :             if(dwStatus == ERROR_RETRY) {

  0012a	f240 43d5	 mov         r3,#0x4D5
  0012e	429d		 cmp         r5,r3
  00130	d10e		 bne         |$LN4@UpdateDevi|

; 559  :                 dwRetryCount++;

  00132	9a06		 ldr         r2,[sp,#0x18]

; 560  :                 PMLOGMSG(ZONE_DEVICE, (_T("%s: retrying(%d) SetDevicePower('%s', D%d)\r\n"), 
; 561  :                     pszFname,dwRetryCount, pds->pszName, newDx));

  00134	f8d8 3440	 ldr         r3,[r8,#0x440]
  00138	3201		 adds        r2,#1
  0013a	9206		 str         r2,[sp,#0x18]
  0013c	f013 0f10	 tst         r3,#0x10
  00140	d015		 beq         |$LN32@UpdateDevi|
  00142	6823		 ldr         r3,[r4]
  00144	4911		 ldr         r1,|$LN40@UpdateDevi| ; =|??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  00146	4812		 ldr         r0,|$LN41@UpdateDevi| ; =|??_C@_1FK@CAIOEKPL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAr?$AAy?$AAi?$AAn?$AAg?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI@|
  00148	9700		 str         r7,[sp]
  0014a	f000 f800	 bl          CeLogMsg

; 562  :             } else if(dwStatus != ERROR_SUCCESS) {

  0014e	e00e		 b           |$LN32@UpdateDevi|
  00150		 |$LN4@UpdateDevi|
  00150	b17d		 cbz         r5,|$LN12@UpdateDevi|

; 563  :                 PMLOGMSG(ZONE_DEVICE, (_T("%s: SetDevicePower('%s', D%d) failed %d\r\n"), 
; 564  :                     pszFname, pds->pszName, newDx, dwStatus));

  00152	f8d8 3440	 ldr         r3,[r8,#0x440]
  00156	f013 0f10	 tst         r3,#0x10
  0015a	d006		 beq         |$LN26@UpdateDevi|
  0015c	6822		 ldr         r2,[r4]
  0015e	490b		 ldr         r1,|$LN40@UpdateDevi| ; =|??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  00160	4809		 ldr         r0,|$LN39@UpdateDevi| ; =|??_C@_1FE@DBFKJONC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AAf?$AAa@|
  00162	463b		 mov         r3,r7
  00164	9500		 str         r5,[sp]
  00166	f000 f800	 bl          CeLogMsg
  0016a		 |$LN26@UpdateDevi|

; 565  :                 fOk = FALSE;

  0016a	f04f 0900	 mov         r9,#0
  0016e		 |$LN32@UpdateDevi|
  0016e	f240 43d5	 mov         r3,#0x4D5
  00172		 |$LN12@UpdateDevi|

; 566  :             }
; 567  :         }
; 568  :     } while(fOk && dwStatus == ERROR_RETRY);

  00172	f1b9 0f00	 cmp         r9,#0
  00176	d002		 beq         |$LN1@UpdateDevi|
  00178	429d		 cmp         r5,r3
  0017a	f43f af4c	 beq         |$LL13@UpdateDevi|
  0017e		 |$LN1@UpdateDevi|

; 569  : 
; 570  :     return fOk;
; 571  : }

  0017e	4648		 mov         r0,r9
  00180		 |$M37|
  00180	b007		 add         sp,sp,#0x1C
  00182	e8bd 8ff0	 pop         {r4-r11,pc}
  00186		 |$LN50@UpdateDevi|
  00186		 |$M51|
  00186	defe		 __debugbreak
  00188		 |$LN38@UpdateDevi|
  00188		 |$LN39@UpdateDevi|
  00188	0000 0000	 DCD         |??_C@_1FE@DBFKJONC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAD?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AAf?$AAa@|
  0018c		 |$LN40@UpdateDevi|
  0018c	0000 0000	 DCD         |??_C@_1CE@BHDGPEPL@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AA?$AA@|
  00190		 |$LN41@UpdateDevi|
  00190	0000 0000	 DCD         |??_C@_1FK@CAIOEKPL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAr?$AAy?$AAi?$AAn?$AAg?$AA?$CI?$AA?$CF?$AAd?$AA?$CJ?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI@|
  00194		 |$LN42@UpdateDevi|
  00194	0000 0000	 DCD         |??_C@_1GC@MFOGLPNF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAa?$AAc?$AAe?$AA?5?$AAd?$AAe?$AAt?$AAe?$AAc?$AAt?$AAe?$AAd?$AA?5?$AAo?$AAn?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAs?$AAe?$AAt?$AAt?$AAi@|
  00198		 |$LN43@UpdateDevi|
  00198	0000 0000	 DCD         |??_C@_1LI@ONJFAOHO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAe?$AAd?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AAc?$AAu@|
  0019c		 |$LN44@UpdateDevi|
  0019c	0000 0000	 DCD         |??_C@_1LK@HNNJIBGA@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAe?$AAw?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?$CF?$AAd?$AA?5?$AA?$CI?$AAc?$AAu@|
  001a0		 |$LN45@UpdateDevi|
  001a0	0000 0000	 DCD         |??_C@_1FC@CIFKLECB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAe?$AAn?$AAt?$AAr?$AAa?$AAn?$AAt?$AA?5?$AAs?$AAe?$AAt?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAs?$AAe?$AAt?$AAt@|
  001a4		 |$LN46@UpdateDevi|
  001a4	0000 0000	 DCD         |gpSystemPowerState|
  001a8		 |$LN47@UpdateDevi|
  001a8	0000 0000	 DCD         |gpFloorDx|
  001ac		 |$LN48@UpdateDevi|
  001ac	0000 0000	 DCD         |gpCeilingDx|
  001b0		 |$LN49@UpdateDevi|
  001b0	0000 0000	 DCD         |dpCurSettings|
  001b4		 |$M35|

			 ENDP  ; |UpdateDeviceState|

	EXPORT	|??_C@_1FA@FGBEELGK@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAq?$AA?5?$AA?$CF?$AAd?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0@| [ DATA ] ; `string'
	EXPORT	|??_C@_1CI@COLEMICB@?$AAP?$AAm?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAN?$AAo?$AAt?$AAi?$AAf?$AAy?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1KG@JKPCLJLL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAe?$AAs?$AAt?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AAD?$AA?$CF?$AAd?$AA?0@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GM@CAMFMNBC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5@| [ DATA ] ; `string'
	EXPORT	|??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|PmDevicePowerNotify|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$PmDevicePowerNotify| DCD imagerel |$LN28@PmDevicePo|
	DCD	0xfdf501e1

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "t"
	DCB	0x0, "u", 0x0, "r", 0x0, "n", 0x0, "i", 0x0, "n", 0x0, "g"
	DCB	0x0, " ", 0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GM@CAMFMNBC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "S", 0x0, "e", 0x0, "t"
	DCB	0x0, "D", 0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e"
	DCB	0x0, "P", 0x0, "o", 0x0, "w", 0x0, "e", 0x0, "r", 0x0, "("
	DCB	0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'", 0x0, ")", 0x0, " "
	DCB	0x0, "f", 0x0, "a", 0x0, "i", 0x0, "l", 0x0, "e", 0x0, "d"
	DCB	0x0, " ", 0x0, "w", 0x0, "h", 0x0, "e", 0x0, "n", 0x0, " "
	DCB	0x0, "r", 0x0, "e", 0x0, "q", 0x0, "u", 0x0, "e", 0x0, "s"
	DCB	0x0, "t", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " ", 0x0, "D"
	DCB	0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1KG@JKPCLJLL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAe?$AAs?$AAt?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AAD?$AA?$CF?$AAd?$AA?0@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "d", 0x0, "e", 0x0, "v"
	DCB	0x0, "i", 0x0, "c", 0x0, "e", 0x0, " ", 0x0, "'", 0x0, "%"
	DCB	0x0, "s", 0x0, "'", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "q"
	DCB	0x0, "u", 0x0, "e", 0x0, "s", 0x0, "t", 0x0, " ", 0x0, "f"
	DCB	0x0, "o", 0x0, "r", 0x0, " ", 0x0, "D", 0x0, "%", 0x0, "d"
	DCB	0x0, ",", 0x0, " ", 0x0, "c", 0x0, "u", 0x0, "r", 0x0, "D"
	DCB	0x0, "x", 0x0, " ", 0x0, "D", 0x0, "%", 0x0, "d", 0x0, ","
	DCB	0x0, " ", 0x0, "f", 0x0, "l", 0x0, "o", 0x0, "o", 0x0, "r"
	DCB	0x0, "D", 0x0, "x", 0x0, " ", 0x0, "D", 0x0, "%", 0x0, "d"
	DCB	0x0, ",", 0x0, " ", 0x0, "c", 0x0, "e", 0x0, "i", 0x0, "l"
	DCB	0x0, "i", 0x0, "n", 0x0, "g", 0x0, "D", 0x0, "x", 0x0, " "
	DCB	0x0, "D", 0x0, "%", 0x0, "d", 0x0, ",", 0x0, " ", 0x0, "s"
	DCB	0x0, "e", 0x0, "t", 0x0, "D", 0x0, "x", 0x0, " ", 0x0, "%"
	DCB	0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1CI@COLEMICB@?$AAP?$AAm?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAN?$AAo?$AAt?$AAi?$AAf?$AAy?$AA?$AA@| DCB "P"
	DCB	0x0, "m", 0x0, "D", 0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c"
	DCB	0x0, "e", 0x0, "P", 0x0, "o", 0x0, "w", 0x0, "e", 0x0, "r"
	DCB	0x0, "N", 0x0, "o", 0x0, "t", 0x0, "i", 0x0, "f", 0x0, "y"
	DCB	0x0, 0x0, 0x0				; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FA@FGBEELGK@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAq?$AA?5?$AA?$CF?$AAd?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0@| DCB "+"
	DCB	0x0, "%", 0x0, "s", 0x0, ":", 0x0, " ", 0x0, "d", 0x0, "e"
	DCB	0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, " ", 0x0, "'"
	DCB	0x0, "%", 0x0, "s", 0x0, "'", 0x0, " ", 0x0, "r", 0x0, "e"
	DCB	0x0, "q", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, ",", 0x0, " "
	DCB	0x0, "f", 0x0, "l", 0x0, "a", 0x0, "g", 0x0, "s", 0x0, " "
	DCB	0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "8", 0x0, "x"
	DCB	0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0	; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |PmDevicePowerNotify| PROC

; 1268 : {

  00000		 |$LN28@PmDevicePo|
  00000	e92d 4bff	 push        {r0-r9,r11,lr}
  00004	f20d 0b28	 addw        r11,sp,#0x28
  00008		 |$M26|

; 1269 :     DWORD dwStatus = ERROR_SUCCESS;
; 1270 :     PDEVICEID pdi = NULL;
; 1271 :     SETFNAME(_T("PmDevicePowerNotify"));
; 1272 : 
; 1273 :     PMLOGMSG(ZONE_API, (_T("+%s: device '%s' req %d, flags 0x%08x\r\n"), pszFname, 
; 1274 :         (dwDeviceFlags & POWER_NAME) != 0 ? (LPTSTR) pvDevice : _T("<UNKNOWN>"),
; 1275 :         reqDx, dwDeviceFlags));

  00008	4f3f		 ldr         r7,|$LN37@PmDevicePo| ; =|dpCurSettings|
  0000a	2400		 movs        r4,#0
  0000c	2600		 movs        r6,#0
  0000e	f8d7 3440	 ldr         r3,[r7,#0x440]
  00012	4691		 mov         r9,r2
  00014	4688		 mov         r8,r1
  00016	f413 6f00	 tst         r3,#0x800
  0001a	4605		 mov         r5,r0
  0001c	d00c		 beq         |$LN14@PmDevicePo|
  0001e	f012 0f01	 tst         r2,#1
  00022	d001		 beq         |$LN12@PmDevicePo|
  00024	4602		 mov         r2,r0
  00026	e000		 b           |$LN13@PmDevicePo|
  00028		 |$LN12@PmDevicePo|
  00028	4a36		 ldr         r2,|$LN36@PmDevicePo| ; =|??_C@_1BE@GFCJAFPH@?$AA?$DM?$AAU?$AAN?$AAK?$AAN?$AAO?$AAW?$AAN?$AA?$DO?$AA?$AA@|
  0002a		 |$LN13@PmDevicePo|
  0002a	4835		 ldr         r0,|$LN35@PmDevicePo| ; =|??_C@_1FA@FGBEELGK@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAq?$AA?5?$AA?$CF?$AAd?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0@|
  0002c	4930		 ldr         r1,|$LN31@PmDevicePo| ; =|??_C@_1CI@COLEMICB@?$AAP?$AAm?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAN?$AAo?$AAt?$AAi?$AAf?$AAy?$AA?$AA@|
  0002e	4643		 mov         r3,r8
  00030	f8cd 9000	 str         r9,[sp]
  00034	f000 f800	 bl          CeLogMsg
  00038		 |$LN14@PmDevicePo|

; 1276 : 
; 1277 :     // sanity check parameters
; 1278 :     if(pvDevice == NULL 
; 1279 :     || (reqDx < D0 || reqDx > D4)
; 1280 :     || (pdi = DeviceIdParseNameString((LPCTSTR) pvDevice, dwDeviceFlags)) == NULL) {

  00038	2d00		 cmp         r5,#0
  0003a	d040		 beq         |$LN23@PmDevicePo|
  0003c	f1b8 0f04	 cmp         r8,#4
  00040	d83d		 bhi         |$LN23@PmDevicePo|
  00042	4649		 mov         r1,r9
  00044	4628		 mov         r0,r5
  00046	f000 f800	 bl          DeviceIdParseNameString
  0004a	4606		 mov         r6,r0
  0004c	b3be		 cbz         r6,|$LN23@PmDevicePo|

; 1282 :     } else {
; 1283 :         PDEVICE_LIST pdl;
; 1284 :         BOOL fOk = TRUE;
; 1285 : 
; 1286 :         // look for the device list and the device
; 1287 :         pdl = GetDeviceListFromClass(pdi->pGuid);

  0004e	6830		 ldr         r0,[r6]
  00050	f000 f800	 bl          GetDeviceListFromClass

; 1288 :         if(pdl == NULL) {

  00054	b120		 cbz         r0,|$LN24@PmDevicePo|

; 1289 :             dwStatus = ERROR_FILE_NOT_FOUND;
; 1290 :         } else {
; 1291 :             PDEVICE_STATE pds = DeviceStateFindList(pdl, pdi->pszName);

  00056	6871		 ldr         r1,[r6,#4]
  00058	f000 f800	 bl          DeviceStateFindList
  0005c	4605		 mov         r5,r0

; 1292 :             if(pds == NULL) {

  0005e	b90d		 cbnz        r5,|$LN4@PmDevicePo|
  00060		 |$LN24@PmDevicePo|

; 1293 :                 dwStatus = ERROR_FILE_NOT_FOUND;

  00060	2402		 movs        r4,#2

; 1294 :             } else {

  00062	e02d		 b           |$LN3@PmDevicePo|
  00064		 |$LN4@PmDevicePo|

; 1295 :                 PMLOCK();

  00064	f000 f800	 bl          PmLock

; 1296 :                 
; 1297 :                 PMLOGMSG(ZONE_DEVICE, 
; 1298 :                     (_T("%s: device '%s' request for D%d, curDx D%d, floorDx D%d, ceilingDx D%d, setDx %d\r\n"),
; 1299 :                     pszFname, pds->pszName, reqDx, pds->curDx, pds->floorDx, pds->ceilingDx, pds->setDx));

  00068	f8d7 3440	 ldr         r3,[r7,#0x440]
  0006c	f013 0f10	 tst         r3,#0x10
  00070	d00d		 beq         |$LN16@PmDevicePo|
  00072	692b		 ldr         r3,[r5,#0x10]
  00074	682a		 ldr         r2,[r5]
  00076	4821		 ldr         r0,|$LN34@PmDevicePo| ; =|??_C@_1KG@JKPCLJLL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAe?$AAs?$AAt?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AAD?$AA?$CF?$AAd?$AA?0@|
  00078	9303		 str         r3,[sp,#0xC]
  0007a	68eb		 ldr         r3,[r5,#0xC]
  0007c	491c		 ldr         r1,|$LN31@PmDevicePo| ; =|??_C@_1CI@COLEMICB@?$AAP?$AAm?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAN?$AAo?$AAt?$AAi?$AAf?$AAy?$AA?$AA@|
  0007e	9302		 str         r3,[sp,#8]
  00080	68ab		 ldr         r3,[r5,#8]
  00082	9301		 str         r3,[sp,#4]
  00084	686b		 ldr         r3,[r5,#4]
  00086	9300		 str         r3,[sp]
  00088	4643		 mov         r3,r8
  0008a	f000 f800	 bl          CeLogMsg
  0008e		 |$LN16@PmDevicePo|

; 1300 :                 
; 1301 :                 // record this state change request
; 1302 :                 pds->lastReqDx = reqDx;

  0008e	f8c5 8014	 str         r8,[r5,#0x14]

; 1303 : 
; 1304 :                 PMUNLOCK();

  00092	f000 f800	 bl          PmUnlock

; 1305 : 
; 1306 :                 // change the device power state if necessary
; 1307 :                 fOk = UpdateDeviceState(pds);

  00096	4628		 mov         r0,r5
  00098	f000 f800	 bl          UpdateDeviceState

; 1308 :                 if(!fOk) {

  0009c	b958		 cbnz        r0,|$LN2@PmDevicePo|

; 1309 :                     PMLOGMSG(ZONE_WARN, 
; 1310 :                         (_T("%s: SetDevicePower('%s') failed when requesting D%d\r\n"),
; 1311 :                         pszFname, pds->pszName, reqDx));

  0009e	f8d7 3440	 ldr         r3,[r7,#0x440]
  000a2	f013 0f02	 tst         r3,#2
  000a6	d005		 beq         |$LN18@PmDevicePo|
  000a8	682a		 ldr         r2,[r5]
  000aa	4813		 ldr         r0,|$LN33@PmDevicePo| ; =|??_C@_1GM@CAMFMNBC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5@|
  000ac	4910		 ldr         r1,|$LN31@PmDevicePo| ; =|??_C@_1CI@COLEMICB@?$AAP?$AAm?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAN?$AAo?$AAt?$AAi?$AAf?$AAy?$AA?$AA@|
  000ae	4643		 mov         r3,r8
  000b0	f000 f800	 bl          CeLogMsg
  000b4		 |$LN18@PmDevicePo|

; 1312 :                     dwStatus = ERROR_WRITE_FAULT;

  000b4	241d		 movs        r4,#0x1D
  000b6		 |$LN2@PmDevicePo|

; 1313 :                 }
; 1314 :                 
; 1315 :                 // done with the device state pointer
; 1316 :                 DeviceStateDecRef(pds);

  000b6	4628		 mov         r0,r5
  000b8	f000 f800	 bl          DeviceStateDecRef
  000bc	e000		 b           |$LN3@PmDevicePo|
  000be		 |$LN23@PmDevicePo|

; 1281 :         dwStatus = ERROR_INVALID_PARAMETER;

  000be	2457		 movs        r4,#0x57
  000c0		 |$LN3@PmDevicePo|

; 1317 :             }
; 1318 :         }
; 1319 :     }
; 1320 : 
; 1321 :     // release resources
; 1322 :     if(pdi != NULL) DeviceIdDestroy(pdi);

  000c0	b116		 cbz         r6,|$LN1@PmDevicePo|
  000c2	4630		 mov         r0,r6
  000c4	f000 f800	 bl          DeviceIdDestroy
  000c8		 |$LN1@PmDevicePo|

; 1323 : 
; 1324 :     PMLOGMSG((dwStatus != ERROR_SUCCESS && ZONE_WARN) || ZONE_API,
; 1325 :         (_T("%s: returning %d\r\n"), pszFname, dwStatus));

  000c8	b124		 cbz         r4,|$LN20@PmDevicePo|
  000ca	f8d7 3440	 ldr         r3,[r7,#0x440]
  000ce	f013 0f02	 tst         r3,#2
  000d2	d104		 bne         |$LN21@PmDevicePo|
  000d4		 |$LN20@PmDevicePo|

; 1269 :     DWORD dwStatus = ERROR_SUCCESS;
; 1270 :     PDEVICEID pdi = NULL;
; 1271 :     SETFNAME(_T("PmDevicePowerNotify"));
; 1272 : 
; 1273 :     PMLOGMSG(ZONE_API, (_T("+%s: device '%s' req %d, flags 0x%08x\r\n"), pszFname, 
; 1274 :         (dwDeviceFlags & POWER_NAME) != 0 ? (LPTSTR) pvDevice : _T("<UNKNOWN>"),
; 1275 :         reqDx, dwDeviceFlags));

  000d4	f8d7 3440	 ldr         r3,[r7,#0x440]

; 1323 : 
; 1324 :     PMLOGMSG((dwStatus != ERROR_SUCCESS && ZONE_WARN) || ZONE_API,
; 1325 :         (_T("%s: returning %d\r\n"), pszFname, dwStatus));

  000d8	f413 6f00	 tst         r3,#0x800
  000dc	d004		 beq         |$LN22@PmDevicePo|
  000de		 |$LN21@PmDevicePo|
  000de	4805		 ldr         r0,|$LN32@PmDevicePo| ; =|??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  000e0	4903		 ldr         r1,|$LN31@PmDevicePo| ; =|??_C@_1CI@COLEMICB@?$AAP?$AAm?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAN?$AAo?$AAt?$AAi?$AAf?$AAy?$AA?$AA@|
  000e2	4622		 mov         r2,r4
  000e4	f000 f800	 bl          CeLogMsg
  000e8		 |$LN22@PmDevicePo|

; 1326 :     return dwStatus;
; 1327 : }

  000e8	4620		 mov         r0,r4
  000ea		 |$M29|
  000ea	b004		 add         sp,sp,#0x10
  000ec	e8bd 8bf0	 pop         {r4-r9,r11,pc}
  000f0		 |$LN30@PmDevicePo|
  000f0		 |$LN31@PmDevicePo|
  000f0	0000 0000	 DCD         |??_C@_1CI@COLEMICB@?$AAP?$AAm?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAN?$AAo?$AAt?$AAi?$AAf?$AAy?$AA?$AA@|
  000f4		 |$LN32@PmDevicePo|
  000f4	0000 0000	 DCD         |??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  000f8		 |$LN33@PmDevicePo|
  000f8	0000 0000	 DCD         |??_C@_1GM@CAMFMNBC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5@|
  000fc		 |$LN34@PmDevicePo|
  000fc	0000 0000	 DCD         |??_C@_1KG@JKPCLJLL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAe?$AAs?$AAt?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AAD?$AA?$CF?$AAd?$AA?0@|
  00100		 |$LN35@PmDevicePo|
  00100	0000 0000	 DCD         |??_C@_1FA@FGBEELGK@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAq?$AA?5?$AA?$CF?$AAd?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0@|
  00104		 |$LN36@PmDevicePo|
  00104	0000 0000	 DCD         |??_C@_1BE@GFCJAFPH@?$AA?$DM?$AAU?$AAN?$AAK?$AAN?$AAO?$AAW?$AAN?$AA?$DO?$AA?$AA@|
  00108		 |$LN37@PmDevicePo|
  00108	0000 0000	 DCD         |dpCurSettings|
  0010c		 |$M27|

			 ENDP  ; |PmDevicePowerNotify|

	EXPORT	|??_C@_1FE@FDHIODBM@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?$CF?$AAs?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAn?$AAe@| [ DATA ] ; `string'
	EXPORT	|??_C@_1CC@LDMFDOHP@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|PmSetDevicePower|
	IMPORT	|PmEnterUpdate|
	IMPORT	|PmLeaveUpdate|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$PmSetDevicePower| DCD imagerel |$LN25@PmSetDevic|
	DCD	0xfd7561e1

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1CC@LDMFDOHP@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@| DCB "P"
	DCB	0x0, "m", 0x0, "S", 0x0, "e", 0x0, "t", 0x0, "D", 0x0, "e"
	DCB	0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, "P", 0x0, "o"
	DCB	0x0, "w", 0x0, "e", 0x0, "r", 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FE@FDHIODBM@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?$CF?$AAs?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAn?$AAe@| DCB "+"
	DCB	0x0, "%", 0x0, "s", 0x0, ":", 0x0, " ", 0x0, "d", 0x0, "e"
	DCB	0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, " ", 0x0, "%"
	DCB	0x0, "s", 0x0, ",", 0x0, " ", 0x0, "f", 0x0, "l", 0x0, "a"
	DCB	0x0, "g", 0x0, "s", 0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%"
	DCB	0x0, "0", 0x0, "8", 0x0, "x", 0x0, ",", 0x0, " ", 0x0, "n"
	DCB	0x0, "e", 0x0, "w", 0x0, " ", 0x0, "D", 0x0, "x", 0x0, " "
	DCB	0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |PmSetDevicePower| PROC

; 1190 : {

  00000		 |$LN25@PmSetDevic|
  00000	e92d 4bfc	 push        {r2-r9,r11,lr}
  00004	f20d 0b20	 addw        r11,sp,#0x20
  00008		 |$M23|

; 1191 :     DWORD dwStatus = ERROR_FILE_NOT_FOUND;
; 1192 :     PDEVICEID pdi = NULL;
; 1193 :     SETFNAME(_T("PmSetDevicePower"));
; 1194 : 
; 1195 :     PMLOGMSG(ZONE_API || ZONE_DEVICE, (_T("+%s: device %s, flags 0x%08x, new Dx %d\r\n"),
; 1196 :         pszFname, (dwDeviceFlags & POWER_NAME) != 0 ? (LPTSTR) pvDevice : _T("<UNKNOWN>"),
; 1197 :         dwDeviceFlags, newDx));

  00008	f8df 90f4	 ldr         r9,|$LN32@PmSetDevic| ; =|dpCurSettings|
  0000c	2402		 movs        r4,#2
  0000e	2700		 movs        r7,#0
  00010	f8d9 3440	 ldr         r3,[r9,#0x440]
  00014	4616		 mov         r6,r2
  00016	4688		 mov         r8,r1
  00018	f413 6f00	 tst         r3,#0x800
  0001c	4605		 mov         r5,r0
  0001e	d102		 bne         |$LN15@PmSetDevic|
  00020	f013 0f10	 tst         r3,#0x10
  00024	d00b		 beq         |$LN18@PmSetDevic|
  00026		 |$LN15@PmSetDevic|
  00026	f018 0f01	 tst         r8,#1
  0002a	d001		 beq         |$LN16@PmSetDevic|
  0002c	462a		 mov         r2,r5
  0002e	e000		 b           |$LN17@PmSetDevic|
  00030		 |$LN16@PmSetDevic|
  00030	4a32		 ldr         r2,|$LN31@PmSetDevic| ; =|??_C@_1BE@GFCJAFPH@?$AA?$DM?$AAU?$AAN?$AAK?$AAN?$AAO?$AAW?$AAN?$AA?$DO?$AA?$AA@|
  00032		 |$LN17@PmSetDevic|
  00032	4831		 ldr         r0,|$LN30@PmSetDevic| ; =|??_C@_1FE@FDHIODBM@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?$CF?$AAs?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAn?$AAe@|
  00034	492e		 ldr         r1,|$LN28@PmSetDevic| ; =|??_C@_1CC@LDMFDOHP@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  00036	4643		 mov         r3,r8
  00038	9600		 str         r6,[sp]
  0003a	f000 f800	 bl          CeLogMsg
  0003e		 |$LN18@PmSetDevic|

; 1198 : 
; 1199 :     PMENTERUPDATE();

  0003e	f000 f800	 bl          PmEnterUpdate

; 1200 : 
; 1201 :     // sanity check parameters
; 1202 :     if(pvDevice == NULL 
; 1203 :     || ((newDx < D0 || newDx > D4) && newDx != PwrDeviceUnspecified)
; 1204 :     || (pdi = DeviceIdParseNameString((LPCTSTR) pvDevice, dwDeviceFlags)) == NULL) {

  00042	b3d5		 cbz         r5,|$LN11@PmSetDevic|
  00044	2e00		 cmp         r6,#0
  00046	db01		 blt         |$LN9@PmSetDevic|
  00048	2e04		 cmp         r6,#4
  0004a	dd02		 ble         |$LN10@PmSetDevic|
  0004c		 |$LN9@PmSetDevic|
  0004c	f1b6 3fff	 cmp         r6,#0xFFFFFFFF
  00050	d133		 bne         |$LN11@PmSetDevic|
  00052		 |$LN10@PmSetDevic|
  00052	4641		 mov         r1,r8
  00054	4628		 mov         r0,r5
  00056	f000 f800	 bl          DeviceIdParseNameString
  0005a	4607		 mov         r7,r0
  0005c	b36f		 cbz         r7,|$LN11@PmSetDevic|

; 1206 :     } else {
; 1207 :         PDEVICE_LIST pdl;
; 1208 :         BOOL fOk = TRUE;
; 1209 : 
; 1210 :         // look for the device list and the device
; 1211 :         pdl = GetDeviceListFromClass(pdi->pGuid);

  0005e	6838		 ldr         r0,[r7]
  00060	f000 f800	 bl          GetDeviceListFromClass

; 1212 :         if(pdl != NULL) {

  00064	b350		 cbz         r0,|$LN6@PmSetDevic|

; 1213 :             PDEVICE_STATE pds = DeviceStateFindList(pdl, pdi->pszName);

  00066	6879		 ldr         r1,[r7,#4]
  00068	f000 f800	 bl          DeviceStateFindList
  0006c	4605		 mov         r5,r0

; 1214 :             if(pds != NULL) {

  0006e	b32d		 cbz         r5,|$LN6@PmSetDevic|

; 1215 :                 // are we imposing a set value or are we removing a set value?
; 1216 :                 if(newDx == PwrDeviceUnspecified) {

  00070	f1b6 3fff	 cmp         r6,#0xFFFFFFFF
  00074	d10e		 bne         |$LN5@PmSetDevic|

; 1217 :                     // remove the set value
; 1218 :                     PMLOCK();

  00076	f000 f800	 bl          PmLock

; 1219 :                     pds->setDx = PwrDeviceUnspecified;

  0007a	f06f 0300	 mvn         r3,#0
  0007e	612b		 str         r3,[r5,#0x10]

; 1220 :                     PMUNLOCK();

  00080	f000 f800	 bl          PmUnlock

; 1221 :                     
; 1222 :                     // let the device find its own power level
; 1223 :                     UpdateDeviceState(pds);

  00084	4628		 mov         r0,r5
  00086	f000 f800	 bl          UpdateDeviceState
  0008a		 |$LN3@PmSetDevic|

; 1239 :                         dwStatus = ERROR_SUCCESS;

  0008a	2400		 movs        r4,#0
  0008c		 |$LN2@PmSetDevic|

; 1240 :                     }
; 1241 :                 }
; 1242 :                 
; 1243 :                 // done with the device pointer
; 1244 :                 DeviceStateDecRef(pds);

  0008c	4628		 mov         r0,r5
  0008e	f000 f800	 bl          DeviceStateDecRef
  00092	e013		 b           |$LN6@PmSetDevic|
  00094		 |$LN5@PmSetDevic|

; 1224 :                     
; 1225 :                     // we've removed the set constraint, no matter what UpdateDeviceStatus() did
; 1226 :                     dwStatus = ERROR_SUCCESS;
; 1227 :                 } else {
; 1228 :                     // found the device, now try to update it
; 1229 :                     PMLOCK();

  00094	f000 f800	 bl          PmLock

; 1230 :                     pds->setDx = newDx;

  00098	612e		 str         r6,[r5,#0x10]

; 1231 :                     PMUNLOCK();

  0009a	f000 f800	 bl          PmUnlock

; 1232 :                     fOk = UpdateDeviceState(pds);

  0009e	4628		 mov         r0,r5
  000a0	f000 f800	 bl          UpdateDeviceState

; 1233 :                     if(!fOk) {

  000a4	2800		 cmp         r0,#0
  000a6	d1f0		 bne         |$LN3@PmSetDevic|

; 1234 :                         PMLOCK();

  000a8	f000 f800	 bl          PmLock

; 1235 :                         pds->setDx = PwrDeviceUnspecified;

  000ac	f06f 0300	 mvn         r3,#0
  000b0	612b		 str         r3,[r5,#0x10]

; 1236 :                         PMUNLOCK();

  000b2	f000 f800	 bl          PmUnlock

; 1237 :                         dwStatus = ERROR_WRITE_FAULT;

  000b6	241d		 movs        r4,#0x1D

; 1238 :                     } else {

  000b8	e7e8		 b           |$LN2@PmSetDevic|
  000ba		 |$LN11@PmSetDevic|

; 1205 :         dwStatus = ERROR_INVALID_PARAMETER;

  000ba	2457		 movs        r4,#0x57
  000bc		 |$LN6@PmSetDevic|

; 1245 :             }
; 1246 :         }
; 1247 :     }
; 1248 : 
; 1249 :     PMLEAVEUPDATE();

  000bc	f000 f800	 bl          PmLeaveUpdate

; 1250 : 
; 1251 :     // release resources
; 1252 :     if(pdi != NULL) DeviceIdDestroy(pdi);

  000c0	b117		 cbz         r7,|$LN1@PmSetDevic|
  000c2	4638		 mov         r0,r7
  000c4	f000 f800	 bl          DeviceIdDestroy
  000c8		 |$LN1@PmSetDevic|

; 1253 : 
; 1254 :     PMLOGMSG(ZONE_API || ZONE_DEVICE || (dwStatus != ERROR_SUCCESS && ZONE_WARN), 
; 1255 :         (_T("-%s: returning dwStatus %d\r\n"), pszFname, dwStatus));

  000c8	f8d9 3440	 ldr         r3,[r9,#0x440]
  000cc	f413 6f00	 tst         r3,#0x800
  000d0	d106		 bne         |$LN19@PmSetDevic|
  000d2	f013 0f10	 tst         r3,#0x10
  000d6	d103		 bne         |$LN19@PmSetDevic|
  000d8	b13c		 cbz         r4,|$LN21@PmSetDevic|
  000da	f013 0f02	 tst         r3,#2
  000de	d004		 beq         |$LN21@PmSetDevic|
  000e0		 |$LN19@PmSetDevic|
  000e0	4804		 ldr         r0,|$LN29@PmSetDevic| ; =|??_C@_1DK@LJCCBMHG@?$AA?9?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAw?$AAS?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  000e2	4903		 ldr         r1,|$LN28@PmSetDevic| ; =|??_C@_1CC@LDMFDOHP@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  000e4	4622		 mov         r2,r4
  000e6	f000 f800	 bl          CeLogMsg
  000ea		 |$LN21@PmSetDevic|

; 1256 : 
; 1257 :     // return our status
; 1258 :     return dwStatus;
; 1259 : }

  000ea	4620		 mov         r0,r4
  000ec		 |$M26|
  000ec	e8bd 8bfc	 pop         {r2-r9,r11,pc}
  000f0		 |$LN27@PmSetDevic|
  000f0		 |$LN28@PmSetDevic|
  000f0	0000 0000	 DCD         |??_C@_1CC@LDMFDOHP@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AA?$AA@|
  000f4		 |$LN29@PmSetDevic|
  000f4	0000 0000	 DCD         |??_C@_1DK@LJCCBMHG@?$AA?9?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAw?$AAS?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  000f8		 |$LN30@PmSetDevic|
  000f8	0000 0000	 DCD         |??_C@_1FE@FDHIODBM@?$AA?$CL?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?$CF?$AAs?$AA?0?$AA?5?$AAf?$AAl?$AAa?$AAg?$AAs?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAn?$AAe@|
  000fc		 |$LN31@PmSetDevic|
  000fc	0000 0000	 DCD         |??_C@_1BE@GFCJAFPH@?$AA?$DM?$AAU?$AAN?$AAK?$AAN?$AAO?$AAW?$AAN?$AA?$DO?$AA?$AA@|
  00100		 |$LN32@PmSetDevic|
  00100	0000 0000	 DCD         |dpCurSettings|
  00104		 |$M24|

			 ENDP  ; |PmSetDevicePower|

	EXPORT	|??_C@_1NA@CJGBCGAL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAa?$AAd?$AAd?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAp?$AAd?$AAs?$AAP?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8@| [ DATA ] ; `string'
	EXPORT	|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GK@HCHLCCLO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAe?$AAx?$AAc?$AAe?$AAp?$AAt?$AAi?$AAo?$AAn?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAc?$AAa?$AAp?$AAa?$AAb?$AAi?$AAl?$AAi?$AAt?$AAi?$AAe@| [ DATA ] ; `string'
	EXPORT	|??_C@_1O@DPFEOIGE@?$AA?$DM?$AAN?$AAU?$AAL?$AAL?$AA?$DO?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1EA@MHPCJPB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1HE@OBKKFNKO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAi?$AAn?$AAv?$AAa?$AAl?$AAi?$AAd?$AA?5?$AAs?$AAi?$AAz?$AAe?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAe?$AAd?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AAI@| [ DATA ] ; `string'
	EXPORT	|??_C@_1GM@EDCDNHME@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAW?$AAA?$AAR?$AAN?$AAI?$AAN?$AAG?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAd?$AAo?$AAe?$AAs?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAs?$AAu?$AAp?$AAp?$AAo@| [ DATA ] ; `string'
	EXPORT	|??_C@_1FE@BCEMHNLC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAs?$AAu@| [ DATA ] ; `string'
	EXPORT	|AddDevice|
	IMPORT	|memcpy|
	IMPORT	|DeviceStateCreate|
	IMPORT	|DeviceStateAddList|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$AddDevice| DCD imagerel |$LN65@AddDevice|
	DCD	imagerel |$unwind2$AddDevice|

  00000			 AREA	 |.xdata|, DATA
|$unwind2$AddDevice| DCD 0x3330012d
	DCD	0xdffc09c7
	DCD	0xefdbff04
	DCD	0xff05
	DCD	imagerel |__C_specific_handler|
	DCD	0x1
	DCD	imagerel |$LN48@AddDevice|
	DCD	imagerel |$LN49@AddDevice|
	DCD	0x1
	DCD	imagerel |$LN45@AddDevice|

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FE@BCEMHNLC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAs?$AAu@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "c", 0x0, "l", 0x0, "a"
	DCB	0x0, "s", 0x0, "s", 0x0, " ", 0x0, "f", 0x0, "o", 0x0, "r"
	DCB	0x0, " ", 0x0, "d", 0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c"
	DCB	0x0, "e", 0x0, " ", 0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'"
	DCB	0x0, " ", 0x0, "n", 0x0, "o", 0x0, "t", 0x0, " ", 0x0, "s"
	DCB	0x0, "u", 0x0, "p", 0x0, "p", 0x0, "o", 0x0, "r", 0x0, "t"
	DCB	0x0, "e", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GM@EDCDNHME@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAW?$AAA?$AAR?$AAN?$AAI?$AAN?$AAG?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAd?$AAo?$AAe?$AAs?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAs?$AAu?$AAp?$AAp?$AAo@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "W", 0x0, "A", 0x0, "R"
	DCB	0x0, "N", 0x0, "I", 0x0, "N", 0x0, "G", 0x0, ":", 0x0, " "
	DCB	0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'", 0x0, " ", 0x0, "d"
	DCB	0x0, "o", 0x0, "e", 0x0, "s", 0x0, " ", 0x0, "n", 0x0, "o"
	DCB	0x0, "t", 0x0, " ", 0x0, "s", 0x0, "u", 0x0, "p", 0x0, "p"
	DCB	0x0, "o", 0x0, "r", 0x0, "t", 0x0, " ", 0x0, "m", 0x0, "u"
	DCB	0x0, "l", 0x0, "t", 0x0, "i", 0x0, "p", 0x0, "l", 0x0, "e"
	DCB	0x0, " ", 0x0, "h", 0x0, "a", 0x0, "n", 0x0, "d", 0x0, "l"
	DCB	0x0, "e", 0x0, "s", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1HE@OBKKFNKO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAi?$AAn?$AAv?$AAa?$AAl?$AAi?$AAd?$AA?5?$AAs?$AAi?$AAz?$AAe?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAe?$AAd?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AAI@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "i", 0x0, "n", 0x0, "v"
	DCB	0x0, "a", 0x0, "l", 0x0, "i", 0x0, "d", 0x0, " ", 0x0, "s"
	DCB	0x0, "i", 0x0, "z", 0x0, "e", 0x0, " ", 0x0, "r", 0x0, "e"
	DCB	0x0, "t", 0x0, "u", 0x0, "r", 0x0, "n", 0x0, "e", 0x0, "d"
	DCB	0x0, " ", 0x0, "f", 0x0, "r", 0x0, "o", 0x0, "m", 0x0, " "
	DCB	0x0, "I", 0x0, "O", 0x0, "C", 0x0, "T", 0x0, "L", 0x0, "_"
	DCB	0x0, "P", 0x0, "O", 0x0, "W", 0x0, "E", 0x0, "R", 0x0, "_"
	DCB	0x0, "C", 0x0, "A", 0x0, "P", 0x0, "A", 0x0, "B", 0x0, "I"
	DCB	0x0, "L", 0x0, "I", 0x0, "T", 0x0, "I", 0x0, "E", 0x0, "S"
	DCB	0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0	; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EA@MHPCJPB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "c", 0x0, "o", 0x0, "u"
	DCB	0x0, "l", 0x0, "d", 0x0, "n", 0x0, "'", 0x0, "t", 0x0, " "
	DCB	0x0, "o", 0x0, "p", 0x0, "e", 0x0, "n", 0x0, " ", 0x0, "d"
	DCB	0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, " "
	DCB	0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'", 0x0, 0xd, 0x0, 0xa
	DCB	0x0, 0x0, 0x0				; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1O@DPFEOIGE@?$AA?$DM?$AAN?$AAU?$AAL?$AAL?$AA?$DO?$AA?$AA@| DCB "<", 0x0
	DCB	"N", 0x0, "U", 0x0, "L", 0x0, "L", 0x0, ">", 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GK@HCHLCCLO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAe?$AAx?$AAc?$AAe?$AAp?$AAt?$AAi?$AAo?$AAn?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAc?$AAa?$AAp?$AAa?$AAb?$AAi?$AAl?$AAi?$AAt?$AAi?$AAe@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "e", 0x0, "x", 0x0, "c"
	DCB	0x0, "e", 0x0, "p", 0x0, "t", 0x0, "i", 0x0, "o", 0x0, "n"
	DCB	0x0, " ", 0x0, "d", 0x0, "u", 0x0, "r", 0x0, "i", 0x0, "n"
	DCB	0x0, "g", 0x0, " ", 0x0, "c", 0x0, "a", 0x0, "p", 0x0, "a"
	DCB	0x0, "b", 0x0, "i", 0x0, "l", 0x0, "i", 0x0, "t", 0x0, "i"
	DCB	0x0, "e", 0x0, "s", 0x0, " ", 0x0, "c", 0x0, "o", 0x0, "p"
	DCB	0x0, "y", 0x0, " ", 0x0, "f", 0x0, "r", 0x0, "o", 0x0, "m"
	DCB	0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "8"
	DCB	0x0, "x", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@| DCB "A"
	DCB	0x0, "d", 0x0, "d", 0x0, "D", 0x0, "e", 0x0, "v", 0x0, "i"
	DCB	0x0, "c", 0x0, "e", 0x0, 0x0, 0x0	; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1NA@CJGBCGAL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAa?$AAd?$AAd?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAp?$AAd?$AAs?$AAP?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "a", 0x0, "d", 0x0, "d"
	DCB	0x0, "i", 0x0, "n", 0x0, "g", 0x0, " ", 0x0, "'", 0x0, "%"
	DCB	0x0, "s", 0x0, "'", 0x0, ",", 0x0, " ", 0x0, "p", 0x0, "d"
	DCB	0x0, "s", 0x0, "P", 0x0, "a", 0x0, "r", 0x0, "e", 0x0, "n"
	DCB	0x0, "t", 0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0"
	DCB	0x0, "8", 0x0, "x", 0x0, ",", 0x0, " ", 0x0, "p", 0x0, "C"
	DCB	0x0, "a", 0x0, "p", 0x0, "s", 0x0, " ", 0x0, "0", 0x0, "x"
	DCB	0x0, "%", 0x0, "0", 0x0, "8", 0x0, "x", 0x0, " ", 0x0, "t"
	DCB	0x0, "o", 0x0, " ", 0x0, "c", 0x0, "l", 0x0, "a", 0x0, "s"
	DCB	0x0, "s", 0x0, " ", 0x0, "%", 0x0, "0", 0x0, "8", 0x0, "x"
	DCB	0x0, "-", 0x0, "%", 0x0, "0", 0x0, "4", 0x0, "x", 0x0, "-"
	DCB	0x0, "%", 0x0, "0", 0x0, "4", 0x0, "x", 0x0, "-", 0x0, "%"
	DCB	0x0, "0", 0x0, "4", 0x0, "x", 0x0, "-", 0x0, "%", 0x0, "0"
	DCB	0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x"
	DCB	0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0"
	DCB	0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x"
	DCB	0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x", 0x0, 0xd, 0x0, 0xa
	DCB	0x0, 0x0, 0x0				; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |AddDevice| PROC

; 913  : {

  00000		 |$LN65@AddDevice|
  00000	b40f		 push        {r0-r3}
  00002	e92d 4ff0	 push        {r4-r11,lr}
  00006	f20d 0b1c	 addw        r11,sp,#0x1C
  0000a	b089		 sub         sp,sp,#0x24
  0000c	466f		 mov         r7,sp
  0000e	b08c		 sub         sp,sp,#0x30
  00010		 |$LN63@AddDevice|
  00010	469a		 mov         r10,r3
  00012	657b		 str         r3,[r7,#0x54]
  00014	4615		 mov         r5,r2
  00016	603d		 str         r5,[r7]
  00018	653d		 str         r5,[r7,#0x50]
  0001a	4689		 mov         r9,r1
  0001c	64f9		 str         r1,[r7,#0x4C]
  0001e	4680		 mov         r8,r0

; 914  :     SETFNAME(_T("AddDevice"));
; 915  : 
; 916  :     PMLOGMSG(ZONE_DEVICE, 
; 917  :         (_T("%s: adding '%s', pdsParent 0x%08x, pCaps 0x%08x to class %08x-%04x-%04x-%04x-%02x%02x%02x%02x%02x%02x\r\n"), 
; 918  :         pszFname, pszName, pdsParent, pCaps,
; 919  :         guidDevClass->Data1, guidDevClass->Data2, guidDevClass->Data3,
; 920  :         (guidDevClass->Data4[0] << 8) + guidDevClass->Data4[1], guidDevClass->Data4[2], guidDevClass->Data4[3], 
; 921  :         guidDevClass->Data4[4], guidDevClass->Data4[5], guidDevClass->Data4[6], guidDevClass->Data4[7]));

  00020	4e98		 ldr         r6,|$LN79@AddDevice| ; =|dpCurSettings|
  00022	f8d6 4440	 ldr         r4,[r6,#0x440]
  00026	f014 0f10	 tst         r4,#0x10
  0002a	d029		 beq         |$LN53@AddDevice|
  0002c	f890 400f	 ldrb.w      r4,[r0,#0xF]
  00030	940a		 str         r4,[sp,#0x28]
  00032	f890 400e	 ldrb.w      r4,[r0,#0xE]
  00036	9409		 str         r4,[sp,#0x24]
  00038	f890 400d	 ldrb.w      r4,[r0,#0xD]
  0003c	9408		 str         r4,[sp,#0x20]
  0003e	f890 400c	 ldrb.w      r4,[r0,#0xC]
  00042	9407		 str         r4,[sp,#0x1C]
  00044	f890 400b	 ldrb.w      r4,[r0,#0xB]
  00048	9406		 str         r4,[sp,#0x18]
  0004a	f890 300a	 ldrb.w      r3,[r0,#0xA]
  0004e	9305		 str         r3,[sp,#0x14]
  00050	f890 2008	 ldrb.w      r2,[r0,#8]
  00054	f890 3009	 ldrb.w      r3,[r0,#9]
  00058	eb03 2302	 add         r3,r3,r2,lsl #8
  0005c	9304		 str         r3,[sp,#0x10]
  0005e	f8b0 3006	 ldrh.w      r3,[r0,#6]
  00062	9303		 str         r3,[sp,#0xC]
  00064	f8b0 3004	 ldrh.w      r3,[r0,#4]
  00068	9302		 str         r3,[sp,#8]
  0006a	f8d0 3000	 ldr.w       r3,[r0]
  0006e	9301		 str         r3,[sp,#4]
  00070	f8cd a000	 str         r10,[sp]
  00074	4884		 ldr         r0,|$LN80@AddDevice| ; =|??_C@_1NA@CJGBCGAL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAa?$AAd?$AAd?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAp?$AAd?$AAs?$AAP?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8@|
  00076	462b		 mov         r3,r5
  00078	460a		 mov         r2,r1
  0007a	4978		 ldr         r1,|$LN69@AddDevice| ; =|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  0007c	f000 f800	 bl          CeLogMsg
  00080		 |$LN53@AddDevice|

; 922  : 
; 923  :     // figure out onto which list this device should be added
; 924  :     PDEVICE_LIST pdl = GetDeviceListFromClass(guidDevClass);

  00080	4640		 mov         r0,r8
  00082	f000 f800	 bl          GetDeviceListFromClass
  00086	4604		 mov         r4,r0
  00088	607c		 str         r4,[r7,#4]

; 925  :     
; 926  :     // did we find the list?
; 927  :     if(pdl != NULL) {

  0008a	2c00		 cmp         r4,#0
  0008c	f000 80d6	 beq         |$LN22@AddDevice|

; 928  :         // check for duplicates
; 929  :         PDEVICE_STATE pds = DeviceStateFindList(pdl, pszName);

  00090	4649		 mov         r1,r9
  00092	f000 f800	 bl          DeviceStateFindList
  00096	4605		 mov         r5,r0

; 930  :         
; 931  :         // create the device if it doesn't already exist
; 932  :         if(pds == NULL) {

  00098	2d00		 cmp         r5,#0
  0009a	f040 80cb	 bne         |$LN56@AddDevice|

; 933  :             BOOL fOk = FALSE;

  0009e	f04f 0800	 mov         r8,#0
  000a2	f8c7 800c	 str         r8,[r7,#0xC]

; 934  :             pds = DeviceStateCreate(pszName);

  000a6	4648		 mov         r0,r9
  000a8	f000 f800	 bl          DeviceStateCreate
  000ac	4605		 mov         r5,r0
  000ae	60bd		 str         r5,[r7,#8]

; 935  :             if(pds != NULL) {

  000b0	2d00		 cmp         r5,#0
  000b2	f000 80cd	 beq         |$LN41@AddDevice|

; 936  :                 // if we are passed the device's capabilities, just copy them
; 937  :                 // into the structure
; 938  :                 if(pCaps != NULL) {

  000b6	f1ba 0f00	 cmp         r10,#0
  000ba	d01b		 beq         |$LN50@AddDevice|
  000bc		 |$LN48@AddDevice|

; 939  :                     __try {
; 940  :                         pds->caps = *pCaps;

  000bc	f115 0028	 adds        r0,r5,#0x28
  000c0	2230		 movs        r2,#0x30
  000c2	4651		 mov         r1,r10
  000c4	f000 f800	 bl          memcpy
  000c8		 |$LN49@AddDevice|

; 941  :                     }

  000c8	e014		 b           |$LN50@AddDevice|
  000ca		 |$LN45@AddDevice|

; 942  :                     __except(EXCEPTION_EXECUTE_HANDLER) {
; 943  :                         PMLOGMSG(ZONE_WARN, 
; 944  :                             (_T("%s: exception during capabilities copy from 0x%08x\r\n"),
; 945  :                             pszFname, pCaps));

  000ca	4e6e		 ldr         r6,|$LN79@AddDevice| ; =|dpCurSettings|
  000cc	f8d6 3440	 ldr         r3,[r6,#0x440]
  000d0	f013 0f02	 tst         r3,#2
  000d4	d004		 beq         |$LN54@AddDevice|
  000d6	486a		 ldr         r0,|$LN78@AddDevice| ; =|??_C@_1GK@HCHLCCLO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAe?$AAx?$AAc?$AAe?$AAp?$AAt?$AAi?$AAo?$AAn?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAc?$AAa?$AAp?$AAa?$AAb?$AAi?$AAl?$AAi?$AAt?$AAi?$AAe@|
  000d8	6d7a		 ldr         r2,[r7,#0x54]
  000da	4960		 ldr         r1,|$LN69@AddDevice| ; =|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  000dc	f000 f800	 bl          CeLogMsg
  000e0		 |$LN54@AddDevice|

; 946  :                         pCaps = NULL;

  000e0	f04f 0a00	 mov         r10,#0
  000e4	6d3b		 ldr         r3,[r7,#0x50]
  000e6	603b		 str         r3,[r7]
  000e8	f8d7 904c	 ldr         r9,[r7,#0x4C]
  000ec	687c		 ldr         r4,[r7,#4]
  000ee	68bd		 ldr         r5,[r7,#8]
  000f0	f8d7 800c	 ldr         r8,[r7,#0xC]
  000f4		 |$LN50@AddDevice|

; 947  :                     }
; 948  :                 }
; 949  :                 
; 950  :                 // update the device's parent pointer
; 951  :                 if(pdsParent != NULL) {

  000f4	683b		 ldr         r3,[r7]
  000f6	b11b		 cbz         r3,|$LN17@AddDevice|

; 952  :                     DeviceStateAddRef(pdsParent);

  000f8	4618		 mov         r0,r3
  000fa	f000 f800	 bl          DeviceStateAddRef
  000fe	683b		 ldr         r3,[r7]
  00100		 |$LN17@AddDevice|

; 953  :                 }
; 954  :                 pds->pParent = pdsParent;

  00100	626b		 str         r3,[r5,#0x24]

; 955  :                 
; 956  :                 // add the new device to its class list
; 957  :                 if(!DeviceStateAddList(pdl, pds)) {

  00102	4629		 mov         r1,r5
  00104	4620		 mov         r0,r4
  00106	f000 f800	 bl          DeviceStateAddList
  0010a	2800		 cmp         r0,#0

; 958  :                     // deallocate the node, reference count isn't incremented
; 959  :                     DeviceStateDecRef(pds);

  0010c	4628		 mov         r0,r5

; 955  :                 
; 956  :                 // add the new device to its class list
; 957  :                 if(!DeviceStateAddList(pdl, pds)) {

  0010e	f000 8092	 beq         |$LN60@AddDevice|

; 960  :                     pds = NULL;
; 961  :                 } else {
; 962  :                     PREFAST_DEBUGCHK(pds->pInterface != NULL);
; 963  :                     PREFAST_DEBUGCHK(pds->pInterface->pfnOpenDevice != NULL);
; 964  :                     PREFAST_DEBUGCHK(pds->pInterface->pfnRequestDevice != NULL);
; 965  :                     PREFAST_DEBUGCHK(pds->pInterface->pfnCloseDevice != NULL);
; 966  :                     pds->hDevice = pds->pInterface->pfnOpenDevice(pds);

  00112	6e2b		 ldr         r3,[r5,#0x60]
  00114	685b		 ldr         r3,[r3,#4]
  00116	4798		 blx         r3
  00118	65e8		 str         r0,[r5,#0x5C]

; 967  :                     if(pds->hDevice == INVALID_HANDLE_VALUE) {

  0011a	f1b0 3fff	 cmp         r0,#0xFFFFFFFF
  0011e	d10f		 bne         |$LN14@AddDevice|

; 968  :                         PMLOGMSG(ZONE_WARN, (_T("%s: couldn't open device '%s'\r\n"),
; 969  :                             pszFname, pszName != NULL ? _T("<NULL>") : pszName));

  00120	f8d6 3440	 ldr         r3,[r6,#0x440]
  00124	f013 0f02	 tst         r3,#2
  00128	d05d		 beq         |$LN8@AddDevice|
  0012a	f1b9 0f00	 cmp         r9,#0
  0012e	d001		 beq         |$LN29@AddDevice|
  00130	4a52		 ldr         r2,|$LN77@AddDevice| ; =|??_C@_1O@DPFEOIGE@?$AA?$DM?$AAN?$AAU?$AAL?$AAL?$AA?$DO?$AA?$AA@|
  00132	e000		 b           |$LN30@AddDevice|
  00134		 |$LN29@AddDevice|
  00134	2200		 movs        r2,#0
  00136		 |$LN30@AddDevice|
  00136	4850		 ldr         r0,|$LN76@AddDevice| ; =|??_C@_1EA@MHPCJPB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  00138	4948		 ldr         r1,|$LN69@AddDevice| ; =|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  0013a	f000 f800	 bl          CeLogMsg

; 970  :                     } else {

  0013e	e052		 b           |$LN8@AddDevice|
  00140		 |$LN14@AddDevice|

; 971  :                         // do we need to request capabilities?
; 972  :                         fOk = TRUE;             // assume success

  00140	f04f 0801	 mov         r8,#1

; 973  :                         if(pCaps == NULL) {

  00144	f1ba 0f00	 cmp         r10,#0
  00148	d13c		 bne         |$LN10@AddDevice|

; 974  :                             DWORD dwBytesReturned;
; 975  :                             POWER_RELATIONSHIP pr;
; 976  :                             PPOWER_RELATIONSHIP ppr = NULL;

  0014a	2200		 movs        r2,#0

; 977  :                             memset(&pr, 0, sizeof(pr));

  0014c	2300		 movs        r3,#0
  0014e	613b		 str         r3,[r7,#0x10]
  00150	617b		 str         r3,[r7,#0x14]
  00152	61bb		 str         r3,[r7,#0x18]
  00154	61fb		 str         r3,[r7,#0x1C]

; 978  :                             if(pds->pParent != NULL) {

  00156	6a69		 ldr         r1,[r5,#0x24]
  00158	b199		 cbz         r1,|$LN11@AddDevice|

; 979  :                                 PMLOGMSG(ZONE_DEVICE, (_T("%s: parent of '%s' is '%s'\r\n"), 
; 980  :                                     pszFname, pds->pszName, pds->pParent->pszName));

  0015a	f8d6 3440	 ldr         r3,[r6,#0x440]
  0015e	f013 0f10	 tst         r3,#0x10
  00162	d005		 beq         |$LN33@AddDevice|
  00164	680b		 ldr         r3,[r1]
  00166	682a		 ldr         r2,[r5]
  00168	4842		 ldr         r0,|$LN75@AddDevice| ; =|??_C@_1DK@KOLEMAMB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAp?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AAo?$AAf?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  0016a	493c		 ldr         r1,|$LN69@AddDevice| ; =|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  0016c	f000 f800	 bl          CeLogMsg
  00170		 |$LN33@AddDevice|

; 981  :                                 pr.hParent = (HANDLE) pds->pParent;

  00170	6a6b		 ldr         r3,[r5,#0x24]
  00172	613b		 str         r3,[r7,#0x10]

; 982  :                                 pr.pwsParent = pds->pParent->pszName;

  00174	681b		 ldr         r3,[r3]
  00176	617b		 str         r3,[r7,#0x14]

; 983  :                                 pr.hChild = (HANDLE) pds;

  00178	61bd		 str         r5,[r7,#0x18]

; 984  :                                 pr.pwsChild = pds->pszName;

  0017a	682b		 ldr         r3,[r5]
  0017c	61fb		 str         r3,[r7,#0x1C]

; 985  :                                 ppr = &pr;

  0017e	f117 0210	 adds        r2,r7,#0x10
  00182		 |$LN11@AddDevice|

; 986  :                             }                        
; 987  :                             
; 988  :                             // get the device's capabilities structure
; 989  :                             fOk = pds->pInterface->pfnRequestDevice(pds->hDevice, IOCTL_POWER_CAPABILITIES, 
; 990  :                                 ppr, ppr == NULL ? 0 : sizeof(*ppr), 
; 991  :                                 &pds->caps, sizeof(pds->caps), &dwBytesReturned);

  00182	b90a		 cbnz        r2,|$LN35@AddDevice|
  00184	2300		 movs        r3,#0
  00186	e000		 b           |$LN36@AddDevice|
  00188		 |$LN35@AddDevice|
  00188	2310		 movs        r3,#0x10
  0018a		 |$LN36@AddDevice|
  0018a	f117 010c	 adds        r1,r7,#0xC
  0018e	9102		 str         r1,[sp,#8]
  00190	2130		 movs        r1,#0x30
  00192	9101		 str         r1,[sp,#4]
  00194	f115 0128	 adds        r1,r5,#0x28
  00198	9100		 str         r1,[sp]
  0019a	4935		 ldr         r1,|$LN74@AddDevice| ; =0x321000
  0019c	6de8		 ldr         r0,[r5,#0x5C]
  0019e	6e2c		 ldr         r4,[r5,#0x60]
  001a0	68e4		 ldr         r4,[r4,#0xC]
  001a2	47a0		 blx         r4
  001a4	4680		 mov         r8,r0

; 992  :                             
; 993  :                             // sanity check the size in case a device is just returning
; 994  :                             // a good status on all ioctls for some reason
; 995  :                             if(fOk && dwBytesReturned != sizeof(pds->caps)) {

  001a6	b308		 cbz         r0,|$LN59@AddDevice|
  001a8	68fb		 ldr         r3,[r7,#0xC]
  001aa	2b30		 cmp         r3,#0x30
  001ac	d00a		 beq         |$LN10@AddDevice|

; 996  :                                 PMLOGMSG(ZONE_WARN, 
; 997  :                                     (_T("%s: invalid size returned from IOCTL_POWER_CAPABILITIES\r\n"),
; 998  :                                     pszFname));

  001ae	f8d6 3440	 ldr         r3,[r6,#0x440]
  001b2	f013 0f02	 tst         r3,#2
  001b6	d003		 beq         |$LN37@AddDevice|
  001b8	482c		 ldr         r0,|$LN73@AddDevice| ; =|??_C@_1HE@OBKKFNKO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAi?$AAn?$AAv?$AAa?$AAl?$AAi?$AAd?$AA?5?$AAs?$AAi?$AAz?$AAe?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAe?$AAd?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AAI@|
  001ba	4928		 ldr         r1,|$LN69@AddDevice| ; =|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  001bc	f000 f800	 bl          CeLogMsg
  001c0		 |$LN37@AddDevice|

; 999  :                                 fOk = FALSE;

  001c0	f04f 0800	 mov         r8,#0
  001c4		 |$LN10@AddDevice|

; 1000 :                             }
; 1001 :                         }
; 1002 : 
; 1003 :                         // any problems so far?
; 1004 :                         if(fOk) {

  001c4	f1b8 0f00	 cmp         r8,#0
  001c8	d010		 beq         |$LN59@AddDevice|

; 1005 :                             // determine whether we should request power relationships from a parent device
; 1006 :                             if((pds->caps.Flags & POWER_CAP_PARENT) != 0) {

  001ca	6d6b		 ldr         r3,[r5,#0x54]
  001cc	f013 0f01	 tst         r3,#1
  001d0	d009		 beq         |$LN8@AddDevice|

; 1007 :                                 pds->pInterface->pfnRequestDevice(pds->hDevice, IOCTL_REGISTER_POWER_RELATIONSHIP,
; 1008 :                                     NULL, 0, NULL, 0, NULL);

  001d2	2300		 movs        r3,#0
  001d4	9302		 str         r3,[sp,#8]
  001d6	9301		 str         r3,[sp,#4]
  001d8	9300		 str         r3,[sp]
  001da	2200		 movs        r2,#0
  001dc	4922		 ldr         r1,|$LN72@AddDevice| ; =0x321018
  001de	6de8		 ldr         r0,[r5,#0x5C]
  001e0	6e2c		 ldr         r4,[r5,#0x60]
  001e2	68e4		 ldr         r4,[r4,#0xC]
  001e4	47a0		 blx         r4
  001e6		 |$LN8@AddDevice|

; 1009 :                             }
; 1010 :                         }
; 1011 :                     }
; 1012 :                 }
; 1013 :                 
; 1014 :                 // have we read all the configuration information we need from 
; 1015 :                 // the new device
; 1016 :                 if (pds != NULL ) {
; 1017 :                     if(!fOk) {

  001e6	f1b8 0f00	 cmp         r8,#0
  001ea	d103		 bne         |$LN6@AddDevice|
  001ec		 |$LN59@AddDevice|

; 1018 :                         // no, delete the device
; 1019 :                         DeviceStateRemList(pds);

  001ec	4628		 mov         r0,r5
  001ee	f000 f800	 bl          DeviceStateRemList

; 1020 :                     } else {

  001f2	e01e		 b           |$LN5@AddDevice|
  001f4		 |$LN6@AddDevice|

; 1021 :                         // See if the device supports multiple handles.  Power manageable devices
; 1022 :                         // should allow multiple open handles, but if they don't we will have to open
; 1023 :                         // one before each access.
; 1024 :                         HANDLE hDevice = pds->pInterface->pfnOpenDevice(pds);

  001f4	4628		 mov         r0,r5
  001f6	6e2b		 ldr         r3,[r5,#0x60]
  001f8	685b		 ldr         r3,[r3,#4]
  001fa	4798		 blx         r3

; 1025 :                         if(hDevice == INVALID_HANDLE_VALUE) {

  001fc	f1b0 3fff	 cmp         r0,#0xFFFFFFFF
  00200	d111		 bne         |$LN4@AddDevice|

; 1026 :                             PMLOGMSG(ZONE_WARN, (_T("%s: WARNING: '%s' does not support multiple handles\r\n"),
; 1027 :                                 pszFname, pds->pszName));

  00202	f8d6 3440	 ldr         r3,[r6,#0x440]
  00206	f013 0f02	 tst         r3,#2
  0020a	d004		 beq         |$LN39@AddDevice|
  0020c	682a		 ldr         r2,[r5]
  0020e	4815		 ldr         r0,|$LN71@AddDevice| ; =|??_C@_1GM@EDCDNHME@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAW?$AAA?$AAR?$AAN?$AAI?$AAN?$AAG?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAd?$AAo?$AAe?$AAs?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAs?$AAu?$AAp?$AAp?$AAo@|
  00210	4912		 ldr         r1,|$LN69@AddDevice| ; =|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  00212	f000 f800	 bl          CeLogMsg
  00216		 |$LN39@AddDevice|

; 1028 :                             pds->pInterface->pfnCloseDevice(pds->hDevice);

  00216	6de8		 ldr         r0,[r5,#0x5C]
  00218	6e2b		 ldr         r3,[r5,#0x60]
  0021a	689b		 ldr         r3,[r3,#8]
  0021c	4798		 blx         r3

; 1029 :                             pds->hDevice = INVALID_HANDLE_VALUE;

  0021e	f06f 0300	 mvn         r3,#0
  00222	65eb		 str         r3,[r5,#0x5C]

; 1030 :                         } else {

  00224	e002		 b           |$LN3@AddDevice|
  00226		 |$LN4@AddDevice|

; 1031 :                             // close the second handle, since we don't need it
; 1032 :                             pds->pInterface->pfnCloseDevice(hDevice);

  00226	6e2b		 ldr         r3,[r5,#0x60]
  00228	689b		 ldr         r3,[r3,#8]
  0022a	4798		 blx         r3
  0022c		 |$LN3@AddDevice|

; 1033 :                         }
; 1034 :                         
; 1035 :                         // initialize the new device's power state variables
; 1036 :                         UpdateDeviceState(pds);

  0022c	4628		 mov         r0,r5
  0022e	f000 f800	 bl          UpdateDeviceState
  00232		 |$LN5@AddDevice|

; 1037 :                     }
; 1038 :                 }
; 1039 :             }
; 1040 :         }
; 1041 :         
; 1042 :         // we are done with the device pointer
; 1043 :         if(pds != NULL) {

  00232	b16d		 cbz         r5,|$LN41@AddDevice|
  00234		 |$LN56@AddDevice|

; 1044 :             DeviceStateDecRef(pds);

  00234	4628		 mov         r0,r5
  00236		 |$LN60@AddDevice|
  00236	f000 f800	 bl          DeviceStateDecRef

; 1045 :         }
; 1046 :     } else {

  0023a	e009		 b           |$LN41@AddDevice|
  0023c		 |$LN22@AddDevice|

; 1047 :         PMLOGMSG(ZONE_WARN, (_T("%s: class for device '%s' not supported\r\n"),
; 1048 :             pszFname, pszName));

  0023c	f8d6 3440	 ldr         r3,[r6,#0x440]
  00240	f013 0f02	 tst         r3,#2
  00244	d004		 beq         |$LN41@AddDevice|
  00246	4806		 ldr         r0,|$LN70@AddDevice| ; =|??_C@_1FE@BCEMHNLC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAs?$AAu@|
  00248	464a		 mov         r2,r9
  0024a	4904		 ldr         r1,|$LN69@AddDevice| ; =|??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  0024c	f000 f800	 bl          CeLogMsg
  00250		 |$LN41@AddDevice|
  00250		 |$M67|

; 1049 :     }
; 1050 : }

  00250	b015		 add         sp,sp,#0x54
  00252	e8bd 0ff0	 pop         {r4-r11}
  00256	f85d fb14	 ldr         pc,[sp],#0x14
  0025a		 |$LN81@AddDevice|
  0025a		 |$M82|
  0025a	defe		 __debugbreak
  0025c		 |$LN68@AddDevice|
  0025c		 |$LN69@AddDevice|
  0025c	0000 0000	 DCD         |??_C@_1BE@PPCJHGAM@?$AAA?$AAd?$AAd?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?$AA@|
  00260		 |$LN70@AddDevice|
  00260	0000 0000	 DCD         |??_C@_1FE@BCEMHNLC@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AAf?$AAo?$AAr?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAs?$AAu@|
  00264		 |$LN71@AddDevice|
  00264	0000 0000	 DCD         |??_C@_1GM@EDCDNHME@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAW?$AAA?$AAR?$AAN?$AAI?$AAN?$AAG?$AA?3?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAd?$AAo?$AAe?$AAs?$AA?5?$AAn?$AAo?$AAt?$AA?5?$AAs?$AAu?$AAp?$AAp?$AAo@|
  00268		 |$LN72@AddDevice|
  00268	1018 0032	 DCD         0x321018
  0026c		 |$LN73@AddDevice|
  0026c	0000 0000	 DCD         |??_C@_1HE@OBKKFNKO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAi?$AAn?$AAv?$AAa?$AAl?$AAi?$AAd?$AA?5?$AAs?$AAi?$AAz?$AAe?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAe?$AAd?$AA?5?$AAf?$AAr?$AAo?$AAm?$AA?5?$AAI@|
  00270		 |$LN74@AddDevice|
  00270	1000 0032	 DCD         0x321000
  00274		 |$LN75@AddDevice|
  00274	0000 0000	 DCD         |??_C@_1DK@KOLEMAMB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAp?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AAo?$AAf?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAi?$AAs?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  00278		 |$LN76@AddDevice|
  00278	0000 0000	 DCD         |??_C@_1EA@MHPCJPB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAo?$AAu?$AAl?$AAd?$AAn?$AA?8?$AAt?$AA?5?$AAo?$AAp?$AAe?$AAn?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$AN?$AA?6?$AA?$AA@|
  0027c		 |$LN77@AddDevice|
  0027c	0000 0000	 DCD         |??_C@_1O@DPFEOIGE@?$AA?$DM?$AAN?$AAU?$AAL?$AAL?$AA?$DO?$AA?$AA@|
  00280		 |$LN78@AddDevice|
  00280	0000 0000	 DCD         |??_C@_1GK@HCHLCCLO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAe?$AAx?$AAc?$AAe?$AAp?$AAt?$AAi?$AAo?$AAn?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAc?$AAa?$AAp?$AAa?$AAb?$AAi?$AAl?$AAi?$AAt?$AAi?$AAe@|
  00284		 |$LN79@AddDevice|
  00284	0000 0000	 DCD         |dpCurSettings|
  00288		 |$LN80@AddDevice|
  00288	0000 0000	 DCD         |??_C@_1NA@CJGBCGAL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAa?$AAd?$AAd?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?0?$AA?5?$AAp?$AAd?$AAs?$AAP?$AAa?$AAr?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8@|

			 ENDP  ; |AddDevice|

  0028c		 |$LN64@AddDevice|
	EXPORT	|??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DA@MGDEIOCP@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAC?$AAl?$AAa?$AAs?$AAs?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AAs?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|UpdateClassDeviceStates|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$UpdateClassDeviceStates| DCD imagerel |$LN25@UpdateClas|
	DCD	0xfd3460d1

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DA@MGDEIOCP@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAC?$AAl?$AAa?$AAs?$AAs?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AAs?$AA?$AA@| DCB "U"
	DCB	0x0, "p", 0x0, "d", 0x0, "a", 0x0, "t", 0x0, "e", 0x0, "C"
	DCB	0x0, "l", 0x0, "a", 0x0, "s", 0x0, "s", 0x0, "D", 0x0, "e"
	DCB	0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, "S", 0x0, "t"
	DCB	0x0, "a", 0x0, "t", 0x0, "e", 0x0, "s", 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "d", 0x0, "e", 0x0, "v"
	DCB	0x0, "i", 0x0, "c", 0x0, "e", 0x0, " ", 0x0, "'", 0x0, "%"
	DCB	0x0, "s", 0x0, "'", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "m"
	DCB	0x0, "o", 0x0, "v", 0x0, "e", 0x0, "d", 0x0, " ", 0x0, "d"
	DCB	0x0, "u", 0x0, "r", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " "
	DCB	0x0, "u", 0x0, "p", 0x0, "d", 0x0, "a", 0x0, "t", 0x0, "e"
	DCB	0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0	; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |UpdateClassDeviceStates| PROC

; 807  : {

  00000		 |$LN25@UpdateClas|
  00000	e92d 49f8	 push        {r3-r8,r11,lr}
  00004	f20d 0b18	 addw        r11,sp,#0x18
  00008		 |$M23|
  00008	4607		 mov         r7,r0

; 808  :     BOOL fDeviceRemoved;
; 809  :     PDEVICE_STATE pds;
; 810  :     SETFNAME(_T("UpdateClassDeviceStates"));
; 811  : 
; 812  :     PREFAST_DEBUGCHK(pdl != NULL);
; 813  : 
; 814  :     PMLOCK();

  0000a	f000 f800	 bl          PmLock
  0000e	f8df 8060	 ldr         r8,|$LN30@UpdateClas| ; =|dpCurSettings|
  00012		 |$LL8@UpdateClas|

; 815  : 
; 816  :     // Since it's possible that the device list may be modified
; 817  :     // while we are not holding the PM critical section we need
; 818  :     // to watch out for the device we are working on getting removed.
; 819  :     // We increment the reference count to keep the device data 
; 820  :     // structure from being deallocated out from under us.  Once
; 821  :     // the device update is complete and we have the critical section
; 822  :     // again, we check to see if it's still part of the device list.
; 823  :     // If it's not, we start again at the top of the list.  This should
; 824  :     // be harmless since devices that are at the right power state
; 825  :     // already won't be updated.
; 826  :     do {
; 827  :         fDeviceRemoved = FALSE;
; 828  :         pds = pdl->pList;

  00012	687c		 ldr         r4,[r7,#4]
  00014	2500		 movs        r5,#0
  00016		 |$LL5@UpdateClas|

; 829  :         while(!fDeviceRemoved && pds != NULL) {

  00016	b31c		 cbz         r4,|$LN19@UpdateClas|

; 830  :             PDEVICE_STATE pdsNext = NULL;
; 831  :             DeviceStateAddRef(pds);     // keep the device pointer alive

  00018	4620		 mov         r0,r4
  0001a	2600		 movs        r6,#0
  0001c	f000 f800	 bl          DeviceStateAddRef

; 832  :             
; 833  :             PMUNLOCK();

  00020	f000 f800	 bl          PmUnlock

; 834  :             UpdateDeviceState(pds);

  00024	4620		 mov         r0,r4
  00026	f000 f800	 bl          UpdateDeviceState

; 835  :             PMLOCK();

  0002a	f000 f800	 bl          PmLock

; 836  :             
; 837  :             // is the device still on the list?
; 838  :             if(pds->pListHead == NULL) {

  0002e	6e63		 ldr         r3,[r4,#0x64]
  00030	b973		 cbnz        r3,|$LN3@UpdateClas|

; 839  :                 // device disappeared while we were accessing it
; 840  :                 PMLOGMSG(ZONE_WARN || ZONE_DEVICE, 
; 841  :                     (_T("%s: device '%s' removed during update\r\n"), pszFname,
; 842  :                     pds->pszName));

  00032	f8d8 3440	 ldr         r3,[r8,#0x440]
  00036	f013 0f02	 tst         r3,#2
  0003a	d102		 bne         |$LN11@UpdateClas|
  0003c	f013 0f10	 tst         r3,#0x10
  00040	d004		 beq         |$LN12@UpdateClas|
  00042		 |$LN11@UpdateClas|
  00042	6822		 ldr         r2,[r4]
  00044	4909		 ldr         r1,|$LN29@UpdateClas| ; =|??_C@_1DA@MGDEIOCP@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAC?$AAl?$AAa?$AAs?$AAs?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AAs?$AA?$AA@|
  00046	4808		 ldr         r0,|$LN28@UpdateClas| ; =|??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@|
  00048	f000 f800	 bl          CeLogMsg
  0004c		 |$LN12@UpdateClas|

; 843  :                 fDeviceRemoved = TRUE;

  0004c	2501		 movs        r5,#1

; 844  :             } else {

  0004e	e000		 b           |$LN2@UpdateClas|
  00050		 |$LN3@UpdateClas|

; 845  :                 // save the next pointer so we don't try to
; 846  :                 // dereference pds after decrementing its use count.
; 847  :                 pdsNext = pds->pNext;

  00050	6ea6		 ldr         r6,[r4,#0x68]
  00052		 |$LN2@UpdateClas|

; 848  :             }
; 849  :             DeviceStateDecRef(pds);     // done with the device pointer

  00052	4620		 mov         r0,r4
  00054	f000 f800	 bl          DeviceStateDecRef

; 850  :             if(!fDeviceRemoved) pds = pdsNext;  // on to the next

  00058	2d00		 cmp         r5,#0
  0005a	d1da		 bne         |$LL8@UpdateClas|
  0005c	4634		 mov         r4,r6

; 829  :         while(!fDeviceRemoved && pds != NULL) {

  0005e	e7da		 b           |$LL5@UpdateClas|
  00060		 |$LN19@UpdateClas|

; 851  :         }
; 852  :     } while(fDeviceRemoved || pds != NULL);
; 853  : 
; 854  :     PMUNLOCK();

  00060	f000 f800	 bl          PmUnlock
  00064		 |$M26|

; 855  : }

  00064	e8bd 89f8	 pop         {r3-r8,r11,pc}
  00068		 |$LN27@UpdateClas|
  00068		 |$LN28@UpdateClas|
  00068	0000 0000	 DCD         |??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@|
  0006c		 |$LN29@UpdateClas|
  0006c	0000 0000	 DCD         |??_C@_1DA@MGDEIOCP@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAC?$AAl?$AAa?$AAs?$AAs?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAS?$AAt?$AAa?$AAt?$AAe?$AAs?$AA?$AA@|
  00070		 |$LN30@UpdateClas|
  00070	0000 0000	 DCD         |dpCurSettings|
  00074		 |$M24|

			 ENDP  ; |UpdateClassDeviceStates|

	EXPORT	|UpdateAllDeviceStates|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$UpdateAllDeviceStates| DCD imagerel |$LN13@UpdateAllD|
	DCD	0xfd30603d
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmdevice.cpp

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |UpdateAllDeviceStates| PROC

; 862  : {

  00000		 |$LN13@UpdateAllD|
  00000	e92d 4818	 push        {r3,r4,r11,lr}
  00004	f20d 0b08	 addw        r11,sp,#8
  00008		 |$M11|

; 863  :     PDEVICE_LIST pdl;
; 864  : 
; 865  :     // update all devices of all classes
; 866  :     for(pdl = gpDeviceLists; pdl != NULL; pdl = pdl->pNext) {

  00008	4b05		 ldr         r3,|$LN16@UpdateAllD| ; =|gpDeviceLists|
  0000a	681c		 ldr         r4,[r3]
  0000c	e003		 b           |$LN9@UpdateAllD|
  0000e		 |$LL3@UpdateAllD|

; 867  :         UpdateClassDeviceStates(pdl);

  0000e	4620		 mov         r0,r4
  00010	f000 f800	 bl          UpdateClassDeviceStates
  00014	6964		 ldr         r4,[r4,#0x14]
  00016		 |$LN9@UpdateAllD|

; 863  :     PDEVICE_LIST pdl;
; 864  : 
; 865  :     // update all devices of all classes
; 866  :     for(pdl = gpDeviceLists; pdl != NULL; pdl = pdl->pNext) {

  00016	2c00		 cmp         r4,#0
  00018	d1f9		 bne         |$LL3@UpdateAllD|
  0001a		 |$M14|

; 868  :     }
; 869  : }

  0001a	e8bd 8818	 pop         {r3,r4,r11,pc}
  0001e		 |$LN17@UpdateAllD|
  0001e		 |$M18|
  0001e	defe		 __debugbreak
  00020		 |$LN15@UpdateAllD|
  00020		 |$LN16@UpdateAllD|
  00020	0000 0000	 DCD         |gpDeviceLists|
  00024		 |$M12|

			 ENDP  ; |UpdateAllDeviceStates|

	END
