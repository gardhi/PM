; Listing generated by Microsoft (R) Optimizing Compiler Version 17.00.50727.114 

	TTL	C:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmrequire.cpp
	THUMB

  00000			 AREA	 |.drectve|, DRECTVE
	DCB	"-defaultlib:LIBCMT "
	DCB	"-defaultlib:OLDNAMES "

	IMPORT	|__security_push_cookie|
	IMPORT	|__security_pop_cookie|
	IMPORT	|__GSHandlerCheck|
	IMPORT	|StringCchVPrintfW|
	IMPORT	|StringCchLengthW|
	IMPORT	|CeLogData|

  00000			 AREA	 |.pdata|, PDATA
|$pdata1$CeLogMsg| DCD imagerel |$LN8@CeLogMsg|
	DCD	imagerel |$unwind2$CeLogMsg|

  00000			 AREA	 |.xdata|, DATA
|$unwind2$CeLogMsg| DCD 0x44b00032
	DCD	0x1e889e8
	DCD	0x400a8fb
	DCD	0x8801e8ff
	DCD	0xff05ef00
	DCD	imagerel |__GSHandlerCheck|
	DCD	0xffffffe5
; Function compile flags: /Ogsp
; File c:\wince800\public\common\sdk\inc\celog.h

  00000			 AREA	 |.text|, CODE, THUMB

  00000		 |CeLogMsg| PROC

; 1208 : {

  00000		 |$LN8@CeLogMsg|
  00000	b40f		 push        {r0-r3}
  00002	e92d 4800	 push        {r11,lr}
  00006	46eb		 mov         r11,sp
  00008	f000 f800	 bl          __security_push_cookie
  0000c	f2ad 2d24	 subw        sp,sp,#0x224
  00010		 |$M6|
  00010	4602		 mov         r2,r0

; 1209 :     va_list arglist;
; 1210 :     WCHAR   szTemp[MAX_PATH];
; 1211 :     size_t  cchLen;
; 1212 :     HRESULT hr;
; 1213 : 
; 1214 :     // Compose a single string using the input args
; 1215 :     va_start(arglist, szFormat);
; 1216 :     hr = StringCchVPrintfW(szTemp, MAX_PATH, szFormat, arglist);

  00012	a806		 add         r0,sp,#0x18
  00014	ab8d		 add         r3,sp,#0x234
  00016	f44f 7182	 mov         r1,#0x104
  0001a	928c		 str         r2,[sp,#0x230]
  0001c	f000 f800	 bl          StringCchVPrintfW

; 1217 :     if (SUCCEEDED(hr)) {

  00020	2800		 cmp         r0,#0
  00022	db17		 blt         |$LN1@CeLogMsg|

; 1218 :         hr = StringCchLengthW(szTemp, MAX_PATH, &cchLen);

  00024	aa04		 add         r2,sp,#0x10
  00026	a806		 add         r0,sp,#0x18
  00028	f44f 7182	 mov         r1,#0x104
  0002c	f000 f800	 bl          StringCchLengthW

; 1219 :         if (SUCCEEDED(hr)) {

  00030	2800		 cmp         r0,#0
  00032	db0f		 blt         |$LN1@CeLogMsg|

; 1220 :             CeLogData(TRUE, CELID_RAW_WCHAR, szTemp, (WORD)((cchLen + 1) * sizeof(WCHAR)),
; 1221 :                       0, CELZONE_ALWAYSON, 0, FALSE);

  00034	f04f 4380	 mov         r3,#0x40000000
  00038	9301		 str         r3,[sp,#4]
  0003a	9b04		 ldr         r3,[sp,#0x10]
  0003c	2200		 movs        r2,#0
  0003e	9203		 str         r2,[sp,#0xC]
  00040	3301		 adds        r3,#1
  00042	005b		 lsls        r3,r3,#1
  00044	9202		 str         r2,[sp,#8]
  00046	9200		 str         r2,[sp]
  00048	aa06		 add         r2,sp,#0x18
  0004a	214a		 movs        r1,#0x4A
  0004c	b29b		 uxth        r3,r3
  0004e	2001		 movs        r0,#1
  00050	f000 f800	 bl          CeLogData
  00054		 |$LN1@CeLogMsg|
  00054		 |$M9|

; 1222 :         }
; 1223 :     }
; 1224 : }

  00054	f20d 2d24	 addw        sp,sp,#0x224
  00058	f000 f800	 bl          __security_pop_cookie
  0005c	f85d bb04	 pop         {r11}
  00060	f85d fb14	 ldr         pc,[sp],#0x14
  00064		 |$M7|

			 ENDP  ; |CeLogMsg|

	EXPORT	|??_C@_1BM@MOOMGNKD@?$AA?$DM?$AAA?$AAl?$AAl?$AA?5?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$DO?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1JE@HGEMFFFP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAo?$AAf?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1FK@FNONLNGN@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAD?$AAE?$AAB?$AAU?$AAG?$AAC?$AAH?$AAK?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAi?$AAn?$AA?5?$AAf?$AAi?$AAl?$AAe?$AA?5?$AA?$CF?$AAs?$AA?5?$AAa@| [ DATA ] ; `string'
	EXPORT	|??_C@_1IM@MKHOHDAA@?$AAc?$AA?3?$AA?2?$AAw?$AAi?$AAn?$AAc?$AAe?$AA8?$AA0?$AA0?$AA?2?$AAp?$AAl?$AAa?$AAt?$AAf?$AAo?$AAr?$AAm?$AA?2?$AAr?$AAr?$AAm?$AA_?$AAp?$AAp?$AAc?$AA_?$AAw?$AAi?$AAn@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DM@KKMCPELB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAo?$AAt?$AAi?$AAf?$AAy?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@| [ DATA ] ; `string'
	EXPORT	|UpdateRequirementDevices|
	IMPORT	|dpCurSettings|
	IMPORT	|NKDbgPrintfW|
	IMPORT	|GetDeviceListFromClass|
	IMPORT	|DeviceStateFindList|
	IMPORT	|UpdateDeviceState|
	IMPORT	|DeviceStateDecRef|
	IMPORT	|PmLock|
	IMPORT	|DeviceStateAddRef|
	IMPORT	|PmUnlock|

  00008			 AREA	 |.pdata|, PDATA
|$pdata1$UpdateRequirementDevices| DCD imagerel |$LN40@UpdateRequ|
	DCD	0x2f402e9

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "d", 0x0, "e", 0x0, "v"
	DCB	0x0, "i", 0x0, "c", 0x0, "e", 0x0, " ", 0x0, "'", 0x0, "%"
	DCB	0x0, "s", 0x0, "'", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "m"
	DCB	0x0, "o", 0x0, "v", 0x0, "e", 0x0, "d", 0x0, " ", 0x0, "d"
	DCB	0x0, "u", 0x0, "r", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " "
	DCB	0x0, "u", 0x0, "p", 0x0, "d", 0x0, "a", 0x0, "t", 0x0, "e"
	DCB	0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0	; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DM@KKMCPELB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAo?$AAt?$AAi?$AAf?$AAy?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "n", 0x0, "o", 0x0, "t"
	DCB	0x0, "i", 0x0, "f", 0x0, "y", 0x0, "i", 0x0, "n", 0x0, "g"
	DCB	0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "8"
	DCB	0x0, "x", 0x0, " ", 0x0, "(", 0x0, "'", 0x0, "%", 0x0, "s"
	DCB	0x0, "'", 0x0, ")", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1IM@MKHOHDAA@?$AAc?$AA?3?$AA?2?$AAw?$AAi?$AAn?$AAc?$AAe?$AA8?$AA0?$AA0?$AA?2?$AAp?$AAl?$AAa?$AAt?$AAf?$AAo?$AAr?$AAm?$AA?2?$AAr?$AAr?$AAm?$AA_?$AAp?$AAp?$AAc?$AA_?$AAw?$AAi?$AAn@| DCB "c"
	DCB	0x0, ":", 0x0, "\\", 0x0, "w", 0x0, "i", 0x0, "n", 0x0, "c"
	DCB	0x0, "e", 0x0, "8", 0x0, "0", 0x0, "0", 0x0, "\\", 0x0, "p"
	DCB	0x0, "l", 0x0, "a", 0x0, "t", 0x0, "f", 0x0, "o", 0x0, "r"
	DCB	0x0, "m", 0x0, "\\", 0x0, "r", 0x0, "r", 0x0, "m", 0x0, "_"
	DCB	0x0, "p", 0x0, "p", 0x0, "c", 0x0, "_", 0x0, "w", 0x0, "i"
	DCB	0x0, "n", 0x0, "d", 0x0, "o", 0x0, "w", 0x0, "s", 0x0, "\\"
	DCB	0x0, "s", 0x0, "r", 0x0, "c", 0x0, "\\", 0x0, "d", 0x0, "r"
	DCB	0x0, "i", 0x0, "v", 0x0, "e", 0x0, "r", 0x0, "s", 0x0, "\\"
	DCB	0x0, "p", 0x0, "m", 0x0, "\\", 0x0, "m", 0x0, "d", 0x0, "d"
	DCB	0x0, "\\", 0x0, "p", 0x0, "m", 0x0, "r", 0x0, "e", 0x0, "q"
	DCB	0x0, "u", 0x0, "i", 0x0, "r", 0x0, "e", 0x0, ".", 0x0, "c"
	DCB	0x0, "p", 0x0, "p", 0x0, 0x0, 0x0	; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FK@FNONLNGN@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAD?$AAE?$AAB?$AAU?$AAG?$AAC?$AAH?$AAK?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAi?$AAn?$AA?5?$AAf?$AAi?$AAl?$AAe?$AA?5?$AA?$CF?$AAs?$AA?5?$AAa@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "D", 0x0, "E", 0x0, "B"
	DCB	0x0, "U", 0x0, "G", 0x0, "C", 0x0, "H", 0x0, "K", 0x0, " "
	DCB	0x0, "f", 0x0, "a", 0x0, "i", 0x0, "l", 0x0, "e", 0x0, "d"
	DCB	0x0, " ", 0x0, "i", 0x0, "n", 0x0, " ", 0x0, "f", 0x0, "i"
	DCB	0x0, "l", 0x0, "e", 0x0, " ", 0x0, "%", 0x0, "s", 0x0, " "
	DCB	0x0, "a", 0x0, "t", 0x0, " ", 0x0, "l", 0x0, "i", 0x0, "n"
	DCB	0x0, "e", 0x0, " ", 0x0, "%", 0x0, "d", 0x0, " ", 0x0, 0xd
	DCB	0x0, 0xa, 0x0, 0x0, 0x0			; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@| DCB "U"
	DCB	0x0, "p", 0x0, "d", 0x0, "a", 0x0, "t", 0x0, "e", 0x0, "R"
	DCB	0x0, "e", 0x0, "q", 0x0, "u", 0x0, "i", 0x0, "r", 0x0, "e"
	DCB	0x0, "m", 0x0, "e", 0x0, "n", 0x0, "t", 0x0, "D", 0x0, "e"
	DCB	0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, "s", 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1JE@HGEMFFFP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAo?$AAf?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "u", 0x0, "p", 0x0, "d"
	DCB	0x0, "a", 0x0, "t", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " "
	DCB	0x0, "'", 0x0, "%", 0x0, "s", 0x0, "'", 0x0, " ", 0x0, "o"
	DCB	0x0, "f", 0x0, " ", 0x0, "c", 0x0, "l", 0x0, "a", 0x0, "s"
	DCB	0x0, "s", 0x0, " ", 0x0, "%", 0x0, "0", 0x0, "8", 0x0, "x"
	DCB	0x0, "-", 0x0, "%", 0x0, "0", 0x0, "4", 0x0, "x", 0x0, "-"
	DCB	0x0, "%", 0x0, "0", 0x0, "4", 0x0, "x", 0x0, "-", 0x0, "%"
	DCB	0x0, "0", 0x0, "4", 0x0, "x", 0x0, "-", 0x0, "%", 0x0, "0"
	DCB	0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x"
	DCB	0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0"
	DCB	0x0, "2", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x"
	DCB	0x0, "%", 0x0, "0", 0x0, "2", 0x0, "x", 0x0, 0xd, 0x0, 0xa
	DCB	0x0, 0x0, 0x0				; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1BM@MOOMGNKD@?$AA?$DM?$AAA?$AAl?$AAl?$AA?5?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$DO?$AA?$AA@| DCB "<"
	DCB	0x0, "A", 0x0, "l", 0x0, "l", 0x0, " ", 0x0, "D", 0x0, "e"
	DCB	0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e", 0x0, "s", 0x0, ">"
	DCB	0x0, 0x0, 0x0				; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmrequire.cpp

  00064			 AREA	 |.text|, CODE, THUMB

  00064		 |UpdateRequirementDevices| PROC

; 26   : {

  00064		 |$LN40@UpdateRequ|
  00064	e92d 49f0	 push        {r4-r8,r11,lr}
  00068	f20d 0b14	 addw        r11,sp,#0x14
  0006c	b08b		 sub         sp,sp,#0x2C
  0006e		 |$M38|

; 27   :     SETFNAME(_T("UpdateRequirementDevices"));
; 28   : 
; 29   :     PMLOGMSG(ZONE_REQUIRE, 
; 30   :         (_T("%s: updating '%s' of class %08x-%04x-%04x-%04x-%02x%02x%02x%02x%02x%02x\r\n"),
; 31   :         pszFname, pDeviceId->pszName != NULL ? pDeviceId->pszName : _T("<All Devices>"),
; 32   :         pDeviceId->pGuid->Data1, pDeviceId->pGuid->Data2, pDeviceId->pGuid->Data3,
; 33   :         (pDeviceId->pGuid->Data4[0] << 8) + pDeviceId->pGuid->Data4[1], 
; 34   :         pDeviceId->pGuid->Data4[2], pDeviceId->pGuid->Data4[3], 
; 35   :         pDeviceId->pGuid->Data4[4], pDeviceId->pGuid->Data4[5], 
; 36   :         pDeviceId->pGuid->Data4[6], pDeviceId->pGuid->Data4[7]));

  0006e	4e61		 ldr         r6,|$LN50@UpdateRequ| ; =|dpCurSettings|
  00070	4605		 mov         r5,r0
  00072	f8d6 3440	 ldr         r3,[r6,#0x440]
  00076	f013 0f80	 tst         r3,#0x80
  0007a	d03b		 beq         |$LN18@UpdateRequ|
  0007c	686a		 ldr         r2,[r5,#4]
  0007e	b902		 cbnz        r2,|$LN15@UpdateRequ|
  00080	4a5b		 ldr         r2,|$LN49@UpdateRequ| ; =|??_C@_1BM@MOOMGNKD@?$AA?$DM?$AAA?$AAl?$AAl?$AA?5?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$DO?$AA?$AA@|
  00082		 |$LN15@UpdateRequ|
  00082	6828		 ldr         r0,[r5]
  00084	7bc3		 ldrb        r3,[r0,#0xF]
  00086	7a01		 ldrb        r1,[r0,#8]
  00088	9308		 str         r3,[sp,#0x20]
  0008a	7b83		 ldrb        r3,[r0,#0xE]
  0008c	9307		 str         r3,[sp,#0x1C]
  0008e	7b43		 ldrb        r3,[r0,#0xD]
  00090	9306		 str         r3,[sp,#0x18]
  00092	7b03		 ldrb        r3,[r0,#0xC]
  00094	9305		 str         r3,[sp,#0x14]
  00096	7ac3		 ldrb        r3,[r0,#0xB]
  00098	9304		 str         r3,[sp,#0x10]
  0009a	7a83		 ldrb        r3,[r0,#0xA]
  0009c	9303		 str         r3,[sp,#0xC]
  0009e	7a43		 ldrb        r3,[r0,#9]
  000a0	eb03 2301	 add         r3,r3,r1,lsl #8
  000a4	9302		 str         r3,[sp,#8]
  000a6	88c3		 ldrh        r3,[r0,#6]
  000a8	494c		 ldr         r1,|$LN44@UpdateRequ| ; =|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  000aa	9301		 str         r3,[sp,#4]
  000ac	8883		 ldrh        r3,[r0,#4]
  000ae	9300		 str         r3,[sp]
  000b0	6803		 ldr         r3,[r0]
  000b2	484e		 ldr         r0,|$LN48@UpdateRequ| ; =|??_C@_1JE@HGEMFFFP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAo?$AAf?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9@|
  000b4	f000 f800	 bl          NKDbgPrintfW
  000b8	686a		 ldr         r2,[r5,#4]
  000ba	b902		 cbnz        r2,|$LN17@UpdateRequ|
  000bc	4a4c		 ldr         r2,|$LN49@UpdateRequ| ; =|??_C@_1BM@MOOMGNKD@?$AA?$DM?$AAA?$AAl?$AAl?$AA?5?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$DO?$AA?$AA@|
  000be		 |$LN17@UpdateRequ|
  000be	682c		 ldr         r4,[r5]
  000c0	484a		 ldr         r0,|$LN48@UpdateRequ| ; =|??_C@_1JE@HGEMFFFP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAo?$AAf?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9@|
  000c2	7be3		 ldrb        r3,[r4,#0xF]
  000c4	7a21		 ldrb        r1,[r4,#8]
  000c6	9308		 str         r3,[sp,#0x20]
  000c8	7ba3		 ldrb        r3,[r4,#0xE]
  000ca	9307		 str         r3,[sp,#0x1C]
  000cc	7b63		 ldrb        r3,[r4,#0xD]
  000ce	9306		 str         r3,[sp,#0x18]
  000d0	7b23		 ldrb        r3,[r4,#0xC]
  000d2	9305		 str         r3,[sp,#0x14]
  000d4	7ae3		 ldrb        r3,[r4,#0xB]
  000d6	9304		 str         r3,[sp,#0x10]
  000d8	7aa3		 ldrb        r3,[r4,#0xA]
  000da	9303		 str         r3,[sp,#0xC]
  000dc	7a63		 ldrb        r3,[r4,#9]
  000de	eb03 2301	 add         r3,r3,r1,lsl #8
  000e2	9302		 str         r3,[sp,#8]
  000e4	88e3		 ldrh        r3,[r4,#6]
  000e6	493d		 ldr         r1,|$LN44@UpdateRequ| ; =|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  000e8	9301		 str         r3,[sp,#4]
  000ea	88a3		 ldrh        r3,[r4,#4]
  000ec	9300		 str         r3,[sp]
  000ee	6823		 ldr         r3,[r4]
  000f0	f000 f800	 bl          CeLogMsg
  000f4		 |$LN18@UpdateRequ|

; 37   : 
; 38   :     // all devices with a matching class
; 39   :     PDEVICE_LIST pdl = GetDeviceListFromClass(pDeviceId->pGuid);

  000f4	6828		 ldr         r0,[r5]
  000f6	f000 f800	 bl          GetDeviceListFromClass
  000fa	4607		 mov         r7,r0

; 40   :     PREFAST_DEBUGCHK(pdl != NULL);

  000fc	b937		 cbnz        r7,|$LN21@UpdateRequ|
  000fe	4a3a		 ldr         r2,|$LN47@UpdateRequ| ; =|??_C@_1IM@MKHOHDAA@?$AAc?$AA?3?$AA?2?$AAw?$AAi?$AAn?$AAc?$AAe?$AA8?$AA0?$AA0?$AA?2?$AAp?$AAl?$AAa?$AAt?$AAf?$AAo?$AAr?$AAm?$AA?2?$AAr?$AAr?$AAm?$AA_?$AAp?$AAp?$AAc?$AA_?$AAw?$AAi?$AAn@|
  00100	4838		 ldr         r0,|$LN46@UpdateRequ| ; =|??_C@_1FK@FNONLNGN@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAD?$AAE?$AAB?$AAU?$AAG?$AAC?$AAH?$AAK?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAi?$AAn?$AA?5?$AAf?$AAi?$AAl?$AAe?$AA?5?$AA?$CF?$AAs?$AA?5?$AAa@|
  00102	2328		 movs        r3,#0x28
  00104	4631		 mov         r1,r6
  00106	f000 f800	 bl          NKDbgPrintfW
  0010a	defe		 __debugbreak
  0010c		 |$LN21@UpdateRequ|

; 41   :     
; 42   :     // are we updating one device or all devices of a class?
; 43   :     if(pDeviceId->pszName != NULL) {

  0010c	6869		 ldr         r1,[r5,#4]
  0010e	b1e9		 cbz         r1,|$LN11@UpdateRequ|

; 44   :         PDEVICE_STATE pds = DeviceStateFindList(pdl, pDeviceId->pszName);

  00110	4638		 mov         r0,r7
  00112	f000 f800	 bl          DeviceStateFindList
  00116	4604		 mov         r4,r0

; 45   :         if(pds != NULL) {

  00118	2c00		 cmp         r4,#0
  0011a	d05a		 beq         |$LN9@UpdateRequ|

; 46   :             PMLOGMSG(ZONE_REQUIRE, (_T("%s: notifying 0x%08x ('%s')\r\n"),
; 47   :                 pszFname, pds, pds->pszName));

  0011c	f8d6 3440	 ldr         r3,[r6,#0x440]
  00120	f013 0f80	 tst         r3,#0x80
  00124	d00b		 beq         |$LN22@UpdateRequ|
  00126	6823		 ldr         r3,[r4]
  00128	492c		 ldr         r1,|$LN44@UpdateRequ| ; =|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  0012a	4602		 mov         r2,r0
  0012c	482c		 ldr         r0,|$LN45@UpdateRequ| ; =|??_C@_1DM@KKMCPELB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAo?$AAt?$AAi?$AAf?$AAy?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@|
  0012e	f000 f800	 bl          NKDbgPrintfW
  00132	6823		 ldr         r3,[r4]
  00134	4929		 ldr         r1,|$LN44@UpdateRequ| ; =|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  00136	482a		 ldr         r0,|$LN45@UpdateRequ| ; =|??_C@_1DM@KKMCPELB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAo?$AAt?$AAi?$AAf?$AAy?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@|
  00138	4622		 mov         r2,r4
  0013a	f000 f800	 bl          CeLogMsg
  0013e		 |$LN22@UpdateRequ|

; 48   :             UpdateDeviceState(pds);

  0013e	4620		 mov         r0,r4
  00140	f000 f800	 bl          UpdateDeviceState

; 49   :             DeviceStateDecRef(pds);

  00144	4620		 mov         r0,r4
  00146	f000 f800	 bl          DeviceStateDecRef

; 50   :         }
; 51   :     } else {

  0014a	e042		 b           |$LN9@UpdateRequ|
  0014c		 |$LN11@UpdateRequ|

; 52   :         BOOL fDeviceRemoved;
; 53   :         PDEVICE_STATE pds;
; 54   : 
; 55   :         PMLOCK();

  0014c	f000 f800	 bl          PmLock
  00150		 |$LL8@UpdateRequ|

; 56   :         
; 57   :         // Update all devices in a given class.  If a device is
; 58   :         // removed from the class list while we are iterating through
; 59   :         // it, start again.  This should be harmless because once devices
; 60   :         // have been updated they are at the right power level already.
; 61   :         // At the worst a device will be set to its current power level, and
; 62   :         // this will only happen if a device is removed from the list while
; 63   :         // we are working on it.
; 64   :         do {
; 65   :             fDeviceRemoved = FALSE;
; 66   :             pds = pdl->pList;

  00150	687c		 ldr         r4,[r7,#4]
  00152	2500		 movs        r5,#0
  00154		 |$LL5@UpdateRequ|

; 67   :             while(!fDeviceRemoved && pds != NULL) {

  00154	b3dc		 cbz         r4,|$LN34@UpdateRequ|

; 68   :                 PDEVICE_STATE pdsNext = NULL;
; 69   :                 
; 70   :                 // keep the device structure from being deallocated while
; 71   :                 // we're using a pointer to it
; 72   :                 DeviceStateAddRef(pds);

  00156	4620		 mov         r0,r4
  00158	f04f 0800	 mov         r8,#0
  0015c	f000 f800	 bl          DeviceStateAddRef

; 73   :                 
; 74   :                 // update the device power level if necessary
; 75   :                 PMUNLOCK();

  00160	f000 f800	 bl          PmUnlock

; 76   :                 PMLOGMSG(ZONE_REQUIRE, (_T("%s: notifying 0x%08x ('%s')\r\n"),
; 77   :                     pszFname, pds, pds->pszName));

  00164	f8d6 3440	 ldr         r3,[r6,#0x440]
  00168	f013 0f80	 tst         r3,#0x80
  0016c	d00b		 beq         |$LN24@UpdateRequ|
  0016e	6823		 ldr         r3,[r4]
  00170	491a		 ldr         r1,|$LN44@UpdateRequ| ; =|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  00172	481b		 ldr         r0,|$LN45@UpdateRequ| ; =|??_C@_1DM@KKMCPELB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAo?$AAt?$AAi?$AAf?$AAy?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@|
  00174	4622		 mov         r2,r4
  00176	f000 f800	 bl          NKDbgPrintfW
  0017a	6823		 ldr         r3,[r4]
  0017c	4917		 ldr         r1,|$LN44@UpdateRequ| ; =|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  0017e	4818		 ldr         r0,|$LN45@UpdateRequ| ; =|??_C@_1DM@KKMCPELB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAo?$AAt?$AAi?$AAf?$AAy?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@|
  00180	4622		 mov         r2,r4
  00182	f000 f800	 bl          CeLogMsg
  00186		 |$LN24@UpdateRequ|

; 78   :                 UpdateDeviceState(pds);

  00186	4620		 mov         r0,r4
  00188	f000 f800	 bl          UpdateDeviceState

; 79   :                 PMLOCK();

  0018c	f000 f800	 bl          PmLock

; 80   :                 
; 81   :                 // is the device still part of a list?
; 82   :                 if(pds->pListHead == NULL) {

  00190	6e63		 ldr         r3,[r4,#0x64]
  00192	b99b		 cbnz        r3,|$LN3@UpdateRequ|

; 83   :                     // device disappeared while we were accessing it
; 84   :                     PMLOGMSG(ZONE_WARN || ZONE_DEVICE, 
; 85   :                         (_T("%s: device '%s' removed during update\r\n"), pszFname,
; 86   :                         pds->pszName));

  00194	f8d6 3440	 ldr         r3,[r6,#0x440]
  00198	f013 0f02	 tst         r3,#2
  0019c	d102		 bne         |$LN26@UpdateRequ|
  0019e	f013 0f10	 tst         r3,#0x10
  001a2	d009		 beq         |$LN27@UpdateRequ|
  001a4		 |$LN26@UpdateRequ|
  001a4	6822		 ldr         r2,[r4]
  001a6	490d		 ldr         r1,|$LN44@UpdateRequ| ; =|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  001a8	480b		 ldr         r0,|$LN43@UpdateRequ| ; =|??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@|
  001aa	f000 f800	 bl          NKDbgPrintfW
  001ae	6822		 ldr         r2,[r4]
  001b0	490a		 ldr         r1,|$LN44@UpdateRequ| ; =|??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  001b2	4809		 ldr         r0,|$LN43@UpdateRequ| ; =|??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@|
  001b4	f000 f800	 bl          CeLogMsg
  001b8		 |$LN27@UpdateRequ|

; 87   :                     fDeviceRemoved = TRUE;

  001b8	2501		 movs        r5,#1

; 88   :                 } else {

  001ba	e001		 b           |$LN2@UpdateRequ|
  001bc		 |$LN3@UpdateRequ|

; 89   :                     // save the next pointer so we don't try to
; 90   :                     // dereference pds after decrementing its use count.
; 91   :                     pdsNext = pds->pNext;

  001bc	f8d4 8068	 ldr         r8,[r4,#0x68]
  001c0		 |$LN2@UpdateRequ|

; 92   :                 }
; 93   :                 
; 94   :                 // done with the pointer, although we can still
; 95   :                 // check if it's null
; 96   :                 DeviceStateDecRef(pds);

  001c0	4620		 mov         r0,r4
  001c2	f000 f800	 bl          DeviceStateDecRef

; 97   :                 
; 98   :                 // on to the next device, unless device removed
; 99   :                 if(!fDeviceRemoved) pds = pdsNext;

  001c6	2d00		 cmp         r5,#0
  001c8	d1c2		 bne         |$LL8@UpdateRequ|
  001ca	4644		 mov         r4,r8

; 67   :             while(!fDeviceRemoved && pds != NULL) {

  001cc	e7c2		 b           |$LL5@UpdateRequ|
  001ce		 |$LN34@UpdateRequ|

; 100  :             }
; 101  :         } while(fDeviceRemoved || pds != NULL);
; 102  :         
; 103  :         PMUNLOCK();

  001ce	f000 f800	 bl          PmUnlock
  001d2		 |$LN9@UpdateRequ|
  001d2		 |$M41|

; 104  :     }
; 105  : }

  001d2	b00b		 add         sp,sp,#0x2C
  001d4	e8bd 89f0	 pop         {r4-r8,r11,pc}
  001d8		 |$LN42@UpdateRequ|
  001d8		 |$LN43@UpdateRequ|
  001d8	0000 0000	 DCD         |??_C@_1FA@BLKCCPJO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAr?$AAe?$AAm?$AAo?$AAv?$AAe?$AAd?$AA?5?$AAd?$AAu?$AAr?$AAi?$AAn?$AAg?$AA?5?$AAu@|
  001dc		 |$LN44@UpdateRequ|
  001dc	0000 0000	 DCD         |??_C@_1DC@PGOLOMKN@?$AAU?$AAp?$AAd?$AAa?$AAt?$AAe?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$AA@|
  001e0		 |$LN45@UpdateRequ|
  001e0	0000 0000	 DCD         |??_C@_1DM@KKMCPELB@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAn?$AAo?$AAt?$AAi?$AAf?$AAy?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5?$AA?$CI?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?$CJ?$AA?$AN?$AA?6?$AA?$AA@|
  001e4		 |$LN46@UpdateRequ|
  001e4	0000 0000	 DCD         |??_C@_1FK@FNONLNGN@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAD?$AAE?$AAB?$AAU?$AAG?$AAC?$AAH?$AAK?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAi?$AAn?$AA?5?$AAf?$AAi?$AAl?$AAe?$AA?5?$AA?$CF?$AAs?$AA?5?$AAa@|
  001e8		 |$LN47@UpdateRequ|
  001e8	0000 0000	 DCD         |??_C@_1IM@MKHOHDAA@?$AAc?$AA?3?$AA?2?$AAw?$AAi?$AAn?$AAc?$AAe?$AA8?$AA0?$AA0?$AA?2?$AAp?$AAl?$AAa?$AAt?$AAf?$AAo?$AAr?$AAm?$AA?2?$AAr?$AAr?$AAm?$AA_?$AAp?$AAp?$AAc?$AA_?$AAw?$AAi?$AAn@|
  001ec		 |$LN48@UpdateRequ|
  001ec	0000 0000	 DCD         |??_C@_1JE@HGEMFFFP@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAu?$AAp?$AAd?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AA?8?$AA?$CF?$AAs?$AA?8?$AA?5?$AAo?$AAf?$AA?5?$AAc?$AAl?$AAa?$AAs?$AAs?$AA?5?$AA?$CF?$AA0?$AA8?$AAx?$AA?9@|
  001f0		 |$LN49@UpdateRequ|
  001f0	0000 0000	 DCD         |??_C@_1BM@MOOMGNKD@?$AA?$DM?$AAA?$AAl?$AAl?$AA?5?$AAD?$AAe?$AAv?$AAi?$AAc?$AAe?$AAs?$AA?$DO?$AA?$AA@|
  001f4		 |$LN50@UpdateRequ|
  001f4	0000 0000	 DCD         |dpCurSettings|
  001f8		 |$M39|

			 ENDP  ; |UpdateRequirementDevices|

	EXPORT	|??_C@_1FI@MEMIAAOD@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAr?$AAe?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAr?$AAe@| [ DATA ] ; `string'
	EXPORT	|??_C@_1CM@IPJPBNOH@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1EK@KBCPAFO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AAi?$AAs?$AA?5@| [ DATA ] ; `string'
	EXPORT	|PmSetPowerRequirement|
	IMPORT	|wcscmp|
	IMPORT	|gpFloorDx|
	IMPORT	|GetCallerVMProcessId|
	IMPORT	|PmEnterUpdate|
	IMPORT	|DeviceIdParseNameString|
	IMPORT	|PowerRestrictionCreate|
	IMPORT	|PowerRestrictionAddList|
	IMPORT	|gpSystemPowerState|
	IMPORT	|PmLeaveUpdate|
	IMPORT	|DeviceIdDestroy|
	IMPORT	|SetLastError|

  00010			 AREA	 |.pdata|, PDATA
|$pdata1$PmSetPowerRequirement| DCD imagerel |$LN21@PmSetPower|
	DCD	0x1760201

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EK@KBCPAFO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AAi?$AAs?$AA?5@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "t"
	DCB	0x0, "u", 0x0, "r", 0x0, "n", 0x0, "i", 0x0, "n", 0x0, "g"
	DCB	0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "8"
	DCB	0x0, "x", 0x0, ",", 0x0, " ", 0x0, "s", 0x0, "t", 0x0, "a"
	DCB	0x0, "t", 0x0, "u", 0x0, "s", 0x0, " ", 0x0, "i", 0x0, "s"
	DCB	0x0, " ", 0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1CM@IPJPBNOH@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@| DCB "P"
	DCB	0x0, "m", 0x0, "S", 0x0, "e", 0x0, "t", 0x0, "P", 0x0, "o"
	DCB	0x0, "w", 0x0, "e", 0x0, "r", 0x0, "R", 0x0, "e", 0x0, "q"
	DCB	0x0, "u", 0x0, "i", 0x0, "r", 0x0, "e", 0x0, "m", 0x0, "e"
	DCB	0x0, "n", 0x0, "t", 0x0, 0x0, 0x0	; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1FI@MEMIAAOD@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAr?$AAe?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAr?$AAe@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "c", 0x0, "r", 0x0, "e"
	DCB	0x0, "a", 0x0, "t", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " "
	DCB	0x0, "d", 0x0, "e", 0x0, "v", 0x0, "i", 0x0, "c", 0x0, "e"
	DCB	0x0, " ", 0x0, "s", 0x0, "t", 0x0, "a", 0x0, "t", 0x0, "e"
	DCB	0x0, " ", 0x0, "D", 0x0, "%", 0x0, "d", 0x0, " ", 0x0, "r"
	DCB	0x0, "e", 0x0, "q", 0x0, "u", 0x0, "i", 0x0, "r", 0x0, "e"
	DCB	0x0, "m", 0x0, "e", 0x0, "n", 0x0, "t", 0x0, 0xd, 0x0, 0xa
	DCB	0x0, 0x0, 0x0				; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmrequire.cpp

  001f8			 AREA	 |.text|, CODE, THUMB

  001f8		 |PmSetPowerRequirement| PROC

; 231  : {

  001f8		 |$LN21@PmSetPower|
  001f8	e92d 4ff0	 push        {r4-r11,lr}
  001fc	f20d 0b1c	 addw        r11,sp,#0x1C
  00200	b085		 sub         sp,sp,#0x14
  00202		 |$M19|
  00202	9302		 str         r3,[sp,#8]
  00204	4692		 mov         r10,r2
  00206	4688		 mov         r8,r1
  00208	4681		 mov         r9,r0

; 232  :     HANDLE hRequirement = NULL;

  0020a	2400		 movs        r4,#0

; 233  :     BOOL fUpdate = FALSE;

  0020c	2700		 movs        r7,#0

; 234  :     PDEVICEID pdi = NULL;

  0020e	2600		 movs        r6,#0

; 235  :     HANDLE hOwner = (HANDLE) GetCallerVMProcessId();

  00210	f000 f800	 bl          GetCallerVMProcessId

; 236  :     DWORD dwStatus = ERROR_SUCCESS;
; 237  :     SETFNAME(_T("PmSetPowerRequirement"));
; 238  : 
; 239  :     UNREFERENCED_PARAMETER(dwStateFlags);
; 240  : 
; 241  :     PMLOGMSG(ZONE_REQUIRE || ZONE_API, (_T("%s: creating device state D%d requirement\r\n"),
; 242  :         pszFname, reqDx));

  00214	4b3a		 ldr         r3,|$LN26@PmSetPower| ; =|dpCurSettings|
  00216	2500		 movs        r5,#0
  00218	9003		 str         r0,[sp,#0xC]
  0021a	f8d3 1440	 ldr         r1,[r3,#0x440]
  0021e	f011 0f80	 tst         r1,#0x80
  00222	d102		 bne         |$LN12@PmSetPower|
  00224	f411 6f00	 tst         r1,#0x800
  00228	d009		 beq         |$LN13@PmSetPower|
  0022a		 |$LN12@PmSetPower|
  0022a	4934		 ldr         r1,|$LN25@PmSetPower| ; =|??_C@_1CM@IPJPBNOH@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  0022c	4837		 ldr         r0,|$LN29@PmSetPower| ; =|??_C@_1FI@MEMIAAOD@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAr?$AAe?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAr?$AAe@|
  0022e	4642		 mov         r2,r8
  00230	f000 f800	 bl          NKDbgPrintfW
  00234	4931		 ldr         r1,|$LN25@PmSetPower| ; =|??_C@_1CM@IPJPBNOH@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  00236	4835		 ldr         r0,|$LN29@PmSetPower| ; =|??_C@_1FI@MEMIAAOD@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAr?$AAe?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAr?$AAe@|
  00238	4642		 mov         r2,r8
  0023a	f000 f800	 bl          CeLogMsg
  0023e		 |$LN13@PmSetPower|

; 243  : 
; 244  :     PMENTERUPDATE();

  0023e	f000 f800	 bl          PmEnterUpdate

; 245  : 
; 246  :     // sanity check parameters
; 247  :     if(pvDevice == NULL 
; 248  :     || (reqDx < D0 || reqDx > D4)
; 249  :     || (pdi = DeviceIdParseNameString((LPCTSTR) pvDevice, dwDeviceFlags)) == NULL
; 250  :     || GetDeviceListFromClass(pdi->pGuid) == NULL) {

  00242	f1b9 0f00	 cmp         r9,#0
  00246	d030		 beq         |$LN8@PmSetPower|
  00248	f1b8 0f04	 cmp         r8,#4
  0024c	d82d		 bhi         |$LN8@PmSetPower|
  0024e	4651		 mov         r1,r10
  00250	4648		 mov         r0,r9
  00252	f000 f800	 bl          DeviceIdParseNameString
  00256	4606		 mov         r6,r0
  00258	b33e		 cbz         r6,|$LN8@PmSetPower|
  0025a	6830		 ldr         r0,[r6]
  0025c	f000 f800	 bl          GetDeviceListFromClass
  00260	b318		 cbz         r0,|$LN8@PmSetPower|

; 252  :     }
; 253  : 
; 254  :     // if parameters were ok then proceed
; 255  :     if(dwStatus == ERROR_SUCCESS) {
; 256  :         // mask off flags we don't need to keep
; 257  :         dwDeviceFlags &= POWER_FORCE;
; 258  : 
; 259  :         PMLOCK();

  00262	f000 f800	 bl          PmLock
  00266	f41a 5380	 ands        r3,r10,#0x1000

; 260  :         
; 261  :         // create a new restriction structure
; 262  :         PDEVICE_POWER_RESTRICTION pdpr = PowerRestrictionCreate(pdi, hOwner, reqDx, 
; 263  :             (LPCTSTR) pvSystemState, dwDeviceFlags);

  0026a	9903		 ldr         r1,[sp,#0xC]
  0026c	9300		 str         r3,[sp]
  0026e	9b02		 ldr         r3,[sp,#8]
  00270	4642		 mov         r2,r8
  00272	4630		 mov         r0,r6
  00274	f000 f800	 bl          PowerRestrictionCreate
  00278	4604		 mov         r4,r0

; 264  :         if(pdpr == NULL) {

  0027a	b90c		 cbnz        r4,|$LN6@PmSetPower|

; 265  :             dwStatus = ERROR_NOT_ENOUGH_MEMORY;

  0027c	2508		 movs        r5,#8

; 266  :         } else {

  0027e	e003		 b           |$LN5@PmSetPower|
  00280		 |$LN6@PmSetPower|

; 267  :             PowerRestrictionAddList(&gpFloorDx, pdpr);

  00280	4821		 ldr         r0,|$LN28@PmSetPower| ; =|gpFloorDx|
  00282	4621		 mov         r1,r4
  00284	f000 f800	 bl          PowerRestrictionAddList
  00288		 |$LN5@PmSetPower|

; 268  :         }
; 269  :         hRequirement = (HANDLE) pdpr;
; 270  :         
; 271  :         // should we update the device's power state?
; 272  :         if(pdpr !=NULL && 
; 273  :                 (pdpr->pszSystemState == NULL || _tcscmp(pdpr->pszSystemState, gpSystemPowerState->pszName) == 0)) {

  00288	b144		 cbz         r4,|$LN4@PmSetPower|
  0028a	68e0		 ldr         r0,[r4,#0xC]
  0028c	b128		 cbz         r0,|$LN3@PmSetPower|
  0028e	4b1d		 ldr         r3,|$LN27@PmSetPower| ; =|gpSystemPowerState|
  00290	681b		 ldr         r3,[r3]
  00292	6819		 ldr         r1,[r3]
  00294	f000 f800	 bl          wcscmp
  00298	b900		 cbnz        r0,|$LN4@PmSetPower|
  0029a		 |$LN3@PmSetPower|

; 274  :             fUpdate = TRUE;

  0029a	2701		 movs        r7,#1
  0029c		 |$LN4@PmSetPower|

; 275  :         }
; 276  :         
; 277  :         PMUNLOCK();

  0029c	f000 f800	 bl          PmUnlock

; 278  :         
; 279  :         // if the update flag is set, we should update the device power for
; 280  :         // all matching devices.  Whether this works or not doesn't affect the
; 281  :         // return code from this API, since the restriction has been successfully
; 282  :         // put into place.
; 283  :         if(fUpdate) {

  002a0	b127		 cbz         r7,|$LN2@PmSetPower|

; 284  :             UpdateRequirementDevices(pdi);

  002a2	4630		 mov         r0,r6
  002a4	f000 f800	 bl          UpdateRequirementDevices
  002a8	e000		 b           |$LN2@PmSetPower|
  002aa		 |$LN8@PmSetPower|

; 251  :         dwStatus = ERROR_INVALID_PARAMETER;

  002aa	2557		 movs        r5,#0x57
  002ac		 |$LN2@PmSetPower|

; 285  :         }
; 286  :     }
; 287  : 
; 288  :     PMLEAVEUPDATE();

  002ac	f000 f800	 bl          PmLeaveUpdate

; 289  : 
; 290  :     // release resources
; 291  :     if(pdi != NULL) DeviceIdDestroy(pdi);

  002b0	b116		 cbz         r6,|$LN1@PmSetPower|
  002b2	4630		 mov         r0,r6
  002b4	f000 f800	 bl          DeviceIdDestroy
  002b8		 |$LN1@PmSetPower|

; 292  : 
; 293  :     // return handle and set global status
; 294  :     PMLOGMSG(ZONE_REQUIRE || ZONE_API || (dwStatus != ERROR_SUCCESS && ZONE_WARN),
; 295  :         (_T("%s: returning 0x%08x, status is %d\r\n"), pszFname,
; 296  :         hRequirement, dwStatus));

  002b8	4b11		 ldr         r3,|$LN26@PmSetPower| ; =|dpCurSettings|
  002ba	f8d3 3440	 ldr         r3,[r3,#0x440]
  002be	f013 0f80	 tst         r3,#0x80
  002c2	d106		 bne         |$LN14@PmSetPower|
  002c4	f413 6f00	 tst         r3,#0x800
  002c8	d103		 bne         |$LN14@PmSetPower|
  002ca	b175		 cbz         r5,|$LN16@PmSetPower|
  002cc	f013 0f02	 tst         r3,#2
  002d0	d00b		 beq         |$LN16@PmSetPower|
  002d2		 |$LN14@PmSetPower|
  002d2	490a		 ldr         r1,|$LN25@PmSetPower| ; =|??_C@_1CM@IPJPBNOH@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  002d4	4808		 ldr         r0,|$LN24@PmSetPower| ; =|??_C@_1EK@KBCPAFO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AAi?$AAs?$AA?5@|
  002d6	462b		 mov         r3,r5
  002d8	4622		 mov         r2,r4
  002da	f000 f800	 bl          NKDbgPrintfW
  002de	4907		 ldr         r1,|$LN25@PmSetPower| ; =|??_C@_1CM@IPJPBNOH@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  002e0	4805		 ldr         r0,|$LN24@PmSetPower| ; =|??_C@_1EK@KBCPAFO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AAi?$AAs?$AA?5@|
  002e2	462b		 mov         r3,r5
  002e4	4622		 mov         r2,r4
  002e6	f000 f800	 bl          CeLogMsg
  002ea		 |$LN16@PmSetPower|

; 297  :     SetLastError(dwStatus);

  002ea	4628		 mov         r0,r5
  002ec	f000 f800	 bl          SetLastError

; 298  :     return hRequirement;
; 299  : }

  002f0	4620		 mov         r0,r4
  002f2		 |$M22|
  002f2	b005		 add         sp,sp,#0x14
  002f4	e8bd 8ff0	 pop         {r4-r11,pc}
  002f8		 |$LN23@PmSetPower|
  002f8		 |$LN24@PmSetPower|
  002f8	0000 0000	 DCD         |??_C@_1EK@KBCPAFO@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?0?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAu?$AAs?$AA?5?$AAi?$AAs?$AA?5@|
  002fc		 |$LN25@PmSetPower|
  002fc	0000 0000	 DCD         |??_C@_1CM@IPJPBNOH@?$AAP?$AAm?$AAS?$AAe?$AAt?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  00300		 |$LN26@PmSetPower|
  00300	0000 0000	 DCD         |dpCurSettings|
  00304		 |$LN27@PmSetPower|
  00304	0000 0000	 DCD         |gpSystemPowerState|
  00308		 |$LN28@PmSetPower|
  00308	0000 0000	 DCD         |gpFloorDx|
  0030c		 |$LN29@PmSetPower|
  0030c	0000 0000	 DCD         |??_C@_1FI@MEMIAAOD@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAc?$AAr?$AAe?$AAa?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAd?$AAe?$AAv?$AAi?$AAc?$AAe?$AA?5?$AAs?$AAt?$AAa?$AAt?$AAe?$AA?5?$AAD?$AA?$CF?$AAd?$AA?5?$AAr?$AAe@|
  00310		 |$M20|

			 ENDP  ; |PmSetPowerRequirement|

	EXPORT	|??_C@_1EG@FHNKDJNL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAl?$AAe?$AAa?$AAs?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DE@OMDGBEEH@?$AAP?$AAm?$AAR?$AAe?$AAl?$AAe?$AAa?$AAs?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|PmReleasePowerRequirement|
	IMPORT	|PowerRestrictionCheckList|
	IMPORT	|DeviceIdClone|
	IMPORT	|PowerRestrictionRemList|
	IMPORT	|PowerRestrictionDestroy|

  00018			 AREA	 |.pdata|, PDATA
|$pdata1$PmReleasePowerRequirement| DCD imagerel |$LN19@PmReleaseP|
	DCD	0xfd346191

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "t"
	DCB	0x0, "u", 0x0, "r", 0x0, "n", 0x0, "i", 0x0, "n", 0x0, "g"
	DCB	0x0, " ", 0x0, "%", 0x0, "d", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0
	DCB	0x0					; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DE@OMDGBEEH@?$AAP?$AAm?$AAR?$AAe?$AAl?$AAe?$AAa?$AAs?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@| DCB "P"
	DCB	0x0, "m", 0x0, "R", 0x0, "e", 0x0, "l", 0x0, "e", 0x0, "a"
	DCB	0x0, "s", 0x0, "e", 0x0, "P", 0x0, "o", 0x0, "w", 0x0, "e"
	DCB	0x0, "r", 0x0, "R", 0x0, "e", 0x0, "q", 0x0, "u", 0x0, "i"
	DCB	0x0, "r", 0x0, "e", 0x0, "m", 0x0, "e", 0x0, "n", 0x0, "t"
	DCB	0x0, 0x0, 0x0				; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1EG@FHNKDJNL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAl?$AAe?$AAa?$AAs?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "r", 0x0, "e", 0x0, "l"
	DCB	0x0, "e", 0x0, "a", 0x0, "s", 0x0, "i", 0x0, "n", 0x0, "g"
	DCB	0x0, " ", 0x0, "r", 0x0, "e", 0x0, "q", 0x0, "u", 0x0, "i"
	DCB	0x0, "r", 0x0, "e", 0x0, "m", 0x0, "e", 0x0, "n", 0x0, "t"
	DCB	0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "8"
	DCB	0x0, "x", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmrequire.cpp

  00310			 AREA	 |.text|, CODE, THUMB

  00310		 |PmReleasePowerRequirement| PROC

; 170  : {

  00310		 |$LN19@PmReleaseP|
  00310	e92d 49f8	 push        {r3-r8,r11,lr}
  00314	f20d 0b18	 addw        r11,sp,#0x18
  00318		 |$M17|

; 171  :     DWORD dwStatus = ERROR_INVALID_HANDLE;
; 172  :     PDEVICE_POWER_RESTRICTION pdpr = (PDEVICE_POWER_RESTRICTION) h;
; 173  :     PDEVICEID pDeviceId = NULL;
; 174  :     SETFNAME(_T("PmReleasePowerRequirement"));
; 175  : 
; 176  :     UNREFERENCED_PARAMETER(dwFlags);
; 177  : 
; 178  :     PMLOGMSG(ZONE_REQUIRE || ZONE_API, (_T("%s: releasing requirement 0x%08x\r\n"), 
; 179  :         pszFname, h));

  00318	4f35		 ldr         r7,|$LN28@PmReleaseP| ; =|dpCurSettings|
  0031a	2406		 movs        r4,#6
  0031c	2500		 movs        r5,#0
  0031e	f8d7 3440	 ldr         r3,[r7,#0x440]
  00322	4606		 mov         r6,r0
  00324	f013 0f80	 tst         r3,#0x80
  00328	d102		 bne         |$LN7@PmReleaseP|
  0032a	f413 6f00	 tst         r3,#0x800
  0032e	d009		 beq         |$LN8@PmReleaseP|
  00330		 |$LN7@PmReleaseP|
  00330	492a		 ldr         r1,|$LN23@PmReleaseP| ; =|??_C@_1DE@OMDGBEEH@?$AAP?$AAm?$AAR?$AAe?$AAl?$AAe?$AAa?$AAs?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  00332	482e		 ldr         r0,|$LN27@PmReleaseP| ; =|??_C@_1EG@FHNKDJNL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAl?$AAe?$AAa?$AAs?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx@|
  00334	4632		 mov         r2,r6
  00336	f000 f800	 bl          NKDbgPrintfW
  0033a	4928		 ldr         r1,|$LN23@PmReleaseP| ; =|??_C@_1DE@OMDGBEEH@?$AAP?$AAm?$AAR?$AAe?$AAl?$AAe?$AAa?$AAs?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  0033c	482b		 ldr         r0,|$LN27@PmReleaseP| ; =|??_C@_1EG@FHNKDJNL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAl?$AAe?$AAa?$AAs?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx@|
  0033e	4632		 mov         r2,r6
  00340	f000 f800	 bl          CeLogMsg
  00344		 |$LN8@PmReleaseP|

; 180  : 
; 181  :     PMENTERUPDATE();

  00344	f000 f800	 bl          PmEnterUpdate

; 182  :     PMLOCK();

  00348	f000 f800	 bl          PmLock

; 183  : 
; 184  :     // look for the entry.  If it's valid make sure that it has the same owner.
; 185  :     BOOL fFound = PowerRestrictionCheckList(gpFloorDx, pdpr);

  0034c	f8df 8098	 ldr         r8,|$LN26@PmReleaseP| ; =|gpFloorDx|
  00350	4631		 mov         r1,r6
  00352	f8d8 0000	 ldr         r0,[r8]
  00356	f000 f800	 bl          PowerRestrictionCheckList

; 186  :     if(fFound) {

  0035a	b1d8		 cbz         r0,|$LN2@PmReleaseP|

; 187  :         // don't allow the caller to delete somebody else's requirement
; 188  :         if(pdpr->hOwner == (HANDLE) GetCallerVMProcessId()) {

  0035c	f000 f800	 bl          GetCallerVMProcessId
  00360	6873		 ldr         r3,[r6,#4]
  00362	4283		 cmp         r3,r0
  00364	d116		 bne         |$LN2@PmReleaseP|

; 189  :             // clone the device identifier associated with the requirement
; 190  :             // so that we can update affected devices after removing the
; 191  :             // restriction.
; 192  :             pDeviceId = DeviceIdClone(pdpr->pDeviceId);

  00366	6830		 ldr         r0,[r6]
  00368	f000 f800	 bl          DeviceIdClone
  0036c	4605		 mov         r5,r0

; 193  : 
; 194  :             // delete the restriction
; 195  :             fFound = PowerRestrictionRemList(&gpFloorDx, pdpr);

  0036e	4640		 mov         r0,r8
  00370	4631		 mov         r1,r6
  00372	f000 f800	 bl          PowerRestrictionRemList
  00376	4680		 mov         r8,r0

; 196  :             DEBUGCHK(fFound);

  00378	b948		 cbnz        r0,|$LN15@PmReleaseP|
  0037a	4a1a		 ldr         r2,|$LN25@PmReleaseP| ; =|??_C@_1IM@MKHOHDAA@?$AAc?$AA?3?$AA?2?$AAw?$AAi?$AAn?$AAc?$AAe?$AA8?$AA0?$AA0?$AA?2?$AAp?$AAl?$AAa?$AAt?$AAf?$AAo?$AAr?$AAm?$AA?2?$AAr?$AAr?$AAm?$AA_?$AAp?$AAp?$AAc?$AA_?$AAw?$AAi?$AAn@|
  0037c	4818		 ldr         r0,|$LN24@PmReleaseP| ; =|??_C@_1FK@FNONLNGN@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAD?$AAE?$AAB?$AAU?$AAG?$AAC?$AAH?$AAK?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAi?$AAn?$AA?5?$AAf?$AAi?$AAl?$AAe?$AA?5?$AA?$CF?$AAs?$AA?5?$AAa@|
  0037e	23c4		 movs        r3,#0xC4
  00380	4639		 mov         r1,r7
  00382	f000 f800	 bl          NKDbgPrintfW
  00386	defe		 __debugbreak

; 197  :             if(fFound) {

  00388	f1b8 0f00	 cmp         r8,#0
  0038c	d002		 beq         |$LN2@PmReleaseP|
  0038e		 |$LN15@PmReleaseP|

; 198  :                 PowerRestrictionDestroy(pdpr);

  0038e	4630		 mov         r0,r6
  00390	f000 f800	 bl          PowerRestrictionDestroy
  00394		 |$LN2@PmReleaseP|

; 199  :             }
; 200  :         }
; 201  :     }
; 202  : 
; 203  :     PMUNLOCK();

  00394	f000 f800	 bl          PmUnlock

; 204  : 
; 205  :     // update any affected devices
; 206  :     if(pDeviceId) {

  00398	b135		 cbz         r5,|$LN1@PmReleaseP|

; 207  :         UpdateRequirementDevices(pDeviceId);

  0039a	4628		 mov         r0,r5
  0039c	f000 f800	 bl          UpdateRequirementDevices

; 208  :         DeviceIdDestroy(pDeviceId);

  003a0	4628		 mov         r0,r5
  003a2	f000 f800	 bl          DeviceIdDestroy

; 209  :         dwStatus = ERROR_SUCCESS;

  003a6	2400		 movs        r4,#0
  003a8		 |$LN1@PmReleaseP|

; 210  :     }
; 211  : 
; 212  :     PMLEAVEUPDATE();

  003a8	f000 f800	 bl          PmLeaveUpdate

; 213  : 
; 214  :     PMLOGMSG((dwStatus != ERROR_SUCCESS && ZONE_WARN) || ZONE_API, 
; 215  :         (_T("%s: returning %d\r\n"), pszFname, dwStatus));

  003ac	f8d7 3440	 ldr         r3,[r7,#0x440]
  003b0	b114		 cbz         r4,|$LN11@PmReleaseP|
  003b2	f013 0f02	 tst         r3,#2
  003b6	d102		 bne         |$LN12@PmReleaseP|
  003b8		 |$LN11@PmReleaseP|
  003b8	f413 6f00	 tst         r3,#0x800
  003bc	d009		 beq         |$LN13@PmReleaseP|
  003be		 |$LN12@PmReleaseP|
  003be	4907		 ldr         r1,|$LN23@PmReleaseP| ; =|??_C@_1DE@OMDGBEEH@?$AAP?$AAm?$AAR?$AAe?$AAl?$AAe?$AAa?$AAs?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  003c0	4805		 ldr         r0,|$LN22@PmReleaseP| ; =|??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  003c2	4622		 mov         r2,r4
  003c4	f000 f800	 bl          NKDbgPrintfW
  003c8	4904		 ldr         r1,|$LN23@PmReleaseP| ; =|??_C@_1DE@OMDGBEEH@?$AAP?$AAm?$AAR?$AAe?$AAl?$AAe?$AAa?$AAs?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  003ca	4803		 ldr         r0,|$LN22@PmReleaseP| ; =|??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  003cc	4622		 mov         r2,r4
  003ce	f000 f800	 bl          CeLogMsg
  003d2		 |$LN13@PmReleaseP|

; 216  :     return dwStatus;
; 217  : }

  003d2	4620		 mov         r0,r4
  003d4		 |$M20|
  003d4	e8bd 89f8	 pop         {r3-r8,r11,pc}
  003d8		 |$LN21@PmReleaseP|
  003d8		 |$LN22@PmReleaseP|
  003d8	0000 0000	 DCD         |??_C@_1CG@EPNLEKEF@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAt?$AAu?$AAr?$AAn?$AAi?$AAn?$AAg?$AA?5?$AA?$CF?$AAd?$AA?$AN?$AA?6?$AA?$AA@|
  003dc		 |$LN23@PmReleaseP|
  003dc	0000 0000	 DCD         |??_C@_1DE@OMDGBEEH@?$AAP?$AAm?$AAR?$AAe?$AAl?$AAe?$AAa?$AAs?$AAe?$AAP?$AAo?$AAw?$AAe?$AAr?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?$AA@|
  003e0		 |$LN24@PmReleaseP|
  003e0	0000 0000	 DCD         |??_C@_1FK@FNONLNGN@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAD?$AAE?$AAB?$AAU?$AAG?$AAC?$AAH?$AAK?$AA?5?$AAf?$AAa?$AAi?$AAl?$AAe?$AAd?$AA?5?$AAi?$AAn?$AA?5?$AAf?$AAi?$AAl?$AAe?$AA?5?$AA?$CF?$AAs?$AA?5?$AAa@|
  003e4		 |$LN25@PmReleaseP|
  003e4	0000 0000	 DCD         |??_C@_1IM@MKHOHDAA@?$AAc?$AA?3?$AA?2?$AAw?$AAi?$AAn?$AAc?$AAe?$AA8?$AA0?$AA0?$AA?2?$AAp?$AAl?$AAa?$AAt?$AAf?$AAo?$AAr?$AAm?$AA?2?$AAr?$AAr?$AAm?$AA_?$AAp?$AAp?$AAc?$AA_?$AAw?$AAi?$AAn@|
  003e8		 |$LN26@PmReleaseP|
  003e8	0000 0000	 DCD         |gpFloorDx|
  003ec		 |$LN27@PmReleaseP|
  003ec	0000 0000	 DCD         |??_C@_1EG@FHNKDJNL@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAr?$AAe?$AAl?$AAe?$AAa?$AAs?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx@|
  003f0		 |$LN28@PmReleaseP|
  003f0	0000 0000	 DCD         |dpCurSettings|
  003f4		 |$M18|

			 ENDP  ; |PmReleasePowerRequirement|

	EXPORT	|??_C@_1GK@KOLHFJIM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAl?$AAe?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5@| [ DATA ] ; `string'
	EXPORT	|??_C@_1DE@CEKPIGEL@?$AAD?$AAe?$AAl?$AAe?$AAt?$AAe?$AAP?$AAr?$AAo?$AAc?$AAe?$AAs?$AAs?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAs?$AA?$AA@| [ DATA ] ; `string'
	EXPORT	|DeleteProcessRequirements|

  00020			 AREA	 |.pdata|, PDATA
|$pdata1$DeleteProcessRequirements| DCD imagerel |$LN24@DeleteProc|
	DCD	0x356121

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1DE@CEKPIGEL@?$AAD?$AAe?$AAl?$AAe?$AAt?$AAe?$AAP?$AAr?$AAo?$AAc?$AAe?$AAs?$AAs?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAs?$AA?$AA@| DCB "D"
	DCB	0x0, "e", 0x0, "l", 0x0, "e", 0x0, "t", 0x0, "e", 0x0, "P"
	DCB	0x0, "r", 0x0, "o", 0x0, "c", 0x0, "e", 0x0, "s", 0x0, "s"
	DCB	0x0, "R", 0x0, "e", 0x0, "q", 0x0, "u", 0x0, "i", 0x0, "r"
	DCB	0x0, "e", 0x0, "m", 0x0, "e", 0x0, "n", 0x0, "t", 0x0, "s"
	DCB	0x0, 0x0, 0x0				; `string'

  00000			 AREA	 |.rdata|, DATA, READONLY
|??_C@_1GK@KOLHFJIM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAl?$AAe?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5@| DCB "%"
	DCB	0x0, "s", 0x0, ":", 0x0, " ", 0x0, "d", 0x0, "e", 0x0, "l"
	DCB	0x0, "e", 0x0, "t", 0x0, "i", 0x0, "n", 0x0, "g", 0x0, " "
	DCB	0x0, "r", 0x0, "e", 0x0, "q", 0x0, "u", 0x0, "i", 0x0, "r"
	DCB	0x0, "e", 0x0, "m", 0x0, "e", 0x0, "n", 0x0, "t", 0x0, " "
	DCB	0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "8", 0x0, "x"
	DCB	0x0, " ", 0x0, "f", 0x0, "o", 0x0, "r", 0x0, " ", 0x0, "p"
	DCB	0x0, "r", 0x0, "o", 0x0, "c", 0x0, "e", 0x0, "s", 0x0, "s"
	DCB	0x0, " ", 0x0, "0", 0x0, "x", 0x0, "%", 0x0, "0", 0x0, "8"
	DCB	0x0, "x", 0x0, 0xd, 0x0, 0xa, 0x0, 0x0, 0x0 ; `string'
; Function compile flags: /Ogsp
; File c:\wince800\platform\rrm_ppc_windows\src\drivers\pm\mdd\pmrequire.cpp

  003f4			 AREA	 |.text|, CODE, THUMB

  003f4		 |DeleteProcessRequirements| PROC

; 111  : {

  003f4		 |$LN24@DeleteProc|
  003f4	e92d 4bf0	 push        {r4-r9,r11,lr}
  003f8	f20d 0b18	 addw        r11,sp,#0x18
  003fc		 |$M22|
  003fc	4680		 mov         r8,r0

; 112  :     BOOL fDone = FALSE;

  003fe	2600		 movs        r6,#0

; 113  :     SETFNAME(_T("DeleteProcessRequirements"));
; 114  : 
; 115  :     PMENTERUPDATE();

  00400	f000 f800	 bl          PmEnterUpdate
  00404	f8df 9088	 ldr         r9,|$LN30@DeleteProc| ; =|dpCurSettings|
  00408	4f20		 ldr         r7,|$LN29@DeleteProc| ; =|gpFloorDx|
  0040a		 |$LL9@DeleteProc|

; 118  :         PDEVICE_POWER_RESTRICTION pdpr;
; 119  :         
; 120  :         // a process is going away, clean up its resources if there are any
; 121  :         PMLOCK();

  0040a	f000 f800	 bl          PmLock

; 122  :         for(pdpr = gpFloorDx; pdpr != NULL; pdpr = pdpr->pNext) {

  0040e	683c		 ldr         r4,[r7]
  00410	e003		 b           |$LN20@DeleteProc|
  00412		 |$LL7@DeleteProc|

; 123  :             // does the terminating process own this requirement?
; 124  :             if(pdpr->hOwner == hProcess) {

  00412	6863		 ldr         r3,[r4,#4]
  00414	4543		 cmp         r3,r8
  00416	d003		 beq         |$LN16@DeleteProc|

; 122  :         for(pdpr = gpFloorDx; pdpr != NULL; pdpr = pdpr->pNext) {

  00418	6964		 ldr         r4,[r4,#0x14]
  0041a		 |$LN20@DeleteProc|
  0041a	2c00		 cmp         r4,#0
  0041c	d1f9		 bne         |$LL7@DeleteProc|

; 123  :             // does the terminating process own this requirement?
; 124  :             if(pdpr->hOwner == hProcess) {

  0041e	e027		 b           |$LN2@DeleteProc|
  00420		 |$LN16@DeleteProc|

; 125  :                 // clone the device identifier associated with the requirement
; 126  :                 // so that we can update affected devices after removing the
; 127  :                 // restriction.
; 128  :                 PDEVICEID pDeviceId = DeviceIdClone(pdpr->pDeviceId);

  00420	6820		 ldr         r0,[r4]
  00422	f000 f800	 bl          DeviceIdClone

; 129  :                 
; 130  :                 // delete the requirement
; 131  :                 PMLOGMSG(ZONE_REQUIRE, 
; 132  :                     (_T("%s: deleting requirement 0x%08x for process 0x%08x\r\n"),
; 133  :                     pszFname, pdpr, hProcess));

  00426	f8d9 3440	 ldr         r3,[r9,#0x440]
  0042a	4605		 mov         r5,r0
  0042c	f013 0f80	 tst         r3,#0x80
  00430	d00b		 beq         |$LN12@DeleteProc|
  00432	4915		 ldr         r1,|$LN28@DeleteProc| ; =|??_C@_1DE@CEKPIGEL@?$AAD?$AAe?$AAl?$AAe?$AAt?$AAe?$AAP?$AAr?$AAo?$AAc?$AAe?$AAs?$AAs?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAs?$AA?$AA@|
  00434	4813		 ldr         r0,|$LN27@DeleteProc| ; =|??_C@_1GK@KOLHFJIM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAl?$AAe?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5@|
  00436	4643		 mov         r3,r8
  00438	4622		 mov         r2,r4
  0043a	f000 f800	 bl          NKDbgPrintfW
  0043e	4912		 ldr         r1,|$LN28@DeleteProc| ; =|??_C@_1DE@CEKPIGEL@?$AAD?$AAe?$AAl?$AAe?$AAt?$AAe?$AAP?$AAr?$AAo?$AAc?$AAe?$AAs?$AAs?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAs?$AA?$AA@|
  00440	4810		 ldr         r0,|$LN27@DeleteProc| ; =|??_C@_1GK@KOLHFJIM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAl?$AAe?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5@|
  00442	4643		 mov         r3,r8
  00444	4622		 mov         r2,r4
  00446	f000 f800	 bl          CeLogMsg
  0044a		 |$LN12@DeleteProc|

; 134  :                 if(PowerRestrictionRemList(&gpFloorDx, pdpr)) {

  0044a	4621		 mov         r1,r4
  0044c	4638		 mov         r0,r7
  0044e	f000 f800	 bl          PowerRestrictionRemList
  00452	b110		 cbz         r0,|$LN3@DeleteProc|

; 135  :                     PowerRestrictionDestroy(pdpr);

  00454	4620		 mov         r0,r4
  00456	f000 f800	 bl          PowerRestrictionDestroy
  0045a		 |$LN3@DeleteProc|

; 136  :                 }
; 137  :                 
; 138  :                 // update any affected devices
; 139  :                 if(pDeviceId != NULL) {

  0045a	b14d		 cbz         r5,|$LN2@DeleteProc|

; 140  :                     PMUNLOCK();

  0045c	f000 f800	 bl          PmUnlock

; 141  :                     UpdateRequirementDevices(pDeviceId);

  00460	4628		 mov         r0,r5
  00462	f000 f800	 bl          UpdateRequirementDevices

; 142  :                     DeviceIdDestroy(pDeviceId);

  00466	4628		 mov         r0,r5
  00468	f000 f800	 bl          DeviceIdDestroy

; 143  :                     PMLOCK();

  0046c	f000 f800	 bl          PmLock
  00470		 |$LN2@DeleteProc|

; 144  :                 }
; 145  :                 
; 146  :                 // start again at the start of the list, since we had
; 147  :                 // to unlock to handle the device.  We will eventually
; 148  :                 // run out of requirements imposed by this process.
; 149  :                 break;
; 150  :             }
; 151  :         }
; 152  :         PMUNLOCK();

  00470	f000 f800	 bl          PmUnlock

; 153  :         
; 154  :         // did we get to the end of the list?
; 155  :         if(pdpr == NULL) {

  00474	b904		 cbnz        r4,|$LN1@DeleteProc|

; 156  :             // yes, we're all done now
; 157  :             fDone = TRUE;

  00476	2601		 movs        r6,#1
  00478		 |$LN1@DeleteProc|

; 116  :     
; 117  :     while(!fDone) {

  00478	2e00		 cmp         r6,#0
  0047a	d0c6		 beq         |$LL9@DeleteProc|

; 158  :         }
; 159  :     }
; 160  : 
; 161  :     PMLEAVEUPDATE();

  0047c	f000 f800	 bl          PmLeaveUpdate
  00480		 |$M25|

; 162  : }

  00480	e8bd 8bf0	 pop         {r4-r9,r11,pc}
  00484		 |$LN26@DeleteProc|
  00484		 |$LN27@DeleteProc|
  00484	0000 0000	 DCD         |??_C@_1GK@KOLHFJIM@?$AA?$CF?$AAs?$AA?3?$AA?5?$AAd?$AAe?$AAl?$AAe?$AAt?$AAi?$AAn?$AAg?$AA?5?$AAr?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AA?5?$AA0?$AAx?$AA?$CF?$AA0?$AA8?$AAx?$AA?5@|
  00488		 |$LN28@DeleteProc|
  00488	0000 0000	 DCD         |??_C@_1DE@CEKPIGEL@?$AAD?$AAe?$AAl?$AAe?$AAt?$AAe?$AAP?$AAr?$AAo?$AAc?$AAe?$AAs?$AAs?$AAR?$AAe?$AAq?$AAu?$AAi?$AAr?$AAe?$AAm?$AAe?$AAn?$AAt?$AAs?$AA?$AA@|
  0048c		 |$LN29@DeleteProc|
  0048c	0000 0000	 DCD         |gpFloorDx|
  00490		 |$LN30@DeleteProc|
  00490	0000 0000	 DCD         |dpCurSettings|
  00494		 |$M23|

			 ENDP  ; |DeleteProcessRequirements|

	END
